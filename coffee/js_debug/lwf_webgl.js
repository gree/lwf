// Copyright (c) 2012 GREE, Inc - http://git.io/uvS3hQ
// Copyright (c) 2010-2012 Tween.js authors - http://git.io/tiDrNw
// Copyright (c) 2001 Robert Penner - http://goo.gl/Qjqc0
// Copyright (c) 2012 imaya - http://git.io/oVL5vg
if (typeof global === "undefined" && typeof window !== "undefined") {
	/* Browsers */
	global = window;
}
// Generated by CoffeeScript 1.4.0
(function() { var __FILE__ = 'lwf_webgl.js';
  var Align, AlphaTransform, Animation, Base64, Bitmap, BitmapEx, Button, ButtonEventHandlers, ClipEvent, Color, ColorTransform, Condition, Constant, ControlType, Data, EventHandlers, Format, GObjType, Graphic, IObject, LObject, LWF, LWFContainer, LWFLoader, LWFLoaderWithArray, LWFLoaderWithArrayBuffer, Loader, Matrix, Movie, MovieEventHandlers, NullRendererFactory, Particle, Point, ProgramObject, Property, Text, Translate, Type, Utility, WebGLBitmapContext, WebGLBitmapRenderer, WebGLRendererFactory, WebGLResourceCache, WebGLTextContext, WebGLTextRenderer, WebkitCSSDomElementRenderer, WebkitCSSRendererFactory, WebkitCSSResourceCache, atob, _ref,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Point = (function() {

    function Point(x, y) {
      this.x = x != null ? x : 0;
      this.y = y != null ? y : 0;
    }

    return Point;

  })();

  Translate = (function() {

    function Translate(translateX, translateY) {
      this.translateX = translateX != null ? translateX : 0;
      this.translateY = translateY != null ? translateY : 0;
    }

    return Translate;

  })();

  Matrix = (function() {

    function Matrix(scaleX, scaleY, skew0, skew1, translateX, translateY) {
      this.scaleX = scaleX;
      this.scaleY = scaleY;
      this.skew0 = skew0;
      this.skew1 = skew1;
      this.translateX = translateX;
      this.translateY = translateY;
      if (this.scaleX == null) {
        this.clear();
      }
    }

    Matrix.prototype.clear = function() {
      this.scaleX = 1;
      this.scaleY = 1;
      this.skew0 = 0;
      this.skew1 = 0;
      this.translateX = 0;
      this.translateY = 0;
    };

    Matrix.prototype.set = function(m) {
      this.scaleX = m.scaleX;
      this.scaleY = m.scaleY;
      this.skew0 = m.skew0;
      this.skew1 = m.skew1;
      this.translateX = m.translateX;
      this.translateY = m.translateY;
      return this;
    };

    Matrix.prototype.setWithComparing = function(m) {
      var changed, scaleX, scaleY, skew0, skew1, translateX, translateY;
      if (m === null) {
        return false;
      }
      scaleX = m.scaleX;
      scaleY = m.scaleY;
      skew0 = m.skew0;
      skew1 = m.skew1;
      translateX = m.translateX;
      translateY = m.translateY;
      changed = false;
      if (this.scaleX !== scaleX) {
        this.scaleX = scaleX;
        changed = true;
      }
      if (this.scaleY !== scaleY) {
        this.scaleY = scaleY;
        changed = true;
      }
      if (this.skew0 !== skew0) {
        this.skew0 = skew0;
        changed = true;
      }
      if (this.skew1 !== skew1) {
        this.skew1 = skew1;
        changed = true;
      }
      if (this.translateX !== translateX) {
        this.translateX = translateX;
        changed = true;
      }
      if (this.translateY !== translateY) {
        this.translateY = translateY;
        changed = true;
      }
      return changed;
    };

    return Matrix;

  })();

  Color = (function() {

    function Color(red, green, blue, alpha) {
      this.red = red;
      this.green = green;
      this.blue = blue;
      this.alpha = alpha;
      if (this.red == null) {
        this.red = 0;
        this.green = 0;
        this.blue = 0;
        this.alpha = 0;
      }
    }

    Color.prototype.set = function(r, g, b, a) {
      var c;
      if (typeof r === "object") {
        c = r;
        this.red = c.red;
        this.green = c.green;
        this.blue = c.blue;
        this.alpha = c.alpha;
      } else {
        this.red = r;
        this.green = g;
        this.blue = b;
        this.alpha = a;
      }
    };

    return Color;

  })();

  AlphaTransform = (function() {

    function AlphaTransform(alpha) {
      this.alpha = alpha;
    }

    return AlphaTransform;

  })();

  ColorTransform = (function() {

    function ColorTransform(mr, mg, mb, ma, ar, ag, ab, aa) {
      this.multi = new Color(mr, mg, mb, ma);
      if (mr == null) {
        this.clear();
      }
    }

    ColorTransform.prototype.clear = function() {
      this.multi.set(1, 1, 1, 1);
    };

    ColorTransform.prototype.set = function(c) {
      this.multi.set(c.multi);
      return this;
    };

    ColorTransform.prototype.setWithComparing = function(c) {
      var alpha, blue, changed, cm, green, m, red;
      if (c === null) {
        return false;
      }
      cm = c.multi;
      red = cm.red;
      green = cm.green;
      blue = cm.blue;
      alpha = cm.alpha;
      changed = false;
      m = this.multi;
      if (m.red !== red) {
        m.red = red;
        changed = true;
      }
      if (m.green !== green) {
        m.green = green;
        changed = true;
      }
      if (m.blue !== blue) {
        m.blue = blue;
        changed = true;
      }
      if (m.alpha !== alpha) {
        m.alpha = alpha;
        changed = true;
      }
      return changed;
    };

    return ColorTransform;

  })();

  Format = (function() {

    function Format() {}

    Format.Constant = (function() {

      function Constant() {}

      Constant.HEADER_SIZE = 324;

      Constant.FORMAT_VERSION_0 = 0x12;

      Constant.FORMAT_VERSION_1 = 0x10;

      Constant.FORMAT_VERSION_2 = 0x10;

      Constant.FORMAT_TYPE = 0;

      Constant.OPTION_USE_SCRIPT = 1 << 0;

      Constant.OPTION_USE_TEXTUREATLAS = 1 << 1;

      Constant.MATRIX_FLAG = 1 << 31;

      Constant.COLORTRANSFORM_FLAG = 1 << 31;

      Constant.TEXTUREFORMAT_NORMAL = 0;

      Constant.TEXTUREFORMAT_PREMULTIPLIEDALPHA = 1;

      return Constant;

    })();

    Format.StringBase = (function() {

      function StringBase(stringId) {
        this.stringId = stringId;
      }

      return StringBase;

    })();

    Format.Texture = (function() {

      function Texture(stringId, format, width, height, scale) {
        this.stringId = stringId;
        this.format = format;
        this.width = width;
        this.height = height;
        this.scale = scale;
      }

      Texture.prototype.setFilename = function(data) {
        this.filename = data.strings[this.stringId];
      };

      return Texture;

    })();

    Format.TextureReplacement = (function() {

      function TextureReplacement(filename, format, width, height, scale) {
        this.filename = filename;
        this.format = format;
        this.width = width;
        this.height = height;
        this.scale = scale;
      }

      return TextureReplacement;

    })();

    Format.TextureFragment = (function() {

      function TextureFragment(stringId, textureId, rotated, x, y, u, v, w, h) {
        this.stringId = stringId;
        this.textureId = textureId;
        this.rotated = rotated;
        this.x = x;
        this.y = y;
        this.u = u;
        this.v = v;
        this.w = w;
        this.h = h;
      }

      TextureFragment.prototype.setFilename = function(data) {
        this.filename = data.strings[this.stringId];
      };

      return TextureFragment;

    })();

    Format.TextureFragmentReplacement = (function() {

      function TextureFragmentReplacement(filename, textureId, rotated, x, y, u, v, w, h) {
        this.filename = filename;
        this.textureId = textureId;
        this.rotated = rotated;
        this.x = x;
        this.y = y;
        this.u = u;
        this.v = v;
        this.w = w;
        this.h = h;
      }

      return TextureFragmentReplacement;

    })();

    Format.Bitmap = (function() {

      function Bitmap(matrixId, textureFragmentId) {
        this.matrixId = matrixId;
        this.textureFragmentId = textureFragmentId;
      }

      return Bitmap;

    })();

    Format.BitmapEx = (function() {

      BitmapEx.Attribute = (function() {

        function Attribute() {}

        Attribute.REPEAT_S = 1 << 0;

        Attribute.REPEAT_T = 1 << 1;

        return Attribute;

      })();

      function BitmapEx(matrixId, textureFragmentId, attribute, u, v, w, h) {
        this.matrixId = matrixId;
        this.textureFragmentId = textureFragmentId;
        this.attribute = attribute;
        this.u = u;
        this.v = v;
        this.w = w;
        this.h = h;
      }

      return BitmapEx;

    }).call(this);

    Format.Font = (function() {

      function Font(stringId, letterspacing) {
        this.stringId = stringId;
        this.letterspacing = letterspacing;
      }

      return Font;

    })();

    Format.TextProperty = (function() {

      TextProperty.Align = (function() {

        function Align() {}

        Align.LEFT = 0;

        Align.RIGHT = 1;

        Align.CENTER = 2;

        Align.ALIGN_MASK = 0x3;

        Align.VERTICAL_BOTTOM = 1 << 2;

        Align.VERTICAL_MIDDLE = 2 << 2;

        Align.VERTICAL_MASK = 0xc;

        return Align;

      })();

      function TextProperty(maxLength, fontId, fontHeight, align, leftMargin, rightMargin, indent, leading, strokeColorId, strokeWidth, shadowColorId, shadowOffsetX, shadowOffsetY, shadowBlur) {
        this.maxLength = maxLength;
        this.fontId = fontId;
        this.fontHeight = fontHeight;
        this.align = align;
        this.leftMargin = leftMargin;
        this.rightMargin = rightMargin;
        this.indent = indent;
        this.leading = leading;
        this.strokeColorId = strokeColorId;
        this.strokeWidth = strokeWidth;
        this.shadowColorId = shadowColorId;
        this.shadowOffsetX = shadowOffsetX;
        this.shadowOffsetY = shadowOffsetY;
        this.shadowBlur = shadowBlur;
      }

      return TextProperty;

    }).call(this);

    Format.Text = (function() {

      function Text(matrixId, nameStringId, textPropertyId, stringId, colorId, width, height) {
        this.matrixId = matrixId;
        this.nameStringId = nameStringId;
        this.textPropertyId = textPropertyId;
        this.stringId = stringId;
        this.colorId = colorId;
        this.width = width;
        this.height = height;
      }

      return Text;

    })();

    Format.ParticleData = (function() {

      function ParticleData(stringId) {
        this.stringId = stringId;
      }

      return ParticleData;

    })();

    Format.Particle = (function() {

      function Particle(matrixId, colorTransformId, particleDataId) {
        this.matrixId = matrixId;
        this.colorTransformId = colorTransformId;
        this.particleDataId = particleDataId;
      }

      return Particle;

    })();

    Format.ProgramObject = (function(_super) {

      __extends(ProgramObject, _super);

      function ProgramObject(stringId, width, height, matrixId, colorTransformId) {
        this.width = width;
        this.height = height;
        this.matrixId = matrixId;
        this.colorTransformId = colorTransformId;
        ProgramObject.__super__.constructor.call(this, stringId);
      }

      return ProgramObject;

    })(Format.StringBase);

    Format.GraphicObject = (function() {

      GraphicObject.Type = (function() {

        function Type() {}

        Type.BITMAP = 0;

        Type.BITMAPEX = 1;

        Type.TEXT = 2;

        Type.GRAPHIC_OBJECT_MAX = 3;

        return Type;

      })();

      function GraphicObject(graphicObjectType, graphicObjectId) {
        this.graphicObjectType = graphicObjectType;
        this.graphicObjectId = graphicObjectId;
      }

      return GraphicObject;

    }).call(this);

    Format.Graphic = (function() {

      function Graphic(graphicObjectId, graphicObjects) {
        this.graphicObjectId = graphicObjectId;
        this.graphicObjects = graphicObjects;
      }

      return Graphic;

    })();

    Format.LObject = (function() {

      LObject.Type = (function() {

        function Type() {}

        Type.BUTTON = 0;

        Type.GRAPHIC = 1;

        Type.MOVIE = 2;

        Type.BITMAP = 3;

        Type.BITMAPEX = 4;

        Type.TEXT = 5;

        Type.PARTICLE = 6;

        Type.PROGRAMOBJECT = 7;

        Type.ATTACHEDMOVIE = 8;

        Type.OBJECT_MAX = 9;

        return Type;

      })();

      function LObject(objectType, objectId) {
        this.objectType = objectType;
        this.objectId = objectId;
      }

      return LObject;

    }).call(this);

    Format.Animation = (function() {

      function Animation(animationOffset, animationLength) {
        this.animationOffset = animationOffset;
        this.animationLength = animationLength;
      }

      return Animation;

    })();

    Format.ButtonCondition = (function() {

      ButtonCondition.Condition = (function() {

        function Condition() {}

        Condition.ROLLOVER = 1 << 0;

        Condition.ROLLOUT = 1 << 1;

        Condition.PRESS = 1 << 2;

        Condition.RELEASE = 1 << 3;

        Condition.DRAGOUT = 1 << 4;

        Condition.DRAGOVER = 1 << 5;

        Condition.RELEASEOUTSIDE = 1 << 6;

        Condition.KEYPRESS = 1 << 7;

        return Condition;

      })();

      function ButtonCondition(condition, keyCode, animationId) {
        this.condition = condition;
        this.keyCode = keyCode;
        this.animationId = animationId;
      }

      return ButtonCondition;

    }).call(this);

    Format.Button = (function() {

      function Button(width, height, matrixId, colorTransformId, conditionId, conditions) {
        this.width = width;
        this.height = height;
        this.matrixId = matrixId;
        this.colorTransformId = colorTransformId;
        this.conditionId = conditionId;
        this.conditions = conditions;
      }

      return Button;

    })();

    Format.Label = (function(_super) {

      __extends(Label, _super);

      function Label(stringId, frameNo) {
        this.frameNo = frameNo;
        Label.__super__.constructor.call(this, stringId);
      }

      return Label;

    })(Format.StringBase);

    Format.InstanceName = (function(_super) {

      __extends(InstanceName, _super);

      function InstanceName(stringId) {
        InstanceName.__super__.constructor.apply(this, arguments);
      }

      return InstanceName;

    })(Format.StringBase);

    Format.Event = (function(_super) {

      __extends(Event, _super);

      function Event(stringId) {
        Event.__super__.constructor.apply(this, arguments);
      }

      return Event;

    })(Format.StringBase);

    Format.String = (function() {

      function String(stringOffset, stringLength) {
        this.stringOffset = stringOffset;
        this.stringLength = stringLength;
      }

      return String;

    })();

    Format.Place = (function() {

      function Place(depth, objectId, instanceId, matrixId) {
        this.depth = depth;
        this.objectId = objectId;
        this.instanceId = instanceId;
        this.matrixId = matrixId;
      }

      return Place;

    })();

    Format.ControlMoveM = (function() {

      function ControlMoveM(placeId, matrixId) {
        this.placeId = placeId;
        this.matrixId = matrixId;
      }

      return ControlMoveM;

    })();

    Format.ControlMoveC = (function() {

      function ControlMoveC(placeId, colorTransformId) {
        this.placeId = placeId;
        this.colorTransformId = colorTransformId;
      }

      return ControlMoveC;

    })();

    Format.ControlMoveMC = (function() {

      function ControlMoveMC(placeId, matrixId, colorTransformId) {
        this.placeId = placeId;
        this.matrixId = matrixId;
        this.colorTransformId = colorTransformId;
      }

      return ControlMoveMC;

    })();

    Format.Control = (function() {

      Control.Type = (function() {

        function Type() {}

        Type.MOVE = 0;

        Type.MOVEM = 1;

        Type.MOVEC = 2;

        Type.MOVEMC = 3;

        Type.ANIMATION = 4;

        Type.CONTROL_MAX = 5;

        return Type;

      })();

      function Control(controlType, controlId) {
        this.controlType = controlType;
        this.controlId = controlId;
      }

      return Control;

    }).call(this);

    Format.Frame = (function() {

      function Frame(controlOffset, controls) {
        this.controlOffset = controlOffset;
        this.controls = controls;
      }

      return Frame;

    })();

    Format.MovieClipEvent = (function() {

      MovieClipEvent.ClipEvent = (function() {

        function ClipEvent() {}

        ClipEvent.LOAD = 1 << 0;

        ClipEvent.UNLOAD = 1 << 1;

        ClipEvent.ENTERFRAME = 1 << 2;

        return ClipEvent;

      })();

      function MovieClipEvent(clipEvent, animationId) {
        this.clipEvent = clipEvent;
        this.animationId = animationId;
      }

      return MovieClipEvent;

    }).call(this);

    Format.Movie = (function() {

      function Movie(depths, labelOffset, labels, frameOffset, frames, clipEventId, clipEvents) {
        this.depths = depths;
        this.labelOffset = labelOffset;
        this.labels = labels;
        this.frameOffset = frameOffset;
        this.frames = frames;
        this.clipEventId = clipEventId;
        this.clipEvents = clipEvents;
      }

      return Movie;

    })();

    Format.MovieLinkage = (function(_super) {

      __extends(MovieLinkage, _super);

      function MovieLinkage(stringId, movieId) {
        this.movieId = movieId;
        MovieLinkage.__super__.constructor.call(this, stringId);
      }

      return MovieLinkage;

    })(Format.StringBase);

    Format.ItemArray = (function() {

      function ItemArray(offset, length) {
        this.offset = offset;
        this.length = length;
      }

      return ItemArray;

    })();

    Format.Header = (function() {

      function Header(id0, id1, id2, id3, formatVersion0, formatVersion1, formatVersion2, option, width, height, frameRate, rootMovieId, nameStringId, backgroundColor, stringBytes, animationBytes, translate, matrix, color, alphaTransform, colorTransform, objectData, texture, textureFragment, bitmap, bitmapEx, font, textProperty, text, particleData, particle, programObject, graphicObject, graphic, animation, buttonCondition, button, label, instanceName, eventData, place, controlMoveM, controlMoveC, controlMoveMC, control, frame, movieClipEvent, movie, movieLinkage, stringData, lwfLength) {
        this.id0 = id0;
        this.id1 = id1;
        this.id2 = id2;
        this.id3 = id3;
        this.formatVersion0 = formatVersion0;
        this.formatVersion1 = formatVersion1;
        this.formatVersion2 = formatVersion2;
        this.option = option;
        this.width = width;
        this.height = height;
        this.frameRate = frameRate;
        this.rootMovieId = rootMovieId;
        this.nameStringId = nameStringId;
        this.backgroundColor = backgroundColor;
        this.stringBytes = stringBytes;
        this.animationBytes = animationBytes;
        this.translate = translate;
        this.matrix = matrix;
        this.color = color;
        this.alphaTransform = alphaTransform;
        this.colorTransform = colorTransform;
        this.objectData = objectData;
        this.texture = texture;
        this.textureFragment = textureFragment;
        this.bitmap = bitmap;
        this.bitmapEx = bitmapEx;
        this.font = font;
        this.textProperty = textProperty;
        this.text = text;
        this.particleData = particleData;
        this.particle = particle;
        this.programObject = programObject;
        this.graphicObject = graphicObject;
        this.graphic = graphic;
        this.animation = animation;
        this.buttonCondition = buttonCondition;
        this.button = button;
        this.label = label;
        this.instanceName = instanceName;
        this.eventData = eventData;
        this.place = place;
        this.controlMoveM = controlMoveM;
        this.controlMoveC = controlMoveC;
        this.controlMoveMC = controlMoveMC;
        this.control = control;
        this.frame = frame;
        this.movieClipEvent = movieClipEvent;
        this.movie = movie;
        this.movieLinkage = movieLinkage;
        this.stringData = stringData;
        this.lwfLength = lwfLength;
      }

      return Header;

    })();

    return Format;

  }).call(this);

  Align = Format.TextProperty.Align;

  ClipEvent = Format.MovieClipEvent.ClipEvent;

  Condition = Format.ButtonCondition.Condition;

  Constant = Format.Constant;

  Type = Format.LObject.Type;

  ControlType = Format.Control.Type;

  GObjType = Format.GraphicObject.Type;

  Animation = (function() {

    function Animation() {}

    Animation.END = 0;

    Animation.PLAY = 1;

    Animation.STOP = 2;

    Animation.GOTONEXTFRAME = 3;

    Animation.GOTOPREVFRAME = 4;

    Animation.GOTOFRAME = 5;

    Animation.GOTOLABEL = 6;

    Animation.SETTARGET = 7;

    Animation.EVENT = 8;

    Animation.CALL = 9;

    Animation.INSTANCE_TARGET_ROOT = -1;

    Animation.INSTANCE_TARGET_PARENT = -2;

    return Animation;

  })();

  Data = (function() {

    function Data(header, translates, matrices, colors, alphaTransforms, colorTransforms, objects, textures, textureFragments, bitmaps, bitmapExs, fonts, textProperties, texts, particleDatas, particles, programObjects, graphicObjects, graphics, animations, buttonConditions, buttons, labels, instanceNames, events, places, controlMoveMs, controlMoveCs, controlMoveMCs, controls, frames, movieClipEvents, movies, movieLinkages, strings) {
      var d;
      this.header = header;
      this.translates = translates;
      this.matrices = matrices;
      this.colors = colors;
      this.alphaTransforms = alphaTransforms;
      this.colorTransforms = colorTransforms;
      this.objects = objects;
      this.textures = textures;
      this.textureFragments = textureFragments;
      this.bitmaps = bitmaps;
      this.bitmapExs = bitmapExs;
      this.fonts = fonts;
      this.textProperties = textProperties;
      this.texts = texts;
      this.particleDatas = particleDatas;
      this.particles = particles;
      this.programObjects = programObjects;
      this.graphicObjects = graphicObjects;
      this.graphics = graphics;
      this.animations = animations;
      this.buttonConditions = buttonConditions;
      this.buttons = buttons;
      this.labels = labels;
      this.instanceNames = instanceNames;
      this.events = events;
      this.places = places;
      this.controlMoveMs = controlMoveMs;
      this.controlMoveCs = controlMoveCs;
      this.controlMoveMCs = controlMoveMCs;
      this.controls = controls;
      this.frames = frames;
      this.movieClipEvents = movieClipEvents;
      this.movies = movies;
      this.movieLinkages = movieLinkages;
      this.strings = strings;
      if (this.header.header != null) {
        d = this.header;
        this.header = d.header;
        this.translates = d.translates;
        this.matrices = d.matrices;
        this.colors = d.colors;
        this.alphaTransforms = d.alphaTransforms;
        this.colorTransforms = d.colorTransforms;
        this.objects = d.objects;
        this.textures = d.textures;
        this.textureFragments = d.textureFragments;
        this.bitmaps = d.bitmaps;
        this.bitmapExs = d.bitmapExs;
        this.fonts = d.fonts;
        this.textProperties = d.textProperties;
        this.texts = d.texts;
        this.particleDatas = d.particleDatas;
        this.particles = d.particles;
        this.programObjects = d.programObjects;
        this.graphicObjects = d.graphicObjects;
        this.graphics = d.graphics;
        this.animations = d.animations;
        this.buttonConditions = d.buttonConditions;
        this.buttons = d.buttons;
        this.labels = d.labels;
        this.instanceNames = d.instanceNames;
        this.events = d.events;
        this.places = d.places;
        this.controlMoveMs = d.controlMoveMs;
        this.controlMoveCs = d.controlMoveCs;
        this.controlMoveMCs = d.controlMoveMCs;
        this.controls = d.controls;
        this.frames = d.frames;
        this.movieClipEvents = d.movieClipEvents;
        this.movies = d.movies;
        this.movieLinkages = d.movieLinkages;
        this.strings = d.strings;
        this.stringMap = d.stringMap;
        this.eventMap = d.eventMap;
        this.instanceNameMap = d.instanceNameMap;
        this.movieLinkageMap = d.movieLinkageMap;
        this.movieLinkageNameMap = d.movieLinkageNameMap;
        this.programObjectMap = d.programObjectMap;
        this.labelMap = d.labelMap;
        this.useScript = d.useScript;
        this.useTextureAtlas = d.useTextureAtlas;
      } else {
        this.stringMap = {};
        this.eventMap = {};
        this.instanceNameMap = {};
        this.movieLinkageMap = {};
        this.movieLinkageNameMap = {};
        this.programObjectMap = {};
        this.labelMap = [];
        if (this.header != null) {
          this.useScript = (this.header.option & Format.Constant.OPTION_USE_SCRIPT) !== 0;
          this.useTextureAtlas = (this.header.option & Format.Constant.OPTION_USE_TEXTUREATLAS) !== 0;
        } else {
          this.useScript = false;
          this.useTextureAtlas = false;
        }
      }
    }

    Data.prototype.check = function() {
      if ((this.header != null) && this.header.id0 === 'L' && this.header.id1 === 'W' && this.header.id2 === 'F' && this.header.formatVersion0 === Format.Constant.FORMAT_VERSION_0 && this.header.formatVersion1 === Format.Constant.FORMAT_VERSION_1 && this.header.formatVersion2 === Format.Constant.FORMAT_VERSION_2) {
        return true;
      } else {
        return false;
      }
    };

    Data.prototype.name = function() {
      return this.strings[this.header.nameStringId];
    };

    Data.prototype.replaceTexture = function(index, textureReplacement) {
      if (index < 0 || index >= textures.length) {
        return false;
      }
      textures[index] = textureReplacement;
      return true;
    };

    Data.prototype.replaceTextureFragment = function(index, textureFragmentReplacement) {
      if (index < 0 || index >= textureFragments.length) {
        return false;
      }
      textureFragments[index] = textureFragmentReplacement;
      return true;
    };

    return Data;

  })();

  LWFLoader = (function() {

    function LWFLoader() {}

    LWFLoader.prototype.readByte = function() {
      return this.d.charCodeAt(this.index++) & 0xff;
    };

    LWFLoader.prototype.readChar = function() {
      return String.fromCharCode(this.readByte());
    };

    LWFLoader.prototype.readBytes = function(length) {
      var bytes;
      bytes = this.d.substr(this.index, length);
      this.index += length;
      return bytes;
    };

    LWFLoader.prototype.readInt32 = function() {
      return (this.readByte() << 0) + (this.readByte() << 8) + (this.readByte() << 16) + (this.readByte() << 24);
    };

    LWFLoader.prototype.readSingle = function() {
      var b0, b1, b2, b3, exp, sig, sign;
      b3 = this.readByte();
      b2 = this.readByte();
      b1 = this.readByte();
      b0 = this.readByte();
      sign = 1 - (2 * (b0 >> 7));
      exp = (((b0 << 1) & 0xff) | (b1 >> 7)) - 127;
      sig = ((b1 & 0x7f) << 16) | (b2 << 8) | b3;
      if (sig === 0 && exp === -127) {
        return 0.0;
      }
      return sign * (1 + sig * Math.pow(2, -23)) * Math.pow(2, exp);
    };

    LWFLoader.prototype.loadTranslate = function() {
      return new Translate(this.readSingle(), this.readSingle());
    };

    LWFLoader.prototype.loadMatrix = function() {
      return new Matrix(this.readSingle(), this.readSingle(), this.readSingle(), this.readSingle(), this.readSingle(), this.readSingle());
    };

    LWFLoader.prototype.loadColor = function() {
      return new Color(this.readSingle(), this.readSingle(), this.readSingle(), this.readSingle());
    };

    LWFLoader.prototype.loadAlphaTransform = function() {
      return new AlphaTransform(this.readSingle());
    };

    LWFLoader.prototype.loadColorTransform = function() {
      var add, multi;
      multi = this.loadColor();
      add = this.loadColor();
      return new ColorTransform(multi.red, multi.green, multi.blue, multi.alpha);
    };

    LWFLoader.prototype.loadTexture = function() {
      return new Format.Texture(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readSingle());
    };

    LWFLoader.prototype.loadTextureFragment = function() {
      return new Format.TextureFragment(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadBitmap = function() {
      return new Format.Bitmap(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadBitmapEx = function() {
      return new Format.BitmapEx(this.readInt32(), this.readInt32(), this.readInt32(), this.readSingle(), this.readSingle(), this.readSingle(), this.readSingle());
    };

    LWFLoader.prototype.loadFont = function() {
      return new Format.Font(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadTextProperty = function() {
      return new Format.TextProperty(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadText = function() {
      return new Format.Text(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadParticleData = function() {
      return new Format.ParticleData(this.readInt32());
    };

    LWFLoader.prototype.loadParticle = function() {
      return new Format.Particle(this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadProgramObject = function() {
      return new Format.ProgramObject(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadGraphicObject = function() {
      return new Format.GraphicObject(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadGraphic = function() {
      return new Format.Graphic(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadObject = function() {
      return new Format.LObject(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadAnimation = function() {
      return new Format.Animation(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadButtonCondition = function() {
      return new Format.ButtonCondition(this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadButton = function() {
      return new Format.Button(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadLabel = function() {
      return new Format.Label(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadInstanceName = function() {
      return new Format.InstanceName(this.readInt32());
    };

    LWFLoader.prototype.loadEvent = function() {
      return new Format.Event(this.readInt32());
    };

    LWFLoader.prototype.loadString = function() {
      return new Format.String(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadPlace = function() {
      return new Format.Place(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadControlMoveM = function() {
      return new Format.ControlMoveM(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadControlMoveC = function() {
      return new Format.ControlMoveC(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadControlMoveMC = function() {
      return new Format.ControlMoveMC(this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadControl = function() {
      return new Format.Control(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadFrame = function() {
      return new Format.Frame(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadMovieClipEvent = function() {
      return new Format.MovieClipEvent(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadMovie = function() {
      return new Format.Movie(this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadMovieLinkage = function() {
      return new Format.MovieLinkage(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadItemArray = function() {
      return new Format.ItemArray(this.readInt32(), this.readInt32());
    };

    LWFLoader.prototype.loadHeader = function() {
      var alphaTransform, animation, animationBytes, backgroundColor, bitmap, bitmapEx, button, buttonCondition, color, colorTransform, control, controlMoveC, controlMoveM, controlMoveMC, eventData, font, formatVersion0, formatVersion1, formatVersion2, frame, frameRate, graphic, graphicObject, height, id0, id1, id2, id3, instanceName, label, lwfLength, matrix, movie, movieClipEvent, movieLinkage, nameStringId, objectData, option, particle, particleData, place, programObject, rootMovieId, stringBytes, stringData, text, textProperty, texture, textureFragment, translate, width;
      id0 = this.readChar();
      id1 = this.readChar();
      id2 = this.readChar();
      id3 = this.readChar();
      formatVersion0 = this.readByte();
      formatVersion1 = this.readByte();
      formatVersion2 = this.readByte();
      option = this.readByte();
      width = this.readInt32();
      height = this.readInt32();
      frameRate = this.readInt32();
      rootMovieId = this.readInt32();
      nameStringId = this.readInt32();
      backgroundColor = this.readInt32();
      stringBytes = this.loadItemArray();
      animationBytes = this.loadItemArray();
      translate = this.loadItemArray();
      matrix = this.loadItemArray();
      color = this.loadItemArray();
      alphaTransform = this.loadItemArray();
      colorTransform = this.loadItemArray();
      objectData = this.loadItemArray();
      texture = this.loadItemArray();
      textureFragment = this.loadItemArray();
      bitmap = this.loadItemArray();
      bitmapEx = this.loadItemArray();
      font = this.loadItemArray();
      textProperty = this.loadItemArray();
      text = this.loadItemArray();
      particleData = this.loadItemArray();
      particle = this.loadItemArray();
      programObject = this.loadItemArray();
      graphicObject = this.loadItemArray();
      graphic = this.loadItemArray();
      animation = this.loadItemArray();
      buttonCondition = this.loadItemArray();
      button = this.loadItemArray();
      label = this.loadItemArray();
      instanceName = this.loadItemArray();
      eventData = this.loadItemArray();
      place = this.loadItemArray();
      controlMoveM = this.loadItemArray();
      controlMoveC = this.loadItemArray();
      controlMoveMC = this.loadItemArray();
      control = this.loadItemArray();
      frame = this.loadItemArray();
      movieClipEvent = this.loadItemArray();
      movie = this.loadItemArray();
      movieLinkage = this.loadItemArray();
      stringData = this.loadItemArray();
      lwfLength = this.readInt32();
      return new Format.Header(id0, id1, id2, id3, formatVersion0, formatVersion1, formatVersion2, option, width, height, frameRate, rootMovieId, nameStringId, backgroundColor, stringBytes, animationBytes, translate, matrix, color, alphaTransform, colorTransform, objectData, texture, textureFragment, bitmap, bitmapEx, font, textProperty, text, particleData, particle, programObject, graphicObject, graphic, animation, buttonCondition, button, label, instanceName, eventData, place, controlMoveM, controlMoveC, controlMoveMC, control, frame, movieClipEvent, movie, movieLinkage, stringData, lwfLength);
    };

    LWFLoader.prototype.load = function(d) {
      var a, animationBytes, animations, c, c2, c3, code, data, eventMap, header, i, instanceNameMap, l, labelMap, m, map, movieLinkageMap, movieLinkageNameMap, o, programObjectMap, s, str, stringBytes, stringDatas, stringMap, t, _i, _j, _k, _l, _len, _len1, _len2, _len3, _len4, _len5, _m, _n, _o, _p, _q, _r, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8;
      this.d = d;
      this.index = 0;
      header = this.loadHeader();
      data = new Data(header);
      if (!data.check()) {
        return null;
      }
      stringBytes = this.readBytes(header.stringBytes.length);
      animationBytes = this.readBytes(header.animationBytes.length);
      data.translates = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.translate.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadTranslate());
        }
        return _results;
      }).call(this);
      data.matrices = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.matrix.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadMatrix());
        }
        return _results;
      }).call(this);
      data.colors = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.color.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadColor());
        }
        return _results;
      }).call(this);
      data.alphaTransforms = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.alphaTransform.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadAlphaTransform());
        }
        return _results;
      }).call(this);
      data.colorTransforms = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.colorTransform.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadColorTransform());
        }
        return _results;
      }).call(this);
      data.objects = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.objectData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadObject());
        }
        return _results;
      }).call(this);
      data.textures = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.texture.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadTexture());
        }
        return _results;
      }).call(this);
      data.textureFragments = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.textureFragment.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadTextureFragment());
        }
        return _results;
      }).call(this);
      data.bitmaps = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.bitmap.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadBitmap());
        }
        return _results;
      }).call(this);
      data.bitmapExs = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.bitmapEx.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadBitmapEx());
        }
        return _results;
      }).call(this);
      data.fonts = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.font.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadFont());
        }
        return _results;
      }).call(this);
      data.textProperties = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.textProperty.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadTextProperty());
        }
        return _results;
      }).call(this);
      data.texts = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.text.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadText());
        }
        return _results;
      }).call(this);
      data.particleDatas = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.particleData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadParticleData());
        }
        return _results;
      }).call(this);
      data.particles = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.particle.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadParticle());
        }
        return _results;
      }).call(this);
      data.programObjects = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.programObject.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadProgramObject());
        }
        return _results;
      }).call(this);
      data.graphicObjects = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.graphicObject.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadGraphicObject());
        }
        return _results;
      }).call(this);
      data.graphics = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.graphic.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadGraphic());
        }
        return _results;
      }).call(this);
      animations = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.animation.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadAnimation());
        }
        return _results;
      }).call(this);
      data.buttonConditions = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.buttonCondition.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadButtonCondition());
        }
        return _results;
      }).call(this);
      data.buttons = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.button.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadButton());
        }
        return _results;
      }).call(this);
      data.labels = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.label.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadLabel());
        }
        return _results;
      }).call(this);
      data.instanceNames = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.instanceName.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadInstanceName());
        }
        return _results;
      }).call(this);
      data.events = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.eventData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadEvent());
        }
        return _results;
      }).call(this);
      data.places = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.place.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadPlace());
        }
        return _results;
      }).call(this);
      data.controlMoveMs = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.controlMoveM.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadControlMoveM());
        }
        return _results;
      }).call(this);
      data.controlMoveCs = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.controlMoveC.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadControlMoveC());
        }
        return _results;
      }).call(this);
      data.controlMoveMCs = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.controlMoveMC.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadControlMoveMC());
        }
        return _results;
      }).call(this);
      data.controls = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.control.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadControl());
        }
        return _results;
      }).call(this);
      data.frames = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.frame.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadFrame());
        }
        return _results;
      }).call(this);
      data.movieClipEvents = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.movieClipEvent.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadMovieClipEvent());
        }
        return _results;
      }).call(this);
      data.movies = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.movie.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadMovie());
        }
        return _results;
      }).call(this);
      data.movieLinkages = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.movieLinkage.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadMovieLinkage());
        }
        return _results;
      }).call(this);
      stringDatas = (function() {
        var _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = header.stringData.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push(this.loadString());
        }
        return _results;
      }).call(this);
      data.animations = [];
      for (_i = 0, _len = animations.length; _i < _len; _i++) {
        a = animations[_i];
        o = a.animationOffset;
        data.animations.push(this.readAnimation(animationBytes.slice(o, o + a.animationLength)));
      }
      data.strings = [];
      stringMap = data.stringMap;
      for (_j = 0, _len1 = stringDatas.length; _j < _len1; _j++) {
        a = stringDatas[_j];
        o = a.stringOffset;
        s = stringBytes.slice(o, o + a.stringLength);
        str = "";
        i = 0;
        while (i < s.length) {
          c = s.charCodeAt(i);
          if (c < 128) {
            str += String.fromCharCode(c);
            ++i;
          } else if (c > 191 && c < 224) {
            c2 = s.charCodeAt(i + 1);
            str += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
            i += 2;
          } else {
            c2 = s.charCodeAt(i + 1);
            c3 = s.charCodeAt(i + 2);
            code = ((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63);
            str += String.fromCharCode(code);
            i += 3;
          }
        }
        stringMap[str] = data.strings.length;
        data.strings.push(str);
      }
      instanceNameMap = data.instanceNameMap;
      for (i = _k = 0, _ref = data.instanceNames.length; 0 <= _ref ? _k < _ref : _k > _ref; i = 0 <= _ref ? ++_k : --_k) {
        instanceNameMap[data.instanceNames[i].stringId] = i;
      }
      eventMap = data.eventMap;
      for (i = _l = 0, _ref1 = data.events.length; 0 <= _ref1 ? _l < _ref1 : _l > _ref1; i = 0 <= _ref1 ? ++_l : --_l) {
        eventMap[data.events[i].stringId] = i;
      }
      movieLinkageMap = data.movieLinkageMap;
      for (i = _m = 0, _ref2 = data.movieLinkages.length; 0 <= _ref2 ? _m < _ref2 : _m > _ref2; i = 0 <= _ref2 ? ++_m : --_m) {
        movieLinkageMap[data.movieLinkages[i].stringId] = i;
      }
      movieLinkageNameMap = data.movieLinkageNameMap;
      for (i = _n = 0, _ref3 = data.movieLinkages.length; 0 <= _ref3 ? _n < _ref3 : _n > _ref3; i = 0 <= _ref3 ? ++_n : --_n) {
        movieLinkageNameMap[data.movieLinkages[i].movieId] = data.movieLinkages[i].stringId;
      }
      programObjectMap = data.programObjectMap;
      _ref4 = data.programObjects;
      for (i in _ref4) {
        o = _ref4[i];
        programObjectMap[o.stringId] = i;
      }
      labelMap = data.labelMap;
      _ref5 = data.movies;
      for (_o = 0, _len2 = _ref5.length; _o < _len2; _o++) {
        m = _ref5[_o];
        o = m.labelOffset;
        map = {};
        _ref6 = data.labels.slice(o, o + m.labels);
        for (_p = 0, _len3 = _ref6.length; _p < _len3; _p++) {
          l = _ref6[_p];
          map[l.stringId] = l.frameNo;
        }
        labelMap.push(map);
      }
      _ref7 = data.textures;
      for (_q = 0, _len4 = _ref7.length; _q < _len4; _q++) {
        t = _ref7[_q];
        t.setFilename(data);
      }
      _ref8 = data.textureFragments;
      for (_r = 0, _len5 = _ref8.length; _r < _len5; _r++) {
        t = _ref8[_r];
        t.setFilename(data);
      }
      return data;
    };

    LWFLoader.prototype.readByteFromBytes = function(bytes, index) {
      var b;
      b = bytes.charCodeAt(index++) & 0xff;
      return [index, b];
    };

    LWFLoader.prototype.readInt32FromBytes = function(bytes, index) {
      var b0, b1, b2, b3, i, _ref, _ref1, _ref2, _ref3;
      _ref = this.readByteFromBytes(bytes, index), index = _ref[0], b0 = _ref[1];
      _ref1 = this.readByteFromBytes(bytes, index), index = _ref1[0], b1 = _ref1[1];
      _ref2 = this.readByteFromBytes(bytes, index), index = _ref2[0], b2 = _ref2[1];
      _ref3 = this.readByteFromBytes(bytes, index), index = _ref3[0], b3 = _ref3[1];
      i = (b0 << 0) + (b1 << 8) + (b2 << 16) + (b3 << 24);
      return [index, i];
    };

    LWFLoader.prototype.readAnimation = function(bytes) {
      var array, code, count, i, index, target, _i, _ref, _ref1, _ref2, _ref3;
      array = [];
      index = 0;
      while (true) {
        _ref = this.readByteFromBytes(bytes, index), index = _ref[0], code = _ref[1];
        array.push(code);
        switch (code) {
          case Animation.GOTOFRAME:
          case Animation.GOTOLABEL:
          case Animation.EVENT:
          case Animation.CALL:
            _ref1 = this.readInt32FromBytes(bytes, index), index = _ref1[0], i = _ref1[1];
            array.push(i);
            break;
          case Animation.SETTARGET:
            _ref2 = this.readInt32FromBytes(bytes, index), index = _ref2[0], count = _ref2[1];
            array.push(count);
            for (i = _i = 0; 0 <= count ? _i < count : _i > count; i = 0 <= count ? ++_i : --_i) {
              _ref3 = this.readInt32FromBytes(bytes, index), index = _ref3[0], target = _ref3[1];
              array.push(target);
            }
            break;
          case Animation.END:
            return array;
        }
      }
    };

    return LWFLoader;

  })();

  LWFLoaderWithArray = (function(_super) {

    __extends(LWFLoaderWithArray, _super);

    function LWFLoaderWithArray() {
      return LWFLoaderWithArray.__super__.constructor.apply(this, arguments);
    }

    LWFLoaderWithArray.prototype.readByte = function() {
      return this.d[this.index++];
    };

    LWFLoaderWithArray.prototype.readBytes = function(length) {
      var bytes, i, _i;
      bytes = "";
      for (i = _i = 0; 0 <= length ? _i < length : _i > length; i = 0 <= length ? ++_i : --_i) {
        bytes += String.fromCharCode(this.d[this.index++]);
      }
      return bytes;
    };

    return LWFLoaderWithArray;

  })(LWFLoader);

  LWFLoaderWithArrayBuffer = (function(_super) {

    __extends(LWFLoaderWithArrayBuffer, _super);

    function LWFLoaderWithArrayBuffer() {
      this.int32Array = new Int32Array();
      this.float32Array = new Float32Array();
    }

    LWFLoaderWithArrayBuffer.prototype.readByte = function() {
      return this.d[this.index++];
    };

    LWFLoaderWithArrayBuffer.prototype.readBytes = function(length) {
      var bytes, i, _i;
      bytes = "";
      for (i = _i = 0; 0 <= length ? _i < length : _i > length; i = 0 <= length ? ++_i : --_i) {
        bytes += String.fromCharCode(this.d[this.index++]);
      }
      return bytes;
    };

    LWFLoaderWithArrayBuffer.prototype.readInt32 = function() {
      var i;
      i = this.dInt32[this.index / 4];
      this.index += 4;
      return i;
    };

    LWFLoaderWithArrayBuffer.prototype.readSingle = function() {
      var f;
      f = this.dFloat32[this.index / 4];
      this.index += 4;
      return f;
    };

    LWFLoaderWithArrayBuffer.prototype.load = function(d) {
      this.d = new Uint8Array(d);
      this.dInt32 = new Int32Array(d);
      this.dFloat32 = new Float32Array(d);
      return LWFLoaderWithArrayBuffer.__super__.load.call(this, this.d);
    };

    return LWFLoaderWithArrayBuffer;

  })(LWFLoader);

  Loader = (function() {

    function Loader() {}

    Loader.load = function(d) {
      var lwfLoader;
      if (!(d != null) || typeof d !== "string") {
        return;
      }
      lwfLoader = new LWFLoader;
      return lwfLoader.load(d);
    };

    Loader.loadArray = function(d) {
      var lwfLoader;
      if (!(d != null)) {
        return;
      }
      lwfLoader = new LWFLoaderWithArray;
      return lwfLoader.load(d);
    };

    Loader.loadArrayBuffer = function(d) {
      var lwfLoader;
      if (!(d != null)) {
        return;
      }
      lwfLoader = new LWFLoaderWithArrayBuffer;
      return lwfLoader.load(d);
    };

    return Loader;

  })();

  Utility = (function() {

    function Utility() {}

    Utility.calcMatrixToPoint = function(sx, sy, m) {
      var dx, dy;
      dx = m.scaleX * sx + m.skew0 * sy + m.translateX;
      dy = m.skew1 * sx + m.scaleY * sy + m.translateY;
      return [dx, dy];
    };

    Utility.getMatrixDeterminant = function(matrix) {
      return matrix.scaleX * matrix.scaleY - matrix.skew0 * matrix.skew1 < 0;
    };

    Utility.syncMatrix = function(movie) {
      var matrix, matrixId, md, rotation, scaleX, scaleY, translate, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        translate = movie.lwf.data.translates[matrixId];
        scaleX = 1;
        scaleY = 1;
        rotation = 0;
        matrix = {
          scaleX: scaleX,
          scaleY: scaleY,
          skew0: 0,
          skew1: 0,
          translateX: translate.translateX,
          translateY: translate.translateY
        };
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        md = this.getMatrixDeterminant(matrix);
        scaleX = Math.sqrt(matrix.scaleX * matrix.scaleX + matrix.skew1 * matrix.skew1);
        if (md) {
          scaleX = -scaleX;
        }
        scaleY = Math.sqrt(matrix.scaleY * matrix.scaleY + matrix.skew0 * matrix.skew0);
        if (md) {
          rotation = Math.atan2(matrix.skew1, -matrix.scaleX);
        } else {
          rotation = Math.atan2(matrix.skew1, matrix.scaleX);
        }
        rotation = rotation / Math.PI * 180;
      }
      movie.property.setMatrix(matrix, scaleX, scaleY, rotation);
    };

    Utility.getX = function(movie) {
      var matrix, matrixId, translate, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        translate = movie.lwf.data.translates[matrixId];
        return translate.translateX;
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        return matrix.translateX;
      }
    };

    Utility.getY = function(movie) {
      var matrix, matrixId, translate, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        translate = movie.lwf.data.translates[matrixId];
        return translate.translateY;
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        return matrix.translateY;
      }
    };

    Utility.getScaleX = function(movie) {
      var matrix, matrixId, md, scaleX, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        return 1;
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        md = this.getMatrixDeterminant(matrix);
        scaleX = Math.sqrt(matrix.scaleX * matrix.scaleX + matrix.skew1 * matrix.skew1);
        if (md) {
          scaleX = -scaleX;
        }
        return scaleX;
      }
    };

    Utility.getScaleY = function(movie) {
      var matrix, matrixId, scaleY, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        return 1;
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        scaleY = Math.sqrt(matrix.scaleY * matrix.scaleY + matrix.skew0 * matrix.skew0);
        return scaleY;
      }
    };

    Utility.getRotation = function(movie) {
      var matrix, matrixId, md, rotation, _ref;
      matrixId = (_ref = movie.matrixId) != null ? _ref : 0;
      if ((matrixId & Constant.MATRIX_FLAG) === 0) {
        return 0;
      } else {
        matrixId &= ~Constant.MATRIX_FLAG;
        matrix = movie.lwf.data.matrices[matrixId];
        md = this.getMatrixDeterminant(matrix);
        if (md) {
          rotation = Math.atan2(matrix.skew1, -matrix.scaleX);
        } else {
          rotation = Math.atan2(matrix.skew1, matrix.scaleX);
        }
        rotation = rotation / Math.PI * 180;
        return rotation;
      }
    };

    Utility.syncColorTransform = function(movie) {
      var alphaTransform, colorTransform, colorTransformId, _ref;
      colorTransformId = (_ref = movie.colorTransformId) != null ? _ref : 0;
      if ((colorTransformId & Constant.COLORTRANSFORM_FLAG) === 0) {
        alphaTransform = movie.lwf.data.alphaTransforms[colorTransformId];
        colorTransform = {
          multi: {
            red: 1,
            green: 1,
            blue: 1,
            alpha: alphaTransform.alpha
          }
        };
      } else {
        colorTransformId = colorTransformId & ~Constant.COLORTRANSFORM_FLAG;
        colorTransform = movie.lwf.data.colorTransforms[colorTransformId];
      }
      movie.property.setColorTransform(colorTransform);
    };

    Utility.getAlpha = function(movie) {
      var alphaTransform, colorTransform, colorTransformId, _ref;
      colorTransformId = (_ref = movie.colorTransformId) != null ? _ref : 0;
      if ((colorTransformId & Constant.COLORTRANSFORM_FLAG) === 0) {
        alphaTransform = movie.lwf.data.alphaTransforms[colorTransformId];
        return alphaTransform.alpha;
      } else {
        colorTransformId = colorTransformId & ~Constant.COLORTRANSFORM_FLAG;
        colorTransform = movie.lwf.data.colorTransforms[colorTransformId];
        return colorTransform.alpha;
      }
    };

    Utility.calcMatrixId = function(lwf, dst, src0, src1Id) {
      var matrixId, src1, translate;
      if (src1Id === 0) {
        dst.set(src0);
      } else if ((src1Id & Constant.MATRIX_FLAG) === 0) {
        translate = lwf.data.translates[src1Id];
        dst.scaleX = src0.scaleX;
        dst.skew0 = src0.skew0;
        dst.translateX = src0.scaleX * translate.translateX + src0.skew0 * translate.translateY + src0.translateX;
        dst.skew1 = src0.skew1;
        dst.scaleY = src0.scaleY;
        dst.translateY = src0.skew1 * translate.translateX + src0.scaleY * translate.translateY + src0.translateY;
      } else {
        matrixId = src1Id & ~Constant.MATRIX_FLAG;
        src1 = lwf.data.matrices[matrixId];
        this.calcMatrix(dst, src0, src1);
      }
      return dst;
    };

    Utility.calcMatrix = function(dst, src0, src1) {
      dst.scaleX = src0.scaleX * src1.scaleX + src0.skew0 * src1.skew1;
      dst.skew0 = src0.scaleX * src1.skew0 + src0.skew0 * src1.scaleY;
      dst.translateX = src0.scaleX * src1.translateX + src0.skew0 * src1.translateY + src0.translateX;
      dst.skew1 = src0.skew1 * src1.scaleX + src0.scaleY * src1.skew1;
      dst.scaleY = src0.skew1 * src1.skew0 + src0.scaleY * src1.scaleY;
      dst.translateY = src0.skew1 * src1.translateX + src0.scaleY * src1.translateY + src0.translateY;
      return dst;
    };

    Utility.rotateMatrix = function(dst, src, scale, offsetX, offsetY) {
      offsetX *= scale;
      offsetY *= scale;
      dst.scaleX = -src.skew0 * scale;
      dst.skew0 = src.scaleX * scale;
      dst.translateX = src.scaleX * offsetX + src.skew0 * offsetY + src.translateX;
      dst.skew1 = -src.scaleY * scale;
      dst.scaleY = src.skew1 * scale;
      dst.translateY = src.skew1 * offsetX + src.scaleY * offsetY + src.translateY;
      return dst;
    };

    Utility.scaleMatrix = function(dst, src, scale, offsetX, offsetY) {
      offsetX *= scale;
      offsetY *= scale;
      dst.scaleX = src.scaleX * scale;
      dst.skew0 = src.skew0 * scale;
      dst.translateX = src.scaleX * offsetX + src.skew0 * offsetY + src.translateX;
      dst.skew1 = src.skew1 * scale;
      dst.scaleY = src.scaleY * scale;
      dst.translateY = src.skew1 * offsetX + src.scaleY * offsetY + src.translateY;
      return dst;
    };

    Utility.fitForHeight = function(lwf, stageWidth, stageHeight) {
      var scale;
      scale = stageHeight / lwf.height;
      lwf.scaleByStage = scale;
      lwf.property.scale(scale, scale);
      lwf.property.move((stageWidth - lwf.width * scale) / 2, 0);
    };

    Utility.fitForWidth = function(lwf, stageWidth, stageHeight) {
      var scale;
      scale = stageWidth / lwf.width;
      lwf.scaleByStage = scale;
      lwf.property.scale(scale, scale);
      lwf.property.move(0, (stageHeight - lwf.height * scale) / 2, 0);
    };

    Utility.scaleForHeight = function(lwf, stageHeight) {
      var scale;
      scale = stageHeight / lwf.height;
      lwf.scaleByStage = scale;
      lwf.property.scale(scale, scale);
    };

    Utility.scaleForWidth = function(lwf, stageWidth) {
      var scale;
      scale = stageWidth / lwf.width;
      lwf.scaleByStage = scale;
      lwf.property.scale(scale, scale);
    };

    Utility.copyMatrix = function(dst, src) {
      if (src !== null) {
        dst.set(src);
      } else {
        dst.clear();
      }
      return dst;
    };

    Utility.invertMatrix = function(dst, src) {
      var dt;
      dt = src.scaleX * src.scaleY - src.skew0 * src.skew1;
      if (dt !== 0) {
        dst.scaleX = src.scaleY / dt;
        dst.skew0 = -src.skew0 / dt;
        dst.translateX = (src.skew0 * src.translateY - src.translateX * src.scaleY) / dt;
        dst.skew1 = -src.skew1 / dt;
        dst.scaleY = src.scaleX / dt;
        dst.translateY = (src.translateX * src.skew1 - src.scaleX * src.translateY) / dt;
      } else {
        dst.clear();
      }
    };

    Utility.calcColorTransformId = function(lwf, dst, src0, src1Id) {
      var alphaTransform, colorTransformId, src1;
      if (src1Id === 0) {
        dst.set(src0);
      } else if ((src1Id & Constant.COLORTRANSFORM_FLAG) === 0) {
        alphaTransform = lwf.data.alphaTransforms[src1Id];
        dst.multi.red = src0.multi.red;
        dst.multi.green = src0.multi.green;
        dst.multi.blue = src0.multi.blue;
        dst.multi.alpha = src0.multi.alpha * alphaTransform.alpha;
      } else {
        colorTransformId = src1Id & ~Constant.COLORTRANSFORM_FLAG;
        src1 = lwf.data.colorTransforms[colorTransformId];
        this.calcColorTransform(dst, src0, src1);
      }
      return dst;
    };

    Utility.calcColorTransform = function(dst, src0, src1) {
      dst.multi.red = src0.multi.red * src1.multi.red;
      dst.multi.green = src0.multi.green * src1.multi.green;
      dst.multi.blue = src0.multi.blue * src1.multi.blue;
      dst.multi.alpha = src0.multi.alpha * src1.multi.alpha;
      return dst;
    };

    Utility.copyColorTransform = function(dst, src) {
      if (src !== null) {
        dst.set(src);
      } else {
        dst.clear();
      }
      return dst;
    };

    Utility.calcColor = function(dst, c, t) {
      dst.red = c.red * t.multi.red;
      dst.green = c.green * t.multi.green;
      dst.blue = c.blue * t.multi.blue;
      dst.alpha = c.alpha * t.multi.alpha;
    };

    return Utility;

  })();

  NullRendererFactory = (function() {

    function NullRendererFactory() {}

    NullRendererFactory.prototype.constructBitmap = function(lwf, objId, bitmap) {
      return null;
    };

    NullRendererFactory.prototype.constructBitmapEx = function(lwf, objId, bitmapEx) {
      return null;
    };

    NullRendererFactory.prototype.constructText = function(lwf, objId, text) {
      return null;
    };

    NullRendererFactory.prototype.constructParticle = function(lwf, objId, particle) {
      return null;
    };

    NullRendererFactory.prototype.init = function(lwf) {};

    NullRendererFactory.prototype.beginRender = function(lwf) {};

    NullRendererFactory.prototype.endRender = function(lwf) {};

    NullRendererFactory.prototype.destruct = function() {};

    return NullRendererFactory;

  })();

  LObject = (function() {

    function LObject(lwf, parent, type, objectId) {
      this.lwf = lwf;
      this.parent = parent;
      this.type = type;
      this.objectId = objectId;
      this.matrixId = null;
      this.colorTransformId = null;
      this.matrixIdChanged = true;
      this.colorTransformIdChanged = true;
      this.matrix = new Matrix(0, 0, 0, 0, 0, 0);
      this.colorTransform = new ColorTransform(0, 0, 0, 0);
      this.execCount = 0;
      this.updated = false;
      this.isButton = this.type === Type.BUTTON;
      this.isMovie = this.type === Type.MOVIE || this.type === Type.ATTACHEDMOVIE;
      this.isParticle = this.type === Type.PARTICLE;
      this.isProgramObject = this.type === Type.PROGRAMOBJECT;
      this.isText = this.type === Type.TEXT;
    }

    LObject.prototype.exec = function(matrixId, colorTransformId) {
      if (matrixId == null) {
        matrixId = 0;
      }
      if (colorTransformId == null) {
        colorTransformId = 0;
      }
      this.matrixIdChanged = this.matrixId !== matrixId;
      this.matrixId = matrixId;
      this.colorTransformIdChanged = this.colorTransformId !== colorTransformId;
      this.colorTransformId = colorTransformId;
    };

    LObject.prototype.update = function(m, c) {
      this.updated = true;
      if (m !== null) {
        Utility.calcMatrixId(this.lwf, this.matrix, m, this.dataMatrixId);
      }
      if (c !== null) {
        Utility.copyColorTransform(this.colorTransform, c);
      }
      this.lwf.renderObject();
    };

    LObject.prototype.render = function(v, rOffset) {
      var rCount, rIndex, rIndexOffsetted;
      if (this.renderer != null) {
        rIndex = this.lwf.renderingIndex;
        rIndexOffsetted = this.lwf.renderingIndexOffsetted;
        rCount = this.lwf.renderingCount;
        if (rOffset !== Number.MIN_VALUE) {
          rIndex = rIndexOffsetted - rOffset + rCount;
        }
        this.renderer.render(this.matrix, this.colorTransform, rIndex, rCount, v);
      }
      this.lwf.renderObject();
    };

    LObject.prototype.inspect = function(inspector, hierarchy, depth, rOffset) {
      var rCount, rIndex, rIndexOffsetted;
      rIndex = this.lwf.renderingIndex;
      rIndexOffsetted = this.lwf.renderingIndexOffsetted;
      rCount = this.lwf.renderingCount;
      if (rOffset !== Number.MIN_VALUE) {
        rIndex = rIndexOffsetted + rOffset + rCount;
      }
      inspector(this, hierarchy, depth, rIndex);
      this.lwf.renderObject();
    };

    LObject.prototype.destroy = function() {
      if (this.renderer) {
        this.renderer.destruct();
        this.renderer = null;
      }
      this.parent = null;
      this.lwf = null;
    };

    return LObject;

  })();

  Graphic = (function(_super) {

    __extends(Graphic, _super);

    function Graphic(lwf, parent, objId) {
      var data, gobj, graphicObjectId, graphicObjects, i, n, obj, _i;
      Graphic.__super__.constructor.call(this, lwf, parent, Type.GRAPHIC, objId);
      data = lwf.data.graphics[objId];
      n = data.graphicObjects;
      this.displayList = [];
      graphicObjects = lwf.data.graphicObjects;
      for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
        gobj = graphicObjects[data.graphicObjectId + i];
        graphicObjectId = gobj.graphicObjectId;
        if (graphicObjectId === -1) {
          continue;
        }
        switch (gobj.graphicObjectType) {
          case GObjType.BITMAP:
            obj = new Bitmap(lwf, parent, graphicObjectId);
            break;
          case GObjType.BITMAPEX:
            obj = new BitmapEx(lwf, parent, graphicObjectId);
            break;
          case GObjType.TEXT:
            obj = new Text(lwf, parent, graphicObjectId);
        }
        obj.exec();
        this.displayList[i] = obj;
      }
    }

    Graphic.prototype.update = function(m, c) {
      var obj, _i, _len, _ref;
      _ref = this.displayList;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        obj.update(m, c);
      }
    };

    Graphic.prototype.render = function(v, rOffset) {
      var obj, _i, _len, _ref;
      if (!v) {
        return;
      }
      _ref = this.displayList;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        obj.render(v, rOffset);
      }
    };

    Graphic.prototype.destroy = function() {
      var obj, _i, _len, _ref;
      _ref = this.displayList;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        obj.destroy();
      }
      this.displayList = null;
    };

    return Graphic;

  })(LObject);

  Bitmap = (function(_super) {

    __extends(Bitmap, _super);

    function Bitmap(lwf, parent, objId) {
      Bitmap.__super__.constructor.call(this, lwf, parent, Type.BITMAP, objId);
      this.dataMatrixId = lwf.data.bitmaps[objId].matrixId;
      this.renderer = lwf.rendererFactory.constructBitmap(lwf, objId, this);
    }

    return Bitmap;

  })(LObject);

  BitmapEx = (function(_super) {

    __extends(BitmapEx, _super);

    function BitmapEx(lwf, parent, objId) {
      BitmapEx.__super__.constructor.call(this, lwf, parent, Type.BITMAPEX, objId);
      this.dataMatrixId = lwf.data.bitmapExs[objId].matrixId;
      this.renderer = lwf.rendererFactory.constructBitmapEx(lwf, objId, this);
    }

    return BitmapEx;

  })(LObject);

  Text = (function(_super) {

    __extends(Text, _super);

    function Text(lwf, parent, objId) {
      Text.__super__.constructor.call(this, lwf, parent, Type.TEXT, objId);
      this.dataMatrixId = lwf.data.texts[objId].matrixId;
      this.renderer = lwf.rendererFactory.constructText(lwf, objId, this);
    }

    return Text;

  })(LObject);

  Particle = (function(_super) {

    __extends(Particle, _super);

    function Particle(lwf, parent, objId) {
      Particle.__super__.constructor.call(this, lwf, parent, Type.PARTICLE, objId);
      this.dataMatrixId = lwf.data.particles[objId].matrixId;
      this.renderer = lwf.rendererFactory.constructParticle(lwf, objId, this);
    }

    Particle.prototype.update = function(m, c) {
      Particle.__super__.update.call(this, m, c);
      if (this.renderer != null) {
        this.renderer.update(this.matrix, this.colorTransform);
      }
    };

    return Particle;

  })(LObject);

  ProgramObject = (function(_super) {

    __extends(ProgramObject, _super);

    function ProgramObject(lwf, parent, objId) {
      var ctor, data;
      ProgramObject.__super__.constructor.call(this, lwf, parent, Type.PROGRAMOBJECT, objId);
      data = lwf.data.programObjects[objId];
      this.dataMatrixId = data.matrixId;
      ctor = lwf.getProgramObjectConstructor(objId);
      if (ctor != null) {
        this.renderer = ctor(this, objId, data.width, data.height);
      }
    }

    ProgramObject.prototype.update = function(m, c) {
      ProgramObject.__super__.update.call(this, m, c);
      if (this.renderer != null) {
        this.renderer.update(this.matrix, this.colorTransform);
      }
    };

    return ProgramObject;

  })(LObject);

  IObject = (function(_super) {

    __extends(IObject, _super);

    function IObject(lwf, parent, type, objId, instId) {
      var head, stringId;
      IObject.__super__.constructor.call(this, lwf, parent, type, objId);
      this.prevInstance = null;
      this.nextInstance = null;
      this.linkInstance = null;
      this.instanceId = instId >= lwf.data.instanceNames.length ? -1 : instId;
      if (this.instanceId >= 0) {
        stringId = lwf.getInstanceNameStringId(this.instanceId);
        if (stringId !== -1) {
          this.name = lwf.data.strings[stringId];
          if (parent != null) {
            parent[this.name] = this;
          }
        }
        head = this.lwf.getInstance(this.instanceId);
        if (head != null) {
          head.prevInstance = this;
        }
        this.nextInstance = head;
        this.lwf.setInstance(this.instanceId, this);
      }
    }

    IObject.prototype.destroy = function() {
      var head;
      if (this.type !== Type.ATTACHEDMOVIE && this.instanceId >= 0) {
        head = this.lwf.getInstance(this.instanceId);
        if (head === this) {
          this.lwf.setInstance(this.instanceId, this.nextInstance);
        }
        if (this.nextInstance != null) {
          this.nextInstance.prevInstance = this.prevInstance;
        }
        if (this.prevInstance != null) {
          this.prevInstance.nextInstance = this.nextInstance;
        }
      }
      if ((this.name != null) && (typeof parent !== "undefined" && parent !== null)) {
        delete parent[this.name];
      }
      this.prevInstance = null;
      this.nextInstance = null;
      this.linkInstance = null;
      return IObject.__super__.destroy.apply(this, arguments);
    };

    IObject.prototype.linkButton = function() {};

    IObject.prototype.getFullName = function() {
      var fullPath, o, splitter;
      fullPath = "";
      splitter = "";
      o = this;
      while (o != null) {
        if (o.name == null) {
          return null;
        }
        fullPath = o.name + splitter + fullPath;
        splitter = ".";
        o = o.parent;
      }
      return fullPath;
    };

    return IObject;

  })(LObject);

  Button = (function(_super) {

    __extends(Button, _super);

    function Button(lwf, parent, objId, instId, matrixId, colorTransformId) {
      if (matrixId == null) {
        matrixId = null;
      }
      if (colorTransformId == null) {
        colorTransformId = null;
      }
      Button.__super__.constructor.call(this, lwf, parent, Type.BUTTON, objId, instId);
      this.matrixId = matrixId;
      this.colorTransformId = colorTransformId;
      this.invert = new Matrix();
      this.hitX = Number.MIN_VALUE;
      this.hitY = Number.MIN_VALUE;
      if (objId >= 0) {
        this.data = lwf.data.buttons[objId];
        this.dataMatrixId = this.data.matrixId;
        this.width = this.data.width;
        this.height = this.data.height;
      } else {
        this.width = 0;
        this.height = 0;
      }
      this.handler = lwf.getButtonEventHandlers(this);
      if (this.handler != null) {
        this.handler.call("load", this);
      }
    }

    Button.prototype.setHandlers = function(handler) {
      this.handler = handler;
    };

    Button.prototype.exec = function(matrixId, colorTransformId) {
      if (matrixId == null) {
        matrixId = 0;
      }
      if (colorTransformId == null) {
        colorTransformId = 0;
      }
      Button.__super__.exec.call(this, matrixId, colorTransformId);
      this.enterFrame();
    };

    Button.prototype.update = function(m, c) {
      Button.__super__.update.call(this, m, c);
      if (this.handler != null) {
        this.handler.call("update", this);
      }
    };

    Button.prototype.render = function(v, rOffset) {
      if (this.handler != null) {
        this.handler.call("render", this);
      }
    };

    Button.prototype.destroy = function() {
      this.lwf.clearFocus(this);
      if (this.handler != null) {
        this.handler.call("unload", this);
      }
      Button.__super__.destroy.apply(this, arguments);
    };

    Button.prototype.linkButton = function() {
      this.buttonLink = this.lwf.buttonHead;
      this.lwf.buttonHead = this;
    };

    Button.prototype.checkHit = function(px, py) {
      var x, y, _ref;
      Utility.invertMatrix(this.invert, this.matrix);
      _ref = Utility.calcMatrixToPoint(px, py, this.invert), x = _ref[0], y = _ref[1];
      if (x >= 0 && x < this.data.width && y >= 0 && y < this.data.height) {
        this.hitX = x;
        this.hitY = y;
        return true;
      } else {
        this.hitX = Number.MIN_VALUE;
        this.hitY = Number.MIN_VALUE;
        return false;
      }
    };

    Button.prototype.enterFrame = function() {
      if (this.handler != null) {
        this.handler.call("enterFrame", this);
      }
    };

    Button.prototype.rollOver = function() {
      if (this.handler != null) {
        this.handler.call("rollOver", this);
      }
      this.playAnimation(Condition.ROLLOVER);
    };

    Button.prototype.rollOut = function() {
      if (this.handler != null) {
        this.handler.call("rollOut", this);
      }
      this.playAnimation(Condition.ROLLOUT);
    };

    Button.prototype.press = function() {
      if (this.handler != null) {
        this.handler.call("press", this);
      }
      this.playAnimation(Condition.PRESS);
    };

    Button.prototype.release = function() {
      if (this.handler != null) {
        this.handler.call("release", this);
      }
      this.playAnimation(Condition.RELEASE);
    };

    Button.prototype.keyPress = function() {
      if (this.handler != null) {
        this.handler.call("keyPress", this);
      }
      this.playAnimation(Condition.KEYPRESS, code);
    };

    Button.prototype.playAnimation = function(condition, code) {
      var c, conditions, i, _i, _ref;
      if (code == null) {
        code = 0;
      }
      conditions = this.lwf.data.buttonConditions;
      for (i = _i = 0, _ref = this.data.conditions; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        c = conditions[this.data.conditionId + i];
        if ((c.condition & condition) !== 0 && (condition !== Condition.KEYPRESS || c.keyCode === code)) {
          this.lwf.playAnimation(c.animationId, this.parent, this);
        }
      }
    };

    return Button;

  })(IObject);

  LWFContainer = (function(_super) {

    __extends(LWFContainer, _super);

    function LWFContainer(parent, child) {
      this.parent = parent;
      this.child = child;
      this.lwf = this.parent.lwf;
    }

    LWFContainer.prototype.checkHit = function(px, py) {
      var button;
      button = this.child.inputPoint(px, py);
      if (button !== null) {
        return true;
      } else {
        return false;
      }
    };

    LWFContainer.prototype.rollOver = function() {};

    LWFContainer.prototype.rollOut = function() {
      if (this.child.focus != null) {
        this.child.focus.rollOut();
        this.child.clearFocus(this.child.focus);
      }
    };

    LWFContainer.prototype.press = function() {
      this.child.inputPress();
    };

    LWFContainer.prototype.release = function() {
      this.child.inputRelease();
    };

    LWFContainer.prototype.keyPress = function(code) {
      this.child.inputKeyPress(code);
    };

    return LWFContainer;

  })(Button);

  Property = (function() {

    function Property(lwf) {
      this.lwf = lwf;
      this.matrix = new Matrix;
      this.colorTransform = new ColorTransform;
      this.scaleX = 1;
      this.scaleY = 1;
      this.rotation = 0;
      this.hasMatrix = false;
      this.hasColorTransform = false;
      this.clearRenderingOffset();
    }

    Property.prototype.clear = function() {
      this.scaleX = 1;
      this.scaleY = 1;
      this.rotation = 0;
      this.matrix.clear();
      this.colorTransform.clear();
      if (this.hasMatrix || this.hasColorTransform) {
        this.lwf.setPropertyDirty();
      }
      this.hasMatrix = false;
      this.hasColorTransform = false;
      this.clearRenderingOffset();
    };

    Property.prototype.move = function(x, y) {
      this.matrix.translateX += x;
      this.matrix.translateY += y;
      this.hasMatrix = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.moveTo = function(x, y) {
      this.matrix.translateX = x;
      this.matrix.translateY = y;
      this.hasMatrix = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.rotate = function(degree) {
      this.rotateTo(this.rotation + degree);
    };

    Property.prototype.rotateTo = function(degree) {
      this.rotation = degree;
      this.setScaleAndRotation();
    };

    Property.prototype.scale = function(x, y) {
      this.scaleX *= x;
      this.scaleY *= y;
      this.setScaleAndRotation();
    };

    Property.prototype.scaleTo = function(x, y) {
      this.scaleX = x;
      this.scaleY = y;
      this.setScaleAndRotation();
    };

    Property.prototype.setScaleAndRotation = function() {
      var c, radian, s;
      radian = this.rotation * Math.PI / 180;
      c = Math.cos(radian);
      s = Math.sin(radian);
      this.matrix.scaleX = this.scaleX * c;
      this.matrix.skew0 = this.scaleY * -s;
      this.matrix.skew1 = this.scaleX * s;
      this.matrix.scaleY = this.scaleY * c;
      this.hasMatrix = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.setMatrix = function(m, scaleX, scaleY, rotation) {
      this.scaleX = scaleX != null ? scaleX : 1;
      this.scaleY = scaleY != null ? scaleY : 1;
      this.rotation = rotation != null ? rotation : 0;
      this.matrix.set(m);
      this.hasMatrix = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.setAlpha = function(alpha) {
      this.colorTransform.multi.alpha = alpha;
      this.hasColorTransform = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.setColorTransform = function(c) {
      this.colorTransform.set(c);
      this.hasColorTransform = true;
      this.lwf.setPropertyDirty();
    };

    Property.prototype.setRenderingOffset = function(rOffset) {
      this.renderingOffset = rOffset;
      this.hasRenderingOffset = true;
    };

    Property.prototype.clearRenderingOffset = function() {
      this.renderingOffset = Number.MIN_VALUE;
      this.hasRenderingOffset = false;
    };

    return Property;

  })();

  Movie = (function(_super) {

    __extends(Movie, _super);

    function Movie(lwf, parent, objId, instId, matrixId, colorTransformId, attached, handler) {
      var func, type, _ref;
      if (matrixId == null) {
        matrixId = null;
      }
      if (colorTransformId == null) {
        colorTransformId = null;
      }
      if (attached == null) {
        attached = false;
      }
      if (handler == null) {
        handler = null;
      }
      type = attached ? Type.ATTACHEDMOVIE : Type.MOVIE;
      Movie.__super__.constructor.call(this, lwf, parent, type, objId, instId);
      this.matrixId = matrixId;
      this.colorTransformId = colorTransformId;
      this.data = lwf.data.movies[objId];
      this.totalFrames = this.data.frames;
      this.instanceHead = null;
      this.instanceTail = null;
      this.currentFrameInternal = -1;
      this.execedFrame = -1;
      this.animationPlayedFrame = -1;
      this.lastControlOffset = -1;
      this.lastControls = -1;
      this.lastHasButton = false;
      this.lastControlAnimationOffset = -1;
      this.skipped = false;
      this.postLoaded = false;
      this.active = true;
      this.visible = true;
      this.playing = true;
      this.jumped = false;
      this.overriding = false;
      this.attachMovieExeced = false;
      this.attachMoviePostExeced = false;
      this.movieExecCount = -1;
      this.postExecCount = -1;
      this.property = new Property(lwf);
      if (typeof this.__defineGetter__ !== "undefined") {
        this.__defineGetter__("x", function() {
          return this.getX();
        });
        this.__defineSetter__("x", function(v) {
          return this.setX(v);
        });
        this.__defineGetter__("y", function() {
          return this.getY();
        });
        this.__defineSetter__("y", function(v) {
          return this.setY(v);
        });
        this.__defineGetter__("scaleX", function() {
          return this.getScaleX();
        });
        this.__defineSetter__("scaleX", function(v) {
          return this.setScaleX(v);
        });
        this.__defineGetter__("scaleY", function() {
          return this.getScaleY();
        });
        this.__defineSetter__("scaleY", function(v) {
          return this.setScaleY(v);
        });
        this.__defineGetter__("rotation", function() {
          return this.getRotation();
        });
        this.__defineSetter__("rotation", function(v) {
          return this.setRotation(v);
        });
        this.__defineGetter__("alpha", function() {
          return this.getAlphaProperty();
        });
        this.__defineSetter__("alpha", function(v) {
          return this.setAlphaProperty(v);
        });
        this.__defineGetter__("currentFrame", function() {
          return this.currentFrameInternal + 1;
        });
      } else if (typeof Object.defineProperty !== "undefined") {
        Object.defineProperty(this, "x", {
          get: function() {
            return this.getX();
          },
          set: function(v) {
            return this.setX(v);
          }
        });
        Object.defineProperty(this, "y", {
          get: function() {
            return this.getY();
          },
          set: function(v) {
            return this.setY(v);
          }
        });
        Object.defineProperty(this, "scaleX", {
          get: function() {
            return this.getScaleX();
          },
          set: function(v) {
            return this.setScaleX(v);
          }
        });
        Object.defineProperty(this, "scaleY", {
          get: function() {
            return this.getScaleY();
          },
          set: function(v) {
            return this.setScaleY(v);
          }
        });
        Object.defineProperty(this, "rotation", {
          get: function() {
            return this.getRotation();
          },
          set: function(v) {
            return this.setRotation(v);
          }
        });
        Object.defineProperty(this, "alpha", {
          get: function() {
            return this.getAlphaProperty();
          },
          set: function(v) {
            return this.setAlphaProperty(v);
          }
        });
        Object.defineProperty(this, "currentFrame", {
          get: function() {
            return this.currentFrameInternal + 1;
          }
        });
      }
      this.matrix0 = new Matrix;
      this.matrix1 = new Matrix;
      this.colorTransform0 = new ColorTransform;
      this.colorTransform1 = new ColorTransform;
      this.displayList = [];
      this.attachName = null;
      this.depth = null;
      this.hasButton = false;
      this.getMovieFunctions();
      if (objId === this.lwf.data.header.rootMovieId) {
        func = (_ref = this.lwf.functions) != null ? _ref['init'] : void 0;
        if (func != null) {
          func.call(this);
        }
      }
      if (this.loadFunc != null) {
        this.loadFunc.call(this);
      }
      this.playAnimation(ClipEvent.LOAD);
      this.handler = handler != null ? handler : lwf.getMovieEventHandlers(this);
      if (this.handler != null) {
        this.handler.call("load", this);
      }
      lwf.execMovieCommand();
    }

    Movie.prototype.getMovieFunctions = function() {
      var _ref;
      _ref = this.lwf.getMovieFunctions(this.objectId), this.loadFunc = _ref[0], this.postLoadFunc = _ref[1], this.unloadFunc = _ref[2], this.enterFrameFunc = _ref[3];
    };

    Movie.prototype.setHandlers = function(handler) {
      this.handler = handler;
    };

    Movie.prototype.play = function() {
      this.playing = true;
      return this;
    };

    Movie.prototype.stop = function() {
      this.playing = false;
      return this;
    };

    Movie.prototype.gotoNextFrame = function() {
      this.jumped = true;
      this.stop();
      ++this.currentFrameInternal;
      return this;
    };

    Movie.prototype.gotoPrevFrame = function() {
      this.jumped = true;
      this.stop();
      --this.currentFrameInternal;
      return this;
    };

    Movie.prototype.gotoFrame = function(frameNo) {
      return this.gotoFrameInternal(frameNo - 1);
    };

    Movie.prototype.gotoFrameInternal = function(frameNo) {
      this.jumped = true;
      this.stop();
      this.currentFrameInternal = frameNo;
      return this;
    };

    Movie.prototype.setVisible = function(visible) {
      this.visible = visible;
      return this;
    };

    Movie.prototype.globalToLocal = function(point) {
      var invert, x, y, _ref;
      invert = new Matrix();
      Utility.invertMatrix(invert, this.matrix);
      _ref = Utility.calcMatrixToPoint(point.x, point.y, invert), x = _ref[0], y = _ref[1];
      return new Point(x, y);
    };

    Movie.prototype.localToGlobal = function(point) {
      var x, y, _ref;
      _ref = Utility.calcMatrixToPoint(point.x, point.y, this.matrix), x = _ref[0], y = _ref[1];
      return new Point(x, y);
    };

    Movie.prototype.shrinkList = function(list) {
      var i, _i, _ref;
      for (i = _i = _ref = list.length - 1; _ref <= 0 ? _i <= 0 : _i >= 0; i = _ref <= 0 ? ++_i : --_i) {
        if (list[i] != null) {
          if (i === list.length - 1) {
            return list;
          } else {
            return list.slice(0, +i + 1 || 9e9);
          }
        }
      }
      return [];
    };

    Movie.prototype.reorderList = function(reorder, list, index, object, op) {
      var i, _results;
      if (!reorder || index >= list.length) {
        list[index] = object;
      } else {
        list.splice(index, 0, object);
      }
      if (reorder) {
        i = 0;
        _results = [];
        while (i < list.length) {
          if (list[i] != null) {
            op(list[i], i);
            _results.push(i += 1);
          } else {
            _results.push(list.splice(i, 1));
          }
        }
        return _results;
      }
    };

    Movie.prototype.deleteAttachedMovie = function(parent, movie, destroy, deleteFromDetachedMovies) {
      var attachName, depth;
      if (destroy == null) {
        destroy = true;
      }
      if (deleteFromDetachedMovies == null) {
        deleteFromDetachedMovies = true;
      }
      attachName = movie.attachName;
      depth = movie.depth;
      delete parent.attachedMovies[attachName];
      delete parent.attachedMovieList[depth];
      if (deleteFromDetachedMovies) {
        delete parent.detachedMovies[attachName];
      }
      delete parent[attachName];
      parent.attachedMovieList = this.shrinkList(parent.attachedMovieList);
      if (destroy) {
        return movie.destroy();
      }
    };

    Movie.prototype.attachMovie = function(linkageName, attachName, options) {
      var attachedMovie, depth, enterFrame, handlers, load, movie, movieId, postLoad, render, reorder, unload, update, _ref;
      if (options == null) {
        options = null;
      }
      if (options == null) {
        options = {};
      }
      depth = options["depth"];
      reorder = (_ref = options["reorder"]) != null ? _ref : false;
      load = options["load"];
      postLoad = options["postLoad"];
      unload = options["unload"];
      enterFrame = options["enterFrame"];
      update = options["update"];
      render = options["render"];
      if (linkageName instanceof Movie && linkageName.lwf === this.lwf) {
        movie = linkageName;
        this.deleteAttachedMovie(movie.parent, movie, false);
      } else if (typeof linkageName === "string") {
        movieId = this.lwf.searchMovieLinkage(this.lwf.getStringId(linkageName));
        if (movieId === -1) {
          return null;
        }
      } else {
        return null;
      }
      if (this.attachedMovies == null) {
        this.attachedMovies = {};
        this.detachedMovies = {};
        this.attachedMovieList = [];
      }
      attachedMovie = this.attachedMovies[attachName];
      if (attachedMovie != null) {
        this.deleteAttachedMovie(this, attachedMovie);
      }
      if (!reorder) {
        attachedMovie = this.attachedMovieList[depth];
        if (attachedMovie != null) {
          this.deleteAttachedMovie(this, attachedMovie);
        }
      }
      handlers = new MovieEventHandlers(load, postLoad, unload, enterFrame, update, render);
      if (movie != null) {
        movie.setHandlers(handler);
      } else {
        movie = new Movie(this.lwf, this, movieId, -1, 0, 0, true, handlers);
        if (this.attachMovieExeced) {
          movie.exec();
        }
        if (this.attachMoviePostExeced) {
          movie.postExec(true);
        }
      }
      movie.attachName = attachName;
      movie.depth = depth != null ? depth : this.attachedMovieList.length;
      movie.name = attachName;
      this.attachedMovies[attachName] = movie;
      this.reorderList(reorder, this.attachedMovieList, movie.depth, movie, function(o, i) {
        return o.depth = i;
      });
      this[attachName] = movie;
      return movie;
    };

    Movie.prototype.swapAttachedMovieDepth = function(depth0, depth1) {
      var attachedMovie0, attachedMovie1;
      if (this.attachedMovies == null) {
        return;
      }
      attachedMovie0 = this.attachedMovieList[depth0];
      attachedMovie1 = this.attachedMovieList[depth1];
      if (attachedMovie0 != null) {
        attachedMovie0.depth = depth1;
      }
      if (attachedMovie1 != null) {
        attachedMovie1.depth = depth0;
      }
      this.attachedMovieList[depth0] = attachedMovie1;
      this.attachedMovieList[depth1] = attachedMovie0;
    };

    Movie.prototype.getAttachedMovie = function(attachName) {
      var depth;
      if (this.attachedMovies == null) {
        return null;
      }
      switch (typeof attachName) {
        case "string":
          return this.attachedMovies[attachName];
        case "number":
          depth = attachName;
          return this.attachedMovieList[depth];
      }
    };

    Movie.prototype.searchAttachedMovie = function(attachName, recursive) {
      var i, instance, movie;
      if (recursive == null) {
        recursive = true;
      }
      movie = this.getAttachedMovie(attachName);
      if (movie != null) {
        return movie;
      }
      if (!recursive) {
        return null;
      }
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isMovie) {
          i = instance.searchAttachedMovie(attachName, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.detachMovie = function(arg) {
      var attachedMovie, _ref;
      if (this.detachedMovies != null) {
        switch (typeof arg) {
          case "string":
            this.detachedMovies[arg] = true;
            break;
          case "number":
            attachedMovie = (_ref = this.attachedMovieList) != null ? _ref[arg] : void 0;
            if ((attachedMovie != null ? attachedMovie.attachName : void 0) != null) {
              this.detachedMovies[attachedMovie.attachName] = true;
            }
            break;
          case typeof Movie:
            if ((arg != null ? arg.attachName : void 0) != null) {
              this.detachedMovies[arg.attachName] = true;
            }
        }
      }
    };

    Movie.prototype.detachFromParent = function() {
      if (this.type !== Type.ATTACHEDMOVIE) {
        return;
      }
      this.active = false;
      if (this.parent != null) {
        this.parent.detachMovie(this);
      }
    };

    Movie.prototype.execDetachHandler = function(lwfContainer) {
      var lwf;
      lwf = lwfContainer.child;
      if (lwf.detachHandler != null) {
        if (lwf.detachHandler(lwf)) {
          lwf.destroy();
        }
      } else {
        lwf.destroy();
      }
      lwf.parent = null;
      lwf.detachHandler = null;
      lwf.attachName = null;
    };

    Movie.prototype.deleteAttachedLWF = function(parent, lwfContainer, destroy, deleteFromDetachedLWFs) {
      var attachName, depth;
      if (destroy == null) {
        destroy = true;
      }
      if (deleteFromDetachedLWFs == null) {
        deleteFromDetachedLWFs = true;
      }
      attachName = lwfContainer.child.attachName;
      depth = lwfContainer.child.depth;
      delete parent.attachedLWFs[attachName];
      delete parent.attachedLWFList[depth];
      if (deleteFromDetachedLWFs) {
        delete parent.detachedLWFs[attachName];
      }
      delete parent[attachName];
      parent.attachedLWFList = this.shrinkList(parent.attachedLWFList);
      if (destroy) {
        return this.execDetachHandler(lwfContainer);
      }
    };

    Movie.prototype.attachLWF = function(attachLWF, attachName, options) {
      var depth, detachHandler, lwfContainer, reorder, _ref;
      if (options == null) {
        options = null;
      }
      if (options == null) {
        options = {};
      }
      depth = options["depth"];
      reorder = (_ref = options["reorder"]) != null ? _ref : false;
      detachHandler = options["detach"];
      if (this.attachedLWFs == null) {
        this.attachedLWFs = {};
        this.detachedLWFs = {};
        this.attachedLWFList = [];
      }
      if (attachLWF.parent != null) {
        lwfContainer = attachLWF.parent.attachedLWFs[attachLWF.attachName];
        this.deleteAttachedLWF(attachLWF.parent, lwfContainer, false);
      }
      lwfContainer = this.attachedLWFs[attachName];
      if (lwfContainer != null) {
        this.deleteAttachedLWF(this, lwfContainer);
      }
      if (!reorder) {
        lwfContainer = this.attachedLWFList[depth];
        if (lwfContainer != null) {
          this.deleteAttachedLWF(this, lwfContainer);
        }
      }
      lwfContainer = new LWFContainer(this, attachLWF);
      if (attachLWF.interactive) {
        this.lwf.interactive = true;
      }
      attachLWF.parent = this;
      attachLWF.detachHandler = detachHandler;
      attachLWF.attachName = attachName;
      attachLWF.depth = depth != null ? depth : this.attachedLWFList.length;
      this.attachedLWFs[attachName] = lwfContainer;
      this.reorderList(reorder, this.attachedLWFList, attachLWF.depth, lwfContainer, function(o, i) {
        return o.child.depth = i;
      });
      this[attachName] = attachLWF.rootMovie;
      this.lwf.isLWFAttached = true;
    };

    Movie.prototype.swapAttachedLWFDepth = function(depth0, depth1) {
      var attachedLWF0, attachedLWF1;
      if (this.attachedLWFs == null) {
        return;
      }
      attachedLWF0 = this.attachedLWFList[depth0];
      attachedLWF1 = this.attachedLWFList[depth1];
      if (attachedLWF0 != null) {
        attachedLWF0.child.depth = depth1;
      }
      if (attachedLWF1 != null) {
        attachedLWF1.child.depth = depth0;
      }
      this.attachedLWFList[depth0] = attachedLWF1;
      this.attachedLWFList[depth1] = attachedLWF0;
    };

    Movie.prototype.getAttachedLWF = function(attachName) {
      var depth, _ref, _ref1;
      if (this.attachedLWFs == null) {
        return null;
      }
      switch (typeof attachName) {
        case "string":
          return (_ref = this.attachedLWFs[attachName]) != null ? _ref.child : void 0;
        case "number":
          depth = attachName;
          return (_ref1 = this.attachedLWFList[depth]) != null ? _ref1.child : void 0;
      }
    };

    Movie.prototype.searchAttachedLWF = function(attachName, recursive) {
      var attachedLWF, i, instance;
      if (recursive == null) {
        recursive = true;
      }
      attachedLWF = this.getAttachedLWF(attachName);
      if (attachedLWF != null) {
        return attachedLWF;
      }
      if (!recursive) {
        return null;
      }
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isMovie) {
          i = instance.searchAttachedLWF(attachName, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.detachLWF = function(arg) {
      var attachedLWF, _ref, _ref1;
      if (this.detachedLWFs != null) {
        switch (typeof arg) {
          case "string":
            this.detachedLWFs[arg] = true;
            break;
          case "number":
            attachedLWF = (_ref = this.attachedLWFList) != null ? _ref[arg] : void 0;
            if ((attachedLWF != null ? (_ref1 = attachedLWF.child) != null ? _ref1.attachName : void 0 : void 0) != null) {
              this.detachedLWFs[attachedLWF.child.attachName] = true;
            }
            break;
          case typeof LWF:
            if ((arg != null ? arg.attachName : void 0) != null) {
              this.detachedLWFs[arg.attachName] = true;
            }
        }
      }
    };

    Movie.prototype.detachAllLWFs = function() {
      var k, lwfContainer, _ref;
      if (this.detachedLWFs != null) {
        _ref = this.attachedLWFs;
        for (k in _ref) {
          lwfContainer = _ref[k];
          this.detachedLWFs[lwfContainer.child.attachName] = true;
        }
      }
    };

    Movie.prototype.execObject = function(depth, objId, matrixId, colorTransformId, instId) {
      var data, dataObject, dataObjectId, obj;
      if (objId === -1) {
        return;
      }
      data = this.lwf.data;
      dataObject = data.objects[objId];
      dataObjectId = dataObject.objectId;
      obj = this.displayList[depth];
      if ((obj != null) && (obj.type !== dataObject.objectType || obj.objectId !== dataObjectId || (obj.isMovie && obj.instanceId !== instId))) {
        obj.destroy();
        obj = null;
      }
      if (obj == null) {
        switch (dataObject.objectType) {
          case Type.BUTTON:
            obj = new Button(this.lwf, this, dataObjectId, instId, matrixId, colorTransformId);
            break;
          case Type.GRAPHIC:
            obj = new Graphic(this.lwf, this, dataObjectId);
            break;
          case Type.MOVIE:
            obj = new Movie(this.lwf, this, dataObjectId, instId, matrixId, colorTransformId);
            break;
          case Type.BITMAP:
            obj = new Bitmap(this.lwf, this, dataObjectId);
            break;
          case Type.BITMAPEX:
            obj = new BitmapEx(this.lwf, this, dataObjectId);
            break;
          case Type.TEXT:
            obj = new Text(this.lwf, this, dataObjectId);
            break;
          case Type.PARTICLE:
            obj = new Particle(this.lwf, this, dataObjectId);
            break;
          case Type.PROGRAMOBJECT:
            obj = new ProgramObject(this.lwf, this, dataObjectId);
        }
      }
      if (obj.isMovie || obj.isButton) {
        obj.linkInstance = null;
        if (this.instanceHead === null) {
          this.instanceHead = obj;
        } else {
          this.instanceTail.linkInstance = obj;
        }
        this.instanceTail = obj;
        if (obj.isButton) {
          this.hasButton = true;
        }
      }
      this.displayList[depth] = obj;
      obj.execCount = this.movieExecCount;
      obj.exec(matrixId, colorTransformId);
    };

    Movie.prototype.override = function(m, c) {
      this.overriding = true;
      Utility.copyMatrix(this.matrix, m);
      Utility.copyColorTransform(this.colorTransform, c);
      this.lwf.isPropertyDirty = true;
    };

    Movie.prototype.exec = function(matrixId, colorTransformId) {
      if (matrixId == null) {
        matrixId = 0;
      }
      if (colorTransformId == null) {
        colorTransformId = 0;
      }
      this.attachMovieExeced = false;
      this.attachMoviePostExeced = false;
      Movie.__super__.exec.call(this, matrixId, colorTransformId);
    };

    Movie.prototype.postExec = function(progressing) {
      var animationPlayed, attachName, control, controlAnimationOffset, ctrl, data, depth, frame, i, instance, movie, obj, p, postExeced, v, _i, _j, _k, _l, _len, _len1, _m, _n, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6;
      this.hasButton = false;
      if (!this.active) {
        return;
      }
      this.execedFrame = -1;
      postExeced = this.postExecCount === this.lwf.execCount;
      if (progressing && this.playing && !this.jumped && !postExeced) {
        ++this.currentFrameInternal;
      }
      while (true) {
        if (this.currentFrameInternal < 0 || this.currentFrameInternal >= this.totalFrames) {
          this.currentFrameInternal = 0;
        }
        if (this.currentFrameInternal === this.execedFrame) {
          break;
        }
        this.currentFrameCurrent = this.currentFrameInternal;
        this.execedFrame = this.currentFrameCurrent;
        data = this.lwf.data;
        frame = data.frames[this.data.frameOffset + this.currentFrameCurrent];
        if (this.lastControlOffset === frame.controlOffset && this.lastControls === frame.controls) {
          controlAnimationOffset = this.lastControlAnimationOffset;
          if (this.skipped) {
            instance = this.instanceHead;
            while (instance !== null) {
              if (instance.isMovie) {
                instance.attachMovieExeced = false;
                instance.attachMoviePostExeced = false;
              } else if (instance.isButton) {
                instance.enterFrame();
              }
              instance = instance.linkInstance;
            }
            this.hasButton = this.lastHasButton;
          } else {
            for (depth = _i = 0, _ref = this.data.depths; 0 <= _ref ? _i < _ref : _i > _ref; depth = 0 <= _ref ? ++_i : --_i) {
              obj = this.displayList[depth];
              if (obj != null) {
                if (!postExeced) {
                  obj.matrixIdChanged = false;
                  obj.colorTransformIdChanged = false;
                }
                if (obj.isMovie) {
                  obj.attachMovieExeced = false;
                  obj.attachMoviePostExeced = false;
                } else if (obj.isButton) {
                  obj.enterFrame();
                  this.hasButton = true;
                }
              }
            }
            this.lastHasButton = this.hasButton;
            this.skipped = true;
          }
        } else {
          ++this.movieExecCount;
          this.instanceHead = null;
          this.instanceTail = null;
          this.lastControlOffset = frame.controlOffset;
          this.lastControls = frame.controls;
          controlAnimationOffset = -1;
          for (i = _j = 0, _ref1 = frame.controls; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
            control = data.controls[frame.controlOffset + i];
            switch (control.controlType) {
              case ControlType.MOVE:
                p = data.places[control.controlId];
                this.execObject(p.depth, p.objectId, p.matrixId, 0, p.instanceId);
                break;
              case ControlType.MOVEM:
                ctrl = data.controlMoveMs[control.controlId];
                p = data.places[ctrl.placeId];
                this.execObject(p.depth, p.objectId, ctrl.matrixId, 0, p.instanceId);
                break;
              case ControlType.MOVEC:
                ctrl = data.controlMoveCs[control.controlId];
                p = data.places[ctrl.placeId];
                this.execObject(p.depth, p.objectId, p.matrixId, ctrl.colorTransformId, p.instanceId);
                break;
              case ControlType.MOVEMC:
                ctrl = data.controlMoveMCs[control.controlId];
                p = data.places[ctrl.placeId];
                this.execObject(p.depth, p.objectId, ctrl.matrixId, ctrl.colorTransformId, p.instanceId);
                break;
              case ControlType.ANIMATION:
                if (controlAnimationOffset === -1) {
                  controlAnimationOffset = i;
                }
            }
          }
          this.lastControlAnimationOffset = controlAnimationOffset;
          this.lastHasButton = this.hasButton;
          for (depth = _k = 0, _ref2 = this.data.depths; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; depth = 0 <= _ref2 ? ++_k : --_k) {
            obj = this.displayList[depth];
            if ((obj != null) && obj.execCount !== this.movieExecCount) {
              obj.destroy();
              this.displayList[depth] = null;
            }
          }
        }
        this.attachMovieExeced = true;
        if (this.attachedMovies != null) {
          _ref3 = this.attachedMovieList;
          for (_l = 0, _len = _ref3.length; _l < _len; _l++) {
            movie = _ref3[_l];
            if (movie != null) {
              movie.exec();
            }
          }
        }
        instance = this.instanceHead;
        while (instance !== null) {
          if (instance.isMovie) {
            movie = instance;
            movie.postExec(progressing);
            if (!this.hasButton && movie.hasButton) {
              this.hasButton = true;
            }
          }
          instance = instance.linkInstance;
        }
        this.attachMoviePostExeced = true;
        if (this.attachedMovies != null) {
          _ref4 = this.detachedMovies;
          for (attachName in _ref4) {
            v = _ref4[attachName];
            movie = this.attachedMovies[attachName];
            if (movie != null) {
              this.deleteAttachedMovie(this, movie, true, false);
            }
          }
          this.detachedMovies = {};
          _ref5 = this.attachedMovieList;
          for (_m = 0, _len1 = _ref5.length; _m < _len1; _m++) {
            movie = _ref5[_m];
            if (movie != null) {
              movie.postExec(progressing);
              if (!this.hasButton && movie.hasButton) {
                this.hasButton = true;
              }
            }
          }
        }
        if (this.attachedLWFs != null) {
          this.hasButton = true;
        }
        if (!this.postLoaded) {
          this.postLoaded = true;
          if (this.postLoadFunc != null) {
            this.postLoadFunc.call(this);
          }
          if (this.handler != null) {
            this.handler.call("postLoad", this);
          }
        }
        if (controlAnimationOffset !== -1 && this.execedFrame === this.currentFrameInternal) {
          animationPlayed = this.animationPlayedFrame === this.currentFrameCurrent && !this.jumped;
          if (!animationPlayed) {
            for (i = _n = controlAnimationOffset, _ref6 = frame.controls; controlAnimationOffset <= _ref6 ? _n < _ref6 : _n > _ref6; i = controlAnimationOffset <= _ref6 ? ++_n : --_n) {
              control = data.controls[frame.controlOffset + i];
              this.lwf.playAnimation(control.controlId, this);
            }
          }
        }
        this.animationPlayedFrame = this.currentFrameCurrent;
        if (this.currentFrameCurrent === this.currentFrameInternal) {
          this.jumped = false;
        }
      }
      if (this.enterFrameFunc != null) {
        this.enterFrameFunc.call(this);
      }
      this.playAnimation(ClipEvent.ENTERFRAME);
      if (this.handler != null) {
        this.handler.call("enterFrame", this);
      }
      this.postExecCount = this.lwf.execCount;
    };

    Movie.prototype.updateObject = function(obj, m, c, matrixChanged, colorTransformChanged) {
      var objc, objm;
      if (obj.isMovie && obj.property.hasMatrix) {
        objm = m;
      } else if (matrixChanged || !obj.updated || obj.matrixIdChanged) {
        objm = Utility.calcMatrixId(this.lwf, this.matrix1, m, obj.matrixId);
      } else {
        objm = null;
      }
      if (obj.isMovie && obj.property.hasColorTransform) {
        objc = c;
      } else if (colorTransformChanged || !obj.updated || obj.colorTransformIdChanged) {
        objc = Utility.calcColorTransformId(this.lwf, this.colorTransform1, c, obj.colorTransformId);
      } else {
        objc = null;
      }
      return obj.update(objm, objc);
    };

    Movie.prototype.update = function(m, c) {
      var attachName, colorTransformChanged, depth, lwfContainer, matrixChanged, movie, obj, v, _i, _j, _k, _len, _len1, _ref, _ref1, _ref2, _ref3;
      if (!this.active) {
        return;
      }
      if (this.overriding) {
        matrixChanged = true;
        colorTransformChanged = true;
      } else {
        matrixChanged = this.matrix.setWithComparing(m);
        colorTransformChanged = this.colorTransform.setWithComparing(c);
      }
      if (this.handler != null) {
        this.handler.call("update", this);
      }
      if (this.property.hasMatrix) {
        matrixChanged = true;
        m = Utility.calcMatrix(this.matrix0, this.matrix, this.property.matrix);
      } else {
        m = this.matrix;
      }
      if (this.property.hasColorTransform) {
        colorTransformChanged = true;
        c = Utility.calcColorTransform(this.colorTransform0, this.colorTransform, this.property.colorTransform);
      } else {
        c = this.colorTransform;
      }
      for (depth = _i = 0, _ref = this.data.depths; 0 <= _ref ? _i < _ref : _i > _ref; depth = 0 <= _ref ? ++_i : --_i) {
        obj = this.displayList[depth];
        if (obj != null) {
          this.updateObject(obj, m, c, matrixChanged, colorTransformChanged);
        }
      }
      if ((this.attachedMovies != null) || (this.attachedLWFs != null)) {
        if (this.attachedMovies != null) {
          _ref1 = this.attachedMovieList;
          for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
            movie = _ref1[_j];
            if (movie != null) {
              this.updateObject(movie, m, c, matrixChanged, colorTransformChanged);
            }
          }
        }
        if (this.attachedLWFs != null) {
          _ref2 = this.detachedLWFs;
          for (attachName in _ref2) {
            v = _ref2[attachName];
            lwfContainer = this.attachedLWFs[attachName];
            if (lwfContainer != null) {
              this.deleteAttachedLWF(this, lwfContainer, true, false);
            }
          }
          this.detachedLWFs = {};
          _ref3 = this.attachedLWFList;
          for (_k = 0, _len1 = _ref3.length; _k < _len1; _k++) {
            lwfContainer = _ref3[_k];
            if (lwfContainer != null) {
              this.lwf.renderObject(lwfContainer.child.exec(this.lwf.thisTick, m, c));
            }
          }
        }
      }
    };

    Movie.prototype.linkButton = function() {
      var depth, lwfContainer, movie, obj, _i, _j, _k, _len, _len1, _ref, _ref1, _ref2;
      if (!this.visible || !this.active || !this.hasButton) {
        return;
      }
      if (this.attachedLWFs != null) {
        _ref = this.attachedLWFList;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          lwfContainer = _ref[_i];
          if (lwfContainer != null) {
            lwfContainer.linkButton();
          }
        }
      }
      if (this.attachedMovies != null) {
        _ref1 = this.attachedMovieList;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          movie = _ref1[_j];
          if (movie != null ? movie.hasButton : void 0) {
            movie.linkButton();
          }
        }
      }
      for (depth = _k = 0, _ref2 = this.data.depths; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; depth = 0 <= _ref2 ? ++_k : --_k) {
        obj = this.displayList[depth];
        if (obj != null) {
          if (obj.isButton) {
            obj.linkButton();
          } else if (obj.isMovie) {
            if (obj.hasButton) {
              obj.linkButton();
            }
          }
        }
      }
    };

    Movie.prototype.render = function(v, rOffset) {
      var attachedMovie, child, depth, lwfContainer, obj, _i, _j, _k, _len, _len1, _ref, _ref1, _ref2;
      if (!this.visible || !this.active) {
        v = false;
      }
      if (this.handler != null) {
        this.handler.call("render", this);
      }
      if (this.property.hasRenderingOffset) {
        this.lwf.renderOffset();
        rOffset = this.property.renderingOffset;
      }
      if (rOffset === Number.MIN_VALUE) {
        this.lwf.clearRenderOffset();
      }
      for (depth = _i = 0, _ref = this.data.depths; 0 <= _ref ? _i < _ref : _i > _ref; depth = 0 <= _ref ? ++_i : --_i) {
        obj = this.displayList[depth];
        if (obj != null) {
          obj.render(v, rOffset);
        }
      }
      if (this.attachedMovies != null) {
        _ref1 = this.attachedMovieList;
        for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
          attachedMovie = _ref1[_j];
          if (attachedMovie != null) {
            attachedMovie.render(v, rOffset);
          }
        }
      }
      if (this.attachedLWFs != null) {
        _ref2 = this.attachedLWFList;
        for (_k = 0, _len1 = _ref2.length; _k < _len1; _k++) {
          lwfContainer = _ref2[_k];
          if (lwfContainer != null) {
            child = lwfContainer.child;
            child.setAttachVisible(v);
            this.lwf.renderObject(child.render(this.lwf.renderingIndex, this.lwf.renderingCount, rOffset));
          }
        }
      }
    };

    Movie.prototype.inspect = function(inspector, hierarchy, depth) {
      var attachedMovie, child, d, lwfContainer, obj, rOffset, _i, _j, _k, _len, _len1, _ref, _ref1, _ref2;
      if (this.property.hasRenderingOffset) {
        this.lwf.renderOffset();
        rOffset = this.property.renderingOffset;
      }
      if (rOffset === Number.MIN_VALUE) {
        this.lwf.clearRenderOffset();
      }
      inspector(this, hierarchy, depth, rOffset);
      ++hierarchy;
      for (d = _i = 0, _ref = this.data.depths; 0 <= _ref ? _i < _ref : _i > _ref; d = 0 <= _ref ? ++_i : --_i) {
        obj = this.displayList[d];
        if (obj != null) {
          obj.inspect(inspector, hierarchy, d, rOffset);
        }
      }
      if (this.attachedMovies != null) {
        _ref1 = this.attachedMovieList;
        for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
          attachedMovie = _ref1[_j];
          if (attachedMovie != null) {
            attachedMovie.inspect(inspector, hierarchy, d++, rOffset);
          }
        }
      }
      if (this.attachedLWFs != null) {
        _ref2 = this.attachedLWFList;
        for (_k = 0, _len1 = _ref2.length; _k < _len1; _k++) {
          lwfContainer = _ref2[_k];
          if (lwfContainer != null) {
            child = lwfContainer.child;
            this.lwf.renderObject(child.inspect(inspector, hierarchy, d++, rOffset));
          }
        }
      }
    };

    Movie.prototype.destroy = function() {
      var k, lwfContainer, movie, obj, _i, _len, _ref, _ref1, _ref2;
      _ref = this.displayList;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        if (obj != null) {
          obj.destroy();
        }
      }
      if (this.attachedMovies != null) {
        _ref1 = this.attachedMovies;
        for (k in _ref1) {
          movie = _ref1[k];
          movie.destroy();
        }
        this.attachedMovies = null;
        this.detachedMovies = null;
        this.attachedMovieList = null;
      }
      if (this.attachedLWFs != null) {
        _ref2 = this.attachedLWFs;
        for (k in _ref2) {
          lwfContainer = _ref2[k];
          this.execDetachHandler(lwfContainer);
        }
        this.attachedLWFs = null;
        this.detachedLWFs = null;
        this.attachedLWFList = null;
      }
      if (this.unloadFunc != null) {
        this.unloadFunc.call(this);
      }
      this.playAnimation(ClipEvent.UNLOAD);
      if (this.handler != null) {
        this.handler.call("unload", this);
      }
      this.instanceHead = null;
      this.instanceTail = null;
      this.displayList = null;
      this.property = null;
      Movie.__super__.destroy.apply(this, arguments);
    };

    Movie.prototype.playAnimation = function(clipEvent) {
      var c, clipEvents, i, _i, _ref;
      clipEvents = this.lwf.data.movieClipEvents;
      for (i = _i = 0, _ref = this.data.clipEvents; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        c = clipEvents[this.data.clipEventId + i];
        if ((c.clipEvent & clipEvent) !== 0) {
          this.lwf.playAnimation(c.animationId, this);
        }
      }
    };

    Movie.prototype.searchFrame = function(label) {
      return this.lwf.searchFrame(this, label);
    };

    Movie.prototype.gotoLabel = function(label) {
      if (typeof label === "string") {
        label = this.lwf.getStringId(label);
      }
      this.gotoFrame(this.lwf.searchFrame(this, label));
      return this;
    };

    Movie.prototype.gotoAndStop = function(n) {
      if (typeof n === "string") {
        this.gotoFrame(this.lwf.searchFrame(this, this.lwf.getStringId(n)));
      } else {
        this.gotoFrame(n);
      }
      this.stop();
      return this;
    };

    Movie.prototype.gotoAndPlay = function(n) {
      if (typeof n === "string") {
        this.gotoFrame(this.lwf.searchFrame(this, this.lwf.getStringId(n)));
      } else {
        this.gotoFrame(n);
      }
      this.play();
      return this;
    };

    Movie.prototype.searchMovieInstance = function(stringId, recursive) {
      var i, instance;
      if (recursive == null) {
        recursive = true;
      }
      if (typeof stringId === "string") {
        stringId = this.lwf.getStringId(stringId);
      }
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isMovie && this.lwf.getInstanceNameStringId(instance.instanceId) === stringId) {
          return instance;
        } else if (recursive && instance.isMovie) {
          i = instance.searchMovieInstance(stringId, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.searchMovieInstanceByInstanceId = function(instId, recursive) {
      var i, instance;
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isMovie && instance.instanceId === instId) {
          return instance;
        } else if (recursive && instance.isMovie) {
          i = instance.searchMovieInstanceByInstanceId(instId, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.searchButtonInstance = function(stringId, recursive) {
      var i, instance;
      if (recursive == null) {
        recursive = true;
      }
      if (typeof stringId === "string") {
        stringId = this.lwf.getStringId(stringId);
      }
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isButton && this.lwf.getInstanceNameStringId(instance.instanceId) === stringId) {
          return instance;
        } else if (recursive && instance.isMovie) {
          i = instance.searchButtonInstance(stringId, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.searchButtonInstanceByInstanceId = function(instId, recursive) {
      var i, instance;
      instance = this.instanceHead;
      while (instance !== null) {
        if (instance.isButton && instance.instanceId === instId) {
          return instance;
        } else if (recursive && instance.isMovie) {
          i = instance.searchMovieInstanceByInstanceId(instId, recursive);
          if (i !== null) {
            return i;
          }
        }
        instance = instance.linkInstance;
      }
      return null;
    };

    Movie.prototype.move = function(x, y) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.move(x, y);
      return this;
    };

    Movie.prototype.moveTo = function(x, y) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.moveTo(x, y);
      return this;
    };

    Movie.prototype.rotate = function(degree) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.rotate(degree);
      return this;
    };

    Movie.prototype.rotateTo = function(degree) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.rotateTo(degree);
      return this;
    };

    Movie.prototype.scale = function(x, y) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.scale(x, y);
      return this;
    };

    Movie.prototype.scaleTo = function(x, y) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.scaleTo(x, y);
      return this;
    };

    Movie.prototype.setMatrix = function(m, scaleX, scaleY, rotation) {
      if (scaleX == null) {
        scaleX = 1;
      }
      if (scaleY == null) {
        scaleY = 1;
      }
      if (rotation == null) {
        rotation = 0;
      }
      this.property.setMatrix(m, scalex, scaleY, rotation);
      return this;
    };

    Movie.prototype.setAlpha = function(alpha) {
      if (!this.property.hasColorTransform) {
        Utility.syncColorTransform(this);
      }
      this.property.setAlpha(alpha);
      return this;
    };

    Movie.prototype.setColorTransform = function(c) {
      this.property.setColorTransform(c);
      return this;
    };

    Movie.prototype.setRenderingOffset = function(rOffset) {
      this.property.setRenderingOffset(rOffset);
      return this;
    };

    Movie.prototype.getX = function() {
      if (this.property.hasMatrix) {
        return this.property.matrix.translateX;
      } else {
        return Utility.getX(this);
      }
    };

    Movie.prototype.setX = function(v) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.moveTo(v, this.property.matrix.translateY);
    };

    Movie.prototype.getY = function() {
      if (this.property.hasMatrix) {
        return this.property.matrix.translateY;
      } else {
        return Utility.getY(this);
      }
    };

    Movie.prototype.setY = function(v) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.moveTo(this.property.matrix.translateX, v);
    };

    Movie.prototype.getScaleX = function() {
      if (this.property.hasMatrix) {
        return this.property.scaleX;
      } else {
        return Utility.getScaleX(this);
      }
    };

    Movie.prototype.setScaleX = function(v) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.scaleTo(v, this.property.scaleY);
    };

    Movie.prototype.getScaleY = function() {
      if (this.property.hasMatrix) {
        return this.property.scaleY;
      } else {
        return Utility.getScaleY(this);
      }
    };

    Movie.prototype.setScaleY = function(v) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.scaleTo(this.property.scaleX, v);
    };

    Movie.prototype.getRotation = function() {
      if (this.property.hasMatrix) {
        return this.property.rotation;
      } else {
        return Utility.getRotation(this);
      }
    };

    Movie.prototype.setRotation = function(v) {
      if (!this.property.hasMatrix) {
        Utility.syncMatrix(this);
      }
      this.property.rotateTo(v);
    };

    Movie.prototype.getAlphaProperty = function() {
      if (this.property.hasColorTransform) {
        return this.property.colorTransform.multi.alpha;
      } else {
        return Utility.getAlpha(this);
      }
    };

    Movie.prototype.setAlphaProperty = function(v) {
      if (!this.property.hasColorTransform) {
        Utility.syncColorTransform(this);
      }
      this.property.setAlpha(v);
    };

    return Movie;

  })(IObject);

  EventHandlers = (function() {

    function EventHandlers() {
      this.clear();
    }

    EventHandlers.prototype.clear = function(type) {
      var _i, _len, _ref;
      if (type == null) {
        type = null;
      }
      if (type != null) {
        if (this[type] != null) {
          this[type] = [];
        }
      } else {
        _ref = this.types;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          type = _ref[_i];
          this[type] = [];
        }
      }
    };

    EventHandlers.prototype.add = function(handlers) {
      var handler, type, _i, _len, _ref;
      _ref = this.types;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        type = _ref[_i];
        handler = handlers[type];
        if (handler != null) {
          this[type].push(handler);
        }
      }
    };

    EventHandlers.prototype.removeHandler = function(array, handler) {
      var i;
      i = 0;
      while (i < array.length) {
        if (array[i] === handler) {
          array.splice(i, 1);
        } else {
          ++i;
        }
      }
    };

    EventHandlers.prototype.remove = function(handlers) {
      var handler, type, _i, _len, _ref;
      _ref = this.types;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        type = _ref[_i];
        handler = handlers[type];
        if (handler != null) {
          this.removeHandler(this[type], handler);
        }
      }
    };

    EventHandlers.prototype.call = function(type, target) {
      var handler, handlers, _i, _len;
      handlers = this[type];
      if (handlers != null) {
        for (_i = 0, _len = handlers.length; _i < _len; _i++) {
          handler = handlers[_i];
          handler.call(target);
        }
      }
    };

    return EventHandlers;

  })();

  MovieEventHandlers = (function(_super) {
    var TYPES;

    __extends(MovieEventHandlers, _super);

    TYPES = ["load", "postLoad", "unload", "enterFrame", "update", "render"];

    function MovieEventHandlers() {
      this.types = TYPES;
      MovieEventHandlers.__super__.constructor.apply(this, arguments);
    }

    return MovieEventHandlers;

  })(EventHandlers);

  ButtonEventHandlers = (function(_super) {
    var TYPES;

    __extends(ButtonEventHandlers, _super);

    TYPES = ["load", "unload", "enterFrame", "update", "render", "press", "release", "rollOver", "rollOut", "keyPress"];

    function ButtonEventHandlers() {
      this.types = TYPES;
      ButtonEventHandlers.__super__.constructor.apply(this, arguments);
    }

    return ButtonEventHandlers;

  })(EventHandlers);

  LWF = (function() {
    var ROUND_OFF_TICK_RATE;

    ROUND_OFF_TICK_RATE = 0.05;

    function LWF(lwfData, rendererFactory, embeddedScript, privateData) {
      if (rendererFactory == null) {
        rendererFactory = null;
      }
      if (embeddedScript == null) {
        embeddedScript = null;
      }
      this.privateData = privateData != null ? privateData : null;
      this.data = lwfData;
      if (embeddedScript != null) {
        this.functions = embeddedScript();
      }
      this.width = this.data.header.width;
      this.height = this.data.header.height;
      this.backgroundColor = this.data.header.backgroundColor;
      this.name = this.data.strings[this.data.header.nameStringId];
      this.interactive = this.data.buttonConditions.length > 0;
      this.url = null;
      this.frameRate = this.data.header.frameRate;
      this.execLimit = 3;
      this.tick = 1.0 / this.frameRate;
      this.roundOffTick = this.tick * ROUND_OFF_TICK_RATE;
      this.time = 0;
      this.thisTick = 0;
      this.attachVisible = true;
      this.execCount = 0;
      this.isExecDisabled = false;
      this.isPropertyDirty = false;
      this.isLWFAttached = false;
      this.interceptByNotAllowOrDenyButtons = true;
      this.intercepted = false;
      this.scaleByStage = 1;
      this.pointX = Number.MIN_VALUE;
      this.pointY = Number.MIN_VALUE;
      this.pressing = false;
      this.buttonHead = null;
      if (!this.interactive && this.data.frames.length === 1) {
        this.disableExec();
      }
      this.property = new Property(this);
      this.instances = [];
      this.execHandlers = null;
      this.eventHandlers = [];
      this.movieEventHandlers = [];
      this.buttonEventHandlers = [];
      this.movieCommands = {};
      this.programObjectConstructors = [];
      this.parent = null;
      this.attachName = null;
      this.depth = null;
      this.matrix = new Matrix;
      this.matrixIdentity = new Matrix;
      this.colorTransform = new ColorTransform;
      this.colorTransformIdentity = new ColorTransform;
      this.init();
      this.setRendererFactory(rendererFactory);
    }

    LWF.prototype.setRendererFactory = function(rendererFactory) {
      if (rendererFactory == null) {
        rendererFactory = null;
      }
      if (rendererFactory == null) {
        rendererFactory = new NullRendererFactory();
      }
      this.rendererFactory = rendererFactory;
      this.rendererFactory.init(this);
    };

    LWF.prototype.setFrameRate = function(frameRate) {
      if (frameRate === 0) {
        return;
      }
      this.frameRate = frameRate;
      this.tick = 1.0 / this.frameRate;
    };

    LWF.prototype.setPreferredFrameRate = function(preferredFrameRate, execLimit) {
      if (execLimit == null) {
        execLimit = 2;
      }
      if (frameRate === 0) {
        return;
      }
      this.execLimit = Math.ceil(this.frameRate / preferredFrameRate) + execLimit;
    };

    LWF.prototype.fitForHeight = function(stageWidth, stageHeight) {
      Utility.fitForHeight(this, stageWidth, stageHeight);
    };

    LWF.prototype.fitForWidth = function(stageWidth, stageHeight) {
      Utility.fitForWidth(this, stageWidth, stageHeight);
    };

    LWF.prototype.scaleForHeight = function(stageHeight) {
      Utility.scaleForHeight(this, stageHeight);
    };

    LWF.prototype.scaleForWidth = function(stageWidth) {
      Utility.scaleForWidth(this, stageWidth);
    };

    LWF.prototype.renderOffset = function() {
      this.renderingIndexOffsetted = 0;
    };

    LWF.prototype.clearRenderOffset = function() {
      this.renderingIndexOffsetted = this.renderingIndex;
    };

    LWF.prototype.renderObject = function(count) {
      if (count == null) {
        count = 1;
      }
      this.renderingIndex += count;
      this.renderingIndexOffsetted += count;
      return this.renderingIndex;
    };

    LWF.prototype.setAttachVisible = function(visible) {
      this.attachVisible = visible;
    };

    LWF.prototype.clearFocus = function(button) {
      if (this.focus === button) {
        this.focus = null;
      }
    };

    LWF.prototype.clearIntercepted = function() {
      this.intercepted = false;
    };

    LWF.prototype.init = function() {
      this.time = 0;
      this.progress = 0;
      this.instances = [];
      this.focus = null;
      this.movieCommands = {};
      this.rootMovieStringId = this.getStringId("_root");
      if (this.rootMovie != null) {
        this.rootMovie.destroy();
      }
      this.rootMovie = new Movie(this, null, this.data.header.rootMovieId, this.searchInstanceId(this.rootMovieStringId));
    };

    LWF.prototype.calcMatrix = function(matrix) {
      var m, p;
      p = this.property;
      if (p.hasMatrix) {
        if (matrix != null) {
          m = Utility.calcMatrix(this.matrix, matrix, p.matrix);
        } else {
          m = p.matrix;
        }
      } else {
        m = matrix != null ? matrix : this.matrixIdentity;
      }
      return m;
    };

    LWF.prototype.calcColorTransform = function(colorTransform) {
      var c, p;
      p = this.property;
      if (p.hasColorTransform) {
        if (colorTransform != null) {
          c = Utility.calcColorTransform(this.colorTransform, colorTransform, p.colorTransform);
        } else {
          c = p.colorTransform;
        }
      } else {
        c = colorTransform != null ? colorTransform : this.colorTransformIdentity;
      }
      return c;
    };

    LWF.prototype.exec = function(tick, matrix, colorTransform) {
      var currentProgress, execLimit, execed, handler, handlers, progressing, _i, _len;
      if (tick == null) {
        tick = 0;
      }
      if (matrix == null) {
        matrix = null;
      }
      if (colorTransform == null) {
        colorTransform = null;
      }
      execed = false;
      currentProgress = this.progress;
      if (this.isExecDisabled) {
        if (!this.executedForExecDisabled) {
          ++this.execCount;
          this.rootMovie.exec();
          this.rootMovie.postExec(true);
          this.executedForExecDisabled = true;
          execed = true;
        }
      } else {
        progressing = true;
        this.thisTick = tick;
        if (tick === 0) {
          this.progress = this.tick;
        } else if (tick < 0) {
          this.progress = this.tick;
          progressing = false;
        } else {
          if (this.time === 0) {
            this.time += this.tick;
            this.progress += this.tick;
          } else {
            this.time += tick;
            this.progress += tick;
          }
        }
        handlers = this.execHandlers;
        if (handlers != null) {
          for (_i = 0, _len = handlers.length; _i < _len; _i++) {
            handler = handlers[_i];
            handler.call(this);
          }
        }
        execLimit = this.execLimit;
        while (this.progress >= this.tick - this.roundOffTick) {
          if (--execLimit < 0) {
            this.progress = 0;
            break;
          }
          this.progress -= this.tick;
          ++this.execCount;
          this.rootMovie.exec();
          this.rootMovie.postExec(progressing);
          execed = true;
        }
        if (this.progress < this.roundOffTick) {
          this.progress = 0;
        }
        this.buttonHead = null;
        if (this.interactive && this.rootMovie.hasButton) {
          this.rootMovie.linkButton();
        }
      }
      if (execed || this.isLWFAttached || this.isPropertyDirty || (matrix != null) || (colorTransform != null)) {
        this.update(matrix, colorTransform);
      }
      if (!this.execDisabled) {
        if (tick < 0) {
          this.progress = currentProgress;
        }
      }
      return this.renderingCount;
    };

    LWF.prototype.forceExec = function(matrix, colorTransform) {
      if (matrix == null) {
        matrix = null;
      }
      if (colorTransform == null) {
        colorTransform = null;
      }
      return this.exec(0, matrix, colorTransform);
    };

    LWF.prototype.forceExecWithoutProgress = function(matrix, colorTransform) {
      if (matrix == null) {
        matrix = null;
      }
      if (colorTransform == null) {
        colorTransform = null;
      }
      return this.exec(-1, matrix, colorTransform);
    };

    LWF.prototype.update = function(matrix, colorTransform) {
      var c, m;
      if (matrix == null) {
        matrix = null;
      }
      if (colorTransform == null) {
        colorTransform = null;
      }
      m = this.calcMatrix(matrix);
      c = this.calcColorTransform(colorTransform);
      this.renderingIndex = 0;
      this.renderingIndexOffsetted = 0;
      this.rootMovie.update(m, c);
      this.renderingCount = this.renderingIndex;
      this.thisTick = 0;
      this.isPropertyDirty = false;
    };

    LWF.prototype.render = function(rIndex, rCount, rOffset) {
      var renderingCountBackup;
      if (rIndex == null) {
        rIndex = 0;
      }
      if (rCount == null) {
        rCount = 0;
      }
      if (rOffset == null) {
        rOffset = Number.MIN_VALUE;
      }
      renderingCountBackup = this.renderingCount;
      if (rCount > 0) {
        this.renderingCount = rCount;
      }
      this.renderingIndex = rIndex;
      this.renderingIndexOffsetted = rIndex;
      if (this.property.hasRenderingOffset) {
        this.renderOffset();
        rOffset = this.property.renderingOffset;
      }
      this.rendererFactory.beginRender(this);
      this.rootMovie.render(this.attachVisible, rOffset);
      this.rendererFactory.endRender(this);
      this.renderingCount = renderingCountBackup;
      return this.renderingCount;
    };

    LWF.prototype.inspect = function(inspector, hierarchy, depth, rIndex, rCount, rOffset) {
      var renderingCountBackup;
      if (hierarchy == null) {
        hierarchy = 0;
      }
      if (depth == null) {
        depth = 0;
      }
      if (rIndex == null) {
        rIndex = 0;
      }
      if (rCount == null) {
        rCount = 0;
      }
      if (rOffset == null) {
        rOffset = Number.MIN_VALUE;
      }
      renderingCountBackup = this.renderingCount;
      if (rCount > 0) {
        this.renderingCount = rCount;
      }
      this.renderingIndex = rIndex;
      this.renderingIndexOffsetted = rIndex;
      if (this.property.hasRenderingOffset) {
        this.renderOffset();
        rOffset = this.property.renderingOffset;
      }
      this.rootMovie.inspect(inspector, hierarchy, depth, rOffset);
      this.renderingCount = renderingCountBackup;
      return this.renderingCount;
    };

    LWF.prototype.destroy = function() {
      var func, resourceCache, _ref;
      if (this.stopTweens != null) {
        this.stopTweens();
      }
      this.rootMovie.destroy();
      this.rootMovie = null;
      func = (_ref = this.functions) != null ? _ref['destroy'] : void 0;
      if (func != null) {
        func.call(this);
      }
      this.functions = null;
      if (this.rendererFactory != null) {
        resourceCache = this.rendererFactory.resourceCache;
        if (resourceCache != null) {
          resourceCache.unloadLWF(this);
        }
        this.rendererFactory.destruct();
        this.rendererFactory = null;
      }
      this.property = null;
      this.buttonHead = null;
      this.instances = null;
      this.execHandlers = null;
      this.eventHandlers = null;
      this.movieEventHandlers = null;
      this.buttonEventHandlers = null;
      this.movieCommands = null;
      this.programObjectConstructors = null;
    };

    LWF.prototype.getInstanceNameStringId = function(instId) {
      if (instId < 0 || instId >= this.data.instanceNames.length) {
        return -1;
      } else {
        return this.data.instanceNames[instId].stringId;
      }
    };

    LWF.prototype.getStringId = function(str) {
      var i;
      i = this.data.stringMap[str];
      if (i != null) {
        return i;
      } else {
        return -1;
      }
    };

    LWF.prototype.searchInstanceId = function(stringId) {
      var i;
      if (stringId < 0 || stringId >= this.data.strings.length) {
        return -1;
      }
      i = this.data.instanceNameMap[stringId];
      if (i != null) {
        return i;
      } else {
        return -1;
      }
    };

    LWF.prototype.searchFrame = function(movie, stringId) {
      var frameNo;
      if (typeof stringId === "string") {
        stringId = this.getStringId(stringId);
      }
      if (stringId < 0 || stringId >= this.data.strings.length) {
        return -1;
      }
      frameNo = this.data.labelMap[movie.objectId][stringId];
      if (frameNo != null) {
        return frameNo + 1;
      } else {
        return -1;
      }
    };

    LWF.prototype.getMovieLabels = function(movie) {
      if (movie == null) {
        return null;
      }
      return this.data.labelMap[movie.objectId];
    };

    LWF.prototype.searchMovieLinkage = function(stringId) {
      var i;
      if (stringId < 0 || stringId >= this.data.strings.length) {
        return -1;
      }
      i = this.data.movieLinkageMap[stringId];
      if (i != null) {
        return this.data.movieLinkages[i].movieId;
      } else {
        return -1;
      }
    };

    LWF.prototype.getMovieLinkageName = function(movieId) {
      var i;
      i = this.data.movieLinkageNameMap[movieId];
      if (i != null) {
        return this.data.strings[i];
      } else {
        return null;
      }
    };

    LWF.prototype.searchMovieInstance = function(stringId) {
      var instanceName, m, name, names, _i, _len;
      if (typeof stringId === "string") {
        instanceName = stringId;
        if (instanceName.indexOf(".") !== -1) {
          names = instanceName.split(".");
          if (names[0] !== this.data.strings[this.rootMovieStringId]) {
            return null;
          }
          m = this.rootMovie;
          for (_i = 0, _len = names.length; _i < _len; _i++) {
            name = names[_i];
            m = m.searchMovieInstance(name, false);
            if (m == null) {
              return null;
            }
          }
          return m;
        }
        stringId = this.getStringId(stringId);
      }
      return this.searchMovieInstanceByInstanceId(this.searchInstanceId(stringId));
    };

    LWF.prototype.searchMovieInstanceByInstanceId = function(instId) {
      var obj;
      if (typeof instId === "string") {
        instId = this.searchInstanceId(this.getStringId(instId));
      }
      if (instId < 0 || instId >= this.data.instanceNames.length) {
        return null;
      }
      obj = this.instances[instId];
      while (obj != null) {
        if (obj.isMovie) {
          return obj;
        }
        obj = obj.nextInstance;
      }
      return null;
    };

    LWF.prototype.searchButtonInstance = function(stringId) {
      var i, instanceName, m, names, _i, _ref;
      if (typeof stringId === "string") {
        instanceName = stringId;
        if (instanceName.indexOf(".") !== -1) {
          names = instanceName.split(".");
          if (names[0] !== this.data.strings[this.rootMovieStringId]) {
            return null;
          }
          m = this.rootMovie;
          for (i = _i = 1, _ref = names.length; 1 <= _ref ? _i < _ref : _i > _ref; i = 1 <= _ref ? ++_i : --_i) {
            if (i === names.length - 1) {
              return m.searchButtonInstance(names[i], false);
            } else {
              m = m.searchButtonInstance(names[i], false);
              if (m == null) {
                return null;
              }
            }
          }
          return null;
        }
        stringId = this.getStringId(stringId);
      }
      return this.searchButtonInstanceByInstanceId(this.searchInstanceId(stringId));
    };

    LWF.prototype.searchButtonInstanceByInstanceId = function(instId) {
      var obj;
      if (typeof instId === "string") {
        instId = this.searchInstanceId(this.getStringId(instId));
      }
      if (instId < 0 || instId >= this.data.instanceNames.length) {
        return null;
      }
      obj = this.instances[instId];
      while (obj != null) {
        if (obj.isButton) {
          return obj;
        }
        obj = obj.nextInstance;
      }
      return null;
    };

    LWF.prototype.searchEventId = function(stringId) {
      var i;
      if (typeof stringId === "string") {
        stringId = this.getStringId(stringId);
      }
      if (stringId < 0 || stringId >= this.data.strings.length) {
        return -1;
      }
      i = this.data.eventMap[stringId];
      if (i != null) {
        return i;
      } else {
        return -1;
      }
    };

    LWF.prototype.searchProgramObjectId = function(stringId) {
      var i;
      if (typeof stringId === "string") {
        stringId = this.getStringId(stringId);
      }
      if (stringId < 0 || stringId >= this.data.strings.length) {
        return -1;
      }
      i = this.data.programObjectMap[stringId];
      if (i != null) {
        return i;
      } else {
        return -1;
      }
    };

    LWF.prototype.getInstance = function(instId) {
      return this.instances[instId];
    };

    LWF.prototype.setInstance = function(instId, instance) {
      this.instances[instId] = instance;
    };

    LWF.prototype.addExecHandler = function(execHandler) {
      var _ref;
      if ((_ref = this.execHandlers) == null) {
        this.execHandlers = [];
      }
      this.execHandlers.push(execHandler);
    };

    LWF.prototype.removeExecHandler = function(execHandler) {
      var handlers, i;
      handlers = this.execHandlers;
      if (handlers == null) {
        return;
      }
      i = 0;
      while (i < handlers.length) {
        if (handlers[i] === execHandler) {
          handlers.splice(i, 1);
        } else {
          ++i;
        }
      }
    };

    LWF.prototype.clearExecHandler = function() {
      this.execHandlers = null;
    };

    LWF.prototype.setExecHandler = function(execHandler) {
      this.clearExecHandler();
      this.addExecHandler(execHandler);
    };

    LWF.prototype.addEventHandler = function(eventId, eventHandler) {
      var _base, _ref;
      if (typeof eventId === "string") {
        eventId = this.searchEventId(eventId);
      }
      if (eventId < 0 || eventId >= this.data.events.length) {
        return;
      }
      if ((_ref = (_base = this.eventHandlers)[eventId]) == null) {
        _base[eventId] = [];
      }
      this.eventHandlers[eventId].push(eventHandler);
    };

    LWF.prototype.removeEventHandler = function(eventId, eventHandler) {
      var handlers, i;
      if (typeof eventId === "string") {
        eventId = this.searchEventId(eventId);
      }
      if (eventId < 0 || eventId >= this.data.events.length) {
        return;
      }
      handlers = this.eventHandlers[eventId];
      if (handlers == null) {
        return;
      }
      i = 0;
      while (i < handlers.length) {
        if (handlers[i] === eventHandler) {
          handlers.splice(i, 1);
        } else {
          ++i;
        }
      }
    };

    LWF.prototype.clearEventHandler = function(eventId) {
      if (typeof eventId === "string") {
        eventId = this.searchEventId(eventId);
      }
      if (eventId < 0 || eventId >= this.data.events.length) {
        return;
      }
      this.eventHandlers[eventId] = null;
    };

    LWF.prototype.setEventHandler = function(eventId, eventHandler) {
      this.clearEventHandler(eventId);
      this.addEventHandler(eventId, eventHandler);
    };

    LWF.prototype.getProgramObjectConstructor = function(programObjectId) {
      if (typeof programObjectId === "string") {
        programObjectId = this.searchProgramObjectId(this.getStringId(programObjectId));
      }
      if (programObjectId < 0 || programObjectId >= this.data.programObjects.length) {
        return null;
      }
      return this.programObjectConstructors[programObjectId];
    };

    LWF.prototype.setProgramObjectConstructor = function(programObjectId, programObjectConstructor) {
      if (typeof programObjectId === "string") {
        programObjectId = this.searchProgramObjectId(this.getStringId(programObjectId));
      }
      if (programObjectId < 0 || programObjectId >= this.data.programObjects.length) {
        return;
      }
      this.programObjectConstructors[programObjectId] = programObjectConstructor;
    };

    LWF.prototype.getMovieEventHandlers = function(m) {
      var fullName, handlers, instId, instanceName;
      if (typeof m === "string") {
        instanceName = m;
        instId = this.searchInstanceId(this.getStringId(instanceName));
        if (instId >= 0 && instId < this.data.instanceNames.length) {
          return this.movieEventHandlers[instId];
        } else {
          if (this.movieEventHandlersByFullName == null) {
            return null;
          }
          return this.movieEventHandlersByFullName[instanceName];
        }
      }
      if (this.movieEventHandlersByFullName != null) {
        fullName = m.getFullName();
        if (fullName != null) {
          handlers = this.movieEventHandlersByFullName[fullName];
          if (handlers != null) {
            return handlers;
          }
        }
      }
      return this.movieEventHandlers[m.instanceId];
    };

    LWF.prototype.addMovieEventHandler = function(instanceName, handlers) {
      var h, instId, movie, _ref;
      instId = this.searchInstanceId(this.getStringId(instanceName));
      if (instId >= 0 && instId < this.data.instanceNames.length) {
        h = this.movieEventHandlers[instId];
        if (h == null) {
          h = new MovieEventHandlers();
          this.movieEventHandlers[instId] = h;
        }
        movie = this.searchMovieInstanceByInstanceId(instId);
        if (movie != null) {
          movie.setHandlers(h);
        }
      } else {
        if (instanceName.indexOf(".") === -1) {
          return;
        }
        if ((_ref = this.movieEventHandlersByFullName) == null) {
          this.movieEventHandlersByFullName = [];
        }
        h = this.movieEventHandlersByFullName[instanceName];
        if (h == null) {
          h = new MovieEventHandlers();
          this.movieEventHandlersByFullName[instanceName] = h;
        }
        movie = this.searchMovieInstance(instanceName);
        if (movie != null) {
          movie.setHandlers(h);
        }
      }
      h.add(handlers);
    };

    LWF.prototype.removeMovieEventHandler = function(instanceName, handlers) {
      var h;
      h = this.getMovieEventHandlers(instanceName);
      if (h != null) {
        h.remove(handlers);
      }
    };

    LWF.prototype.clearMovieEventHandler = function(instanceName, type) {
      var h;
      if (type == null) {
        type = null;
      }
      h = this.getMovieEventHandlers(instanceName);
      if (h != null) {
        h.clear(type);
      }
    };

    LWF.prototype.setMovieEventHandler = function(instanceName, handlers) {
      this.clearMovieEventHandler(instanceName);
      this.addMovieEventHandler(instanceName, handlers);
    };

    LWF.prototype.getButtonEventHandlers = function(m) {
      var fullName, handlers, instId, instanceName;
      if (typeof m === "string") {
        instanceName = m;
        instId = this.searchInstanceId(this.getStringId(instanceName));
        if (instId >= 0 && instId < this.data.instanceNames.length) {
          return this.buttonEventHandlers[instId];
        } else {
          if (this.buttonEventHandlersByFullName == null) {
            return null;
          }
          return this.buttonEventHandlersByFullName[instanceName];
        }
      }
      if (this.buttonEventHandlersByFullName != null) {
        fullName = m.getFullName();
        if (fullName != null) {
          handlers = this.buttonEventHandlersByFullName[fullName];
          if (handlers != null) {
            return handlers;
          }
        }
      }
      return this.buttonEventHandlers[m.instanceId];
    };

    LWF.prototype.addButtonEventHandler = function(instanceName, handlers) {
      var button, h, instId, _ref;
      this.interactive = true;
      instId = this.searchInstanceId(this.getStringId(instanceName));
      if (instId >= 0 && instId < this.data.instanceNames.length) {
        h = this.buttonEventHandlers[instId];
        if (h == null) {
          h = new ButtonEventHandlers();
          this.buttonEventHandlers[instId] = h;
        }
        button = this.searchButtonInstanceByInstanceId(instId);
        if (button != null) {
          button.setHandlers(h);
        }
      } else {
        if (instanceName.indexOf(".") === -1) {
          return;
        }
        if ((_ref = this.buttonEventHandlersByFullName) == null) {
          this.buttonEventHandlersByFullName = [];
        }
        h = this.buttonEventHandlersByFullName[instanceName];
        if (h == null) {
          h = new ButtonEventHandlers();
          this.buttonEventHandlersByFullName[instanceName] = h;
        }
        button = this.searchButtonInstance(instanceName);
        if (typeof movie !== "undefined" && movie !== null) {
          button.setHandlers(h);
        }
      }
      h.add(handlers);
    };

    LWF.prototype.removeButtonEventHandler = function(instanceName, handlers) {
      var h;
      h = this.getButtonEventHandlers(instanceName);
      if (h != null) {
        h.remove(handlers);
      }
    };

    LWF.prototype.clearButtonEventHandler = function(instanceName, type) {
      var h;
      if (type == null) {
        type = null;
      }
      h = this.getButtonEventHandlers(instanceName);
      if (h != null) {
        h.clear(type);
      }
    };

    LWF.prototype.setButtonEventHandler = function(instanceName, handlers) {
      this.clearButtonEventHandler(instanceName);
      this.addButtonEventHandler(instanceName, handlers);
    };

    LWF.prototype.execMovieCommand = function() {
      var available, deletes, k, movie, name, v, _i, _j, _len, _len1, _ref;
      deletes = [];
      _ref = this.movieCommands;
      for (k in _ref) {
        v = _ref[k];
        available = true;
        movie = this.rootMovie;
        for (_i = 0, _len = k.length; _i < _len; _i++) {
          name = k[_i];
          movie = movie.searchMovieInstance(name);
          if (movie == null) {
            available = false;
            break;
          }
        }
        if (available) {
          v(movie);
          deletes.push(k);
        }
      }
      for (_j = 0, _len1 = deletes.length; _j < _len1; _j++) {
        k = deletes[_j];
        delete this.movieCommands[k];
      }
    };

    LWF.prototype.setMovieCommand = function(instanceNames, cmd) {
      var names;
      names = instanceNames.slice(0);
      this.movieCommands[names] = cmd;
      this.execMovieCommand();
    };

    LWF.prototype.searchAttachedMovie = function(attachName) {
      return this.rootMovie.searchAttachedMovie(attachName);
    };

    LWF.prototype.searchAttachedLWF = function(attachName) {
      return this.rootMovie.searchAttachedLWF(attachName);
    };

    LWF.prototype.addAllowButton = function(buttonName) {
      var instId;
      instId = this.searchInstanceId(this.getStringId(buttonName));
      if (instId < 0) {
        return false;
      }
      if (this.allowButtonList == null) {
        this.allowButtonList = {};
      }
      this.allowButtonList[instId] = true;
      return true;
    };

    LWF.prototype.removeAllowButton = function(buttonName) {
      var instId;
      if (this.allowButtonList == null) {
        return false;
      }
      instId = this.searchInstanceId(this.getStringId(buttonName));
      if (instId < 0) {
        return false;
      }
      delete this.allowButtonList[instId];
      return true;
    };

    LWF.prototype.clearAllowButton = function() {
      this.allowButtonList = null;
    };

    LWF.prototype.addDenyButton = function(buttonName) {
      var instId;
      instId = this.searchInstanceId(this.getStringId(buttonName));
      if (instId < 0) {
        return false;
      }
      if (this.denyButtonList == null) {
        this.denyButtonList = {};
      }
      this.denyButtonList[instId] = true;
      return true;
    };

    LWF.prototype.denyAllButtons = function() {
      var instId, _i, _ref;
      if (this.denyButtonList == null) {
        this.denyButtonList = {};
      }
      for (instId = _i = 0, _ref = this.data.instanceNames.length; 0 <= _ref ? _i < _ref : _i > _ref; instId = 0 <= _ref ? ++_i : --_i) {
        this.denyButtonList[instId] = true;
      }
    };

    LWF.prototype.removeDenyButton = function(buttonName) {
      var instId;
      if (this.denyButtonList == null) {
        return false;
      }
      instId = this.searchInstanceId(this.getStringId(buttonName));
      if (instId < 0) {
        return false;
      }
      delete this.denyButtonList[instId];
      return true;
    };

    LWF.prototype.clearDenyButton = function() {
      this.denyButtonList = null;
    };

    LWF.prototype.disableExec = function() {
      this.isExecDisabled = true;
      this.executedForExecDisabled = false;
    };

    LWF.prototype.enableExec = function() {
      this.isExecDisabled = false;
    };

    LWF.prototype.setPropertyDirty = function() {
      this.isPropertyDirty = true;
      if (this.parent != null) {
        this.parent.lwf.setPropertyDirty();
      }
    };

    LWF.prototype.getMovieFunctions = function(movieId) {
      var enterFrameFunc, linkageName, loadFunc, postLoadFunc, unloadFunc, _ref, _ref1, _ref2, _ref3;
      linkageName = this.getMovieLinkageName(movieId);
      loadFunc = (_ref = this.functions) != null ? _ref[linkageName + "_load"] : void 0;
      postLoadFunc = (_ref1 = this.functions) != null ? _ref1[linkageName + "_postLoad"] : void 0;
      unloadFunc = (_ref2 = this.functions) != null ? _ref2[linkageName + "_unload"] : void 0;
      enterFrameFunc = (_ref3 = this.functions) != null ? _ref3[linkageName + "_enterFrame"] : void 0;
      return [loadFunc, postLoadFunc, unloadFunc, enterFrameFunc];
    };

    LWF.prototype.playAnimation = function(animationId, movie, button) {
      var a, animations, count, eventId, func, i, instId, j, stringId, target, _i, _ref;
      i = 0;
      animations = this.data.animations[animationId];
      target = movie;
      while (true) {
        a = animations[i++];
        switch (a) {
          case Animation.END:
            return;
          case Animation.PLAY:
            target.play();
            break;
          case Animation.STOP:
            target.stop();
            break;
          case Animation.GOTONEXTFRAME:
            target.gotoNextFrame();
            break;
          case Animation.GOTOPREVFRAME:
            target.gotoPrevFrame();
            break;
          case Animation.GOTOFRAME:
            target.gotoFrameInternal(animations[i++]);
            break;
          case Animation.GOTOLABEL:
            target.gotoFrame(this.searchFrame(target, animations[i++]));
            break;
          case Animation.SETTARGET:
            target = movie;
            count = animations[i++];
            if (count !== 0) {
              for (j = _i = 0; 0 <= count ? _i < count : _i > count; j = 0 <= count ? ++_i : --_i) {
                instId = animations[i++];
                switch (instId) {
                  case Animation.INSTANCE_TARGET_ROOT:
                    target = this.rootMovie;
                    break;
                  case Animation.INSTANCE_TARGET_PARENT:
                    target = target.parent;
                    if (this.target == null) {
                      target = this.rootMovie;
                    }
                    break;
                  default:
                    target = target.searchMovieInstanceByInstanceId(instId, false);
                    if (target == null) {
                      target = movie;
                    }
                }
              }
            }
            break;
          case Animation.EVENT:
            eventId = animations[i++];
            this.dispatchEvent(eventId, movie, button);
            break;
          case Animation.CALL:
            stringId = animations[i++];
            func = (_ref = this.functions) != null ? _ref[this.data.strings[stringId]] : void 0;
            if (func != null) {
              func.call(movie);
            }
        }
      }
    };

    LWF.prototype.dispatchEvent = function(eventId, movie, button) {
      var handler, handlers, _i, _len;
      if (movie == null) {
        movie = this.rootMovie;
      }
      if (button == null) {
        button = null;
      }
      handlers = this.eventHandlers[eventId];
      if (handlers == null) {
        return false;
      }
      for (_i = 0, _len = handlers.length; _i < _len; _i++) {
        handler = handlers[_i];
        handler(movie, button);
      }
      return true;
    };

    LWF.prototype.inputPoint = function(x, y) {
      var button, found;
      this.intercepted = false;
      if (!this.interactive) {
        return null;
      }
      this.pointX = x;
      this.pointY = y;
      found = false;
      button = this.buttonHead;
      while (button != null) {
        if (button.checkHit(x, y)) {
          if (this.allowButtonList != null) {
            if (this.allowButtonList[button.instanceId] == null) {
              if (this.interceptByNotAllowOrDenyButtons) {
                this.intercepted = true;
                break;
              } else {
                button = button.buttonLink;
                continue;
              }
            }
          } else if (this.denyButtonList != null) {
            if (this.denyButtonList[button.instanceId] != null) {
              if (this.interceptByNotAllowOrDenyButtons) {
                this.intercepted = true;
                break;
              } else {
                button = button.buttonLink;
                continue;
              }
            }
          }
          found = true;
          if (this.focus !== button) {
            if (this.focus != null) {
              this.focus.rollOut();
            }
            this.focus = button;
            this.focus.rollOver();
          }
          break;
        }
        button = button.buttonLink;
      }
      if (!found && (this.focus != null)) {
        this.focus.rollOut();
        this.focus = null;
      }
      return this.focus;
    };

    LWF.prototype.inputPress = function() {
      if (!this.interactive) {
        return;
      }
      this.pressing = true;
      if (this.focus != null) {
        this.focus.press();
      }
    };

    LWF.prototype.inputRelease = function() {
      if (!this.interactive) {
        return;
      }
      this.pressing = false;
      if (this.focus != null) {
        this.focus.release();
      }
    };

    LWF.prototype.inputKeyPress = function(code) {
      var button;
      if (!this.interactive) {
        return;
      }
      button = this.buttonHead;
      while (button != null) {
        button.keyPress(code);
        button = button.buttonLink;
      }
    };

    return LWF;

  })();

  if (typeof global !== "undefined") {
    if ((_ref = global["LWF"]) == null) {
      global["LWF"] = {};
    }
    global["LWF"]["Color"] = Color;
    global["LWF"]["ColorTransform"] = ColorTransform;
    global["LWF"]["Format"] = Format;
    global["LWF"]["LWF"] = LWF;
    global["LWF"]["Loader"] = Loader;
    global["LWF"]["Matrix"] = Matrix;
    global["LWF"]["Movie"] = Movie;
    global["LWF"]["Point"] = Point;
    global["LWF"]["Property"] = Property;
  }

  LWF.prototype["addAllowButton"] = LWF.prototype.addAllowButton;

  LWF.prototype["addButtonEventHandler"] = LWF.prototype.addButtonEventHandler;

  LWF.prototype["addDenyButton"] = LWF.prototype.addDenyButton;

  LWF.prototype["addEventHandler"] = LWF.prototype.addEventHandler;

  LWF.prototype["addMovieEventHandler"] = LWF.prototype.addMovieEventHandler;

  LWF.prototype["clearAllowButton"] = LWF.prototype.clearAllowButton;

  LWF.prototype["clearButtonEventHandler"] = LWF.prototype.clearButtonEventHandler;

  LWF.prototype["clearDenyButton"] = LWF.prototype.clearDenyButton;

  LWF.prototype["clearEventHandler"] = LWF.prototype.clearEventHandler;

  LWF.prototype["clearMovieEventHandler"] = LWF.prototype.clearMovieEventHandler;

  LWF.prototype["denyAllButtons"] = LWF.prototype.denyAllButtons;

  LWF.prototype["destroy"] = LWF.prototype.destroy;

  LWF.prototype["exec"] = LWF.prototype.exec;

  LWF.prototype["fitForHeight"] = LWF.prototype.fitForHeight;

  LWF.prototype["fitForWidth"] = LWF.prototype.fitForWidth;

  LWF.prototype["forceExec"] = LWF.prototype.forceExec;

  LWF.prototype["forceExecWithoutProgress"] = LWF.prototype.forceExecWithoutProgress;

  LWF.prototype["getStringId"] = LWF.prototype.getStringId;

  LWF.prototype["init"] = LWF.prototype.init;

  LWF.prototype["inputKeyPress"] = LWF.prototype.inputKeyPress;

  LWF.prototype["inputPoint"] = LWF.prototype.inputPoint;

  LWF.prototype["inputPress"] = LWF.prototype.inputPress;

  LWF.prototype["inputRelease"] = LWF.prototype.inputRelease;

  LWF.prototype["inspect"] = LWF.prototype.inspect;

  LWF.prototype["removeAllowButton"] = LWF.prototype.removeAllowButton;

  LWF.prototype["removeButtonEventHandler"] = LWF.prototype.removeButtonEventHandler;

  LWF.prototype["removeDenyButton"] = LWF.prototype.removeDenyButton;

  LWF.prototype["removeEventHandler"] = LWF.prototype.removeEventHandler;

  LWF.prototype["removeMovieEventHandler"] = LWF.prototype.removeMovieEventHandler;

  LWF.prototype["render"] = LWF.prototype.render;

  LWF.prototype["scaleForHeight"] = LWF.prototype.scaleForHeight;

  LWF.prototype["scaleForWidth"] = LWF.prototype.scaleForWidth;

  LWF.prototype["searchAttachedLWF"] = LWF.prototype.searchAttachedLWF;

  LWF.prototype["searchAttachedMovie"] = LWF.prototype.searchAttachedMovie;

  LWF.prototype["searchEventId"] = LWF.prototype.searchEventId;

  LWF.prototype["searchFrame"] = LWF.prototype.searchFrame;

  LWF.prototype["setButtonEventHandler"] = LWF.prototype.setButtonEventHandler;

  LWF.prototype["setEventHandler"] = LWF.prototype.setEventHandler;

  LWF.prototype["setFrameRate"] = LWF.prototype.setFrameRate;

  LWF.prototype["setMovieCommand"] = LWF.prototype.setMovieCommand;

  LWF.prototype["setMovieEventHandler"] = LWF.prototype.setMovieEventHandler;

  LWF.prototype["setProgramObjectConstructor"] = LWF.prototype.setProgramObjectConstructor;

  LWF.prototype["setRendererFactory"] = LWF.prototype.setRendererFactory;

  Loader["load"] = Loader.load;

  Data.prototype["check"] = Data.prototype.check;

  Data.prototype["name"] = Data.prototype.name;

  IObject.prototype["getFullName"] = IObject.prototype.getFullName;

  Movie.prototype["attachLWF"] = Movie.prototype.attachLWF;

  Movie.prototype["attachMovie"] = Movie.prototype.attachMovie;

  Movie.prototype["detachFromParent"] = Movie.prototype.detachFromParent;

  Movie.prototype["detachLWF"] = Movie.prototype.detachLWF;

  Movie.prototype["detachMovie"] = Movie.prototype.detachMovie;

  Movie.prototype["getAttachedLWF"] = Movie.prototype.getAttachedLWF;

  Movie.prototype["getAttachedMovie"] = Movie.prototype.getAttachedMovie;

  Movie.prototype["globalToLocal"] = Movie.prototype.globalToLocal;

  Movie.prototype["gotoAndPlay"] = Movie.prototype.gotoAndPlay;

  Movie.prototype["gotoAndStop"] = Movie.prototype.gotoAndStop;

  Movie.prototype["gotoFrame"] = Movie.prototype.gotoFrame;

  Movie.prototype["gotoLabel"] = Movie.prototype.gotoLabel;

  Movie.prototype["gotoNextFrame"] = Movie.prototype.gotoNextFrame;

  Movie.prototype["gotoPrevFrame"] = Movie.prototype.gotoPrevFrame;

  Movie.prototype["inspect"] = Movie.prototype.inspect;

  Movie.prototype["localToGlobal"] = Movie.prototype.localToGlobal;

  Movie.prototype["move"] = Movie.prototype.move;

  Movie.prototype["moveTo"] = Movie.prototype.moveTo;

  Movie.prototype["override"] = Movie.prototype.override;

  Movie.prototype["play"] = Movie.prototype.play;

  Movie.prototype["rotate"] = Movie.prototype.rotate;

  Movie.prototype["rotateTo"] = Movie.prototype.rotateTo;

  Movie.prototype["scale"] = Movie.prototype.scale;

  Movie.prototype["scaleTo"] = Movie.prototype.scaleTo;

  Movie.prototype["searchAttachedLWF"] = Movie.prototype.searchAttachedLWF;

  Movie.prototype["searchAttachedMovie"] = Movie.prototype.searchAttachedMovie;

  Movie.prototype["searchMovieInstance"] = Movie.prototype.searchMovieInstance;

  Movie.prototype["searchMovieInstanceByInstanceId"] = Movie.prototype.searchMovieInstanceByInstanceId;

  Movie.prototype["setAlpha"] = Movie.prototype.setAlpha;

  Movie.prototype["setColorTransform"] = Movie.prototype.setColorTransform;

  Movie.prototype["setMatrix"] = Movie.prototype.setMatrix;

  Movie.prototype["setRenderingOffset"] = Movie.prototype.setRenderingOffset;

  Movie.prototype["setVisible"] = Movie.prototype.setVisible;

  Movie.prototype["stop"] = Movie.prototype.stop;

  Movie.prototype["swapAttachedLWFDepth"] = Movie.prototype.swapAttachedLWFDepth;

  Movie.prototype["swapAttachedMovieDepth"] = Movie.prototype.swapAttachedMovieDepth;

  Property.prototype["clear"] = Property.prototype.clear;

  Property.prototype["move"] = Property.prototype.move;

  Property.prototype["moveTo"] = Property.prototype.moveTo;

  Property.prototype["rotate"] = Property.prototype.rotate;

  Property.prototype["rotateTo"] = Property.prototype.rotateTo;

  Property.prototype["scale"] = Property.prototype.scale;

  Property.prototype["scaleTo"] = Property.prototype.scaleTo;

  Property.prototype["setAlpha"] = Property.prototype.setAlpha;

  Property.prototype["setColorTransform"] = Property.prototype.setColorTransform;

  Property.prototype["setMatrix"] = Property.prototype.setMatrix;

  Matrix.prototype["clear"] = Matrix.prototype.clear;

  Matrix.prototype["set"] = Matrix.prototype.set;

  Color.prototype["set"] = Color.prototype.set;

  ColorTransform.prototype["clear"] = ColorTransform.prototype.clear;

  ColorTransform.prototype["set"] = ColorTransform.prototype.set;

  WebkitCSSRendererFactory = (function() {

    function WebkitCSSRendererFactory(data, resourceCache, cache, stage, textInSubpixel, use3D) {
      var bitmap, bitmapEx, computedStyle, h, style, text, w, _i, _j, _k, _len, _len1, _len2, _ref1, _ref2, _ref3;
      this.resourceCache = resourceCache;
      this.cache = cache;
      this.stage = stage;
      this.textInSubpixel = textInSubpixel;
      this.use3D = use3D;
      this.bitmapContexts = [];
      _ref1 = data.bitmaps;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        bitmap = _ref1[_i];
        if (bitmap.textureFragmentId === -1) {
          continue;
        }
        bitmapEx = new Format.BitmapEx();
        bitmapEx.matrixId = bitmap.matrixId;
        bitmapEx.textureFragmentId = bitmap.textureFragmentId;
        bitmapEx.u = 0;
        bitmapEx.v = 0;
        bitmapEx.w = 1;
        bitmapEx.h = 1;
        this.bitmapContexts.push(new WebkitCSSBitmapContext(this, data, bitmapEx));
      }
      this.bitmapExContexts = [];
      _ref2 = data.bitmapExs;
      for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
        bitmapEx = _ref2[_j];
        if (bitmapEx.textureFragmentId === -1) {
          continue;
        }
        this.bitmapExContexts.push(new WebkitCSSBitmapContext(this, data, bitmapEx));
      }
      this.textContexts = [];
      _ref3 = data.texts;
      for (_k = 0, _len2 = _ref3.length; _k < _len2; _k++) {
        text = _ref3[_k];
        this.textContexts.push(new WebkitCSSTextContext(this, data, text));
      }
      style = this.stage.style;
      style.display = "block";
      style.position = "absolute";
      style.overflow = "hidden";
      style.webkitUserSelect = "none";
      if (this.use3D) {
        style.webkitTransform = "translateZ(0)";
        style.webkitTransformStyle = "preserve-3d";
      }
      computedStyle = window.getComputedStyle(this.stage, "");
      h = computedStyle.getPropertyValue("height");
      w = computedStyle.getPropertyValue("width");
      if (h === "0px" && w === "0px") {
        style.width = "" + data.header.width + "px";
        style.height = "" + data.header.height + "px";
      }
      this.commands = [];
    }

    WebkitCSSRendererFactory.prototype.destruct = function() {
      var context, _i, _j, _k, _len, _len1, _len2, _ref1, _ref2, _ref3;
      _ref1 = this.bitmapContexts;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        context = _ref1[_i];
        context.destruct();
      }
      _ref2 = this.bitmapExContexts;
      for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
        context = _ref2[_j];
        context.destruct();
      }
      _ref3 = this.textContexts;
      for (_k = 0, _len2 = _ref3.length; _k < _len2; _k++) {
        context = _ref3[_k];
        context.destruct();
      }
    };

    WebkitCSSRendererFactory.prototype.init = function(lwf) {
      var domName, m, name, progObj, _i, _len, _ref1, _results,
        _this = this;
      lwf.stage = this.stage;
      lwf.resourceCache = this.resourceCache;
      if (this.setupedDomElementConstructor) {
        return;
      }
      this.setupedDomElementConstructor = true;
      _ref1 = lwf.data.programObjects;
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        progObj = _ref1[_i];
        name = lwf.data.strings[progObj.stringId];
        m = name.match(/^DOM_(.*)/);
        if (m != null) {
          domName = m[1];
          _results.push((function(domName) {
            return lwf.setProgramObjectConstructor(name, function(lwf_, objId, w, h) {
              var ctor, domElement;
              ctor = _this.resourceCache.domElementConstructor;
              if (ctor == null) {
                return null;
              }
              domElement = ctor(lwf_, domName, w, h);
              if (domElement == null) {
                return null;
              }
              return new WebkitCSSDomElementRenderer(_this, domElement);
            });
          })(domName));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    WebkitCSSRendererFactory.prototype.beginRender = function(lwf) {};

    WebkitCSSRendererFactory.prototype.endRender = function(lwf) {
      var c, command, m, renderer, scaleX, scaleY, skew0, skew1, style, translateX, translateY, _i, _len, _ref1;
      _ref1 = this.commands;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        command = _ref1[_i];
        renderer = command.renderer;
        style = renderer.node.style;
        if (!command.isBitmap) {
          c = renderer.color;
          style.color = "rgb(" + c.red + "," + c.green + "," + c.blue + ")";
        }
        style.zIndex = renderer.zIndex;
        style.opacity = renderer.alpha;
        m = command.matrix;
        scaleX = m.scaleX.toFixed(12);
        scaleY = m.scaleY.toFixed(12);
        skew1 = m.skew1.toFixed(12);
        skew0 = m.skew0.toFixed(12);
        translateX = m.translateX.toFixed(12);
        translateY = m.translateY.toFixed(12);
        if (this.use3D) {
          style.webkitTransform = "matrix3d(" + ("" + scaleX + "," + skew1 + ",0,0,") + ("" + skew0 + "," + scaleY + ",0,0,") + "0,0,1,0," + ("" + translateX + "," + translateY + ",0,1)");
        } else {
          style.webkitTransform = "matrix(" + ("" + scaleX + "," + skew1 + "," + skew0 + "," + scaleY + "," + translateX + "," + translateY + ")");
        }
      }
      this.commands = [];
    };

    WebkitCSSRendererFactory.prototype.constructBitmap = function(lwf, objectId, bitmap) {
      var context;
      context = this.bitmapContexts[objectId];
      if (context) {
        return new WebkitCSSBitmapRenderer(context);
      }
    };

    WebkitCSSRendererFactory.prototype.constructBitmapEx = function(lwf, objectId, bitmapEx) {
      var context;
      context = this.bitmapExContexts[objectId];
      if (context) {
        return new WebkitCSSBitmapRenderer(context);
      }
    };

    WebkitCSSRendererFactory.prototype.constructText = function(lwf, objectId, text) {
      var context;
      context = this.textContexts[objectId];
      if (context) {
        return new WebkitCSSTextRenderer(lwf, context, text);
      }
    };

    WebkitCSSRendererFactory.prototype.constructParticle = function(lwf, objectId, particle) {
      var ctor, particleData;
      ctor = this.resourceCache.particleConstructor;
      particleData = lwf.data.particleDatas[particle.particleDataId];
      if (ctor != null) {
        return ctor(lwf, lwf.data.strings[particleData.stringId]);
      }
    };

    WebkitCSSRendererFactory.prototype.convertColor = function(d, c, t) {
      Utility.calcColor(d, c, t);
      d.red = Math.round(d.red * 255);
      d.green = Math.round(d.green * 255);
      d.blue = Math.round(d.blue * 255);
    };

    WebkitCSSRendererFactory.prototype.convertRGB = function(c) {
      var b, g, r;
      r = Math.round(c.red * 255);
      g = Math.round(c.green * 255);
      b = Math.round(c.blue * 255);
      return "rgb(" + r + "," + g + "," + b + ")";
    };

    WebkitCSSRendererFactory.prototype.getStageSize = function() {
      var computedStyle, h, w;
      computedStyle = window.getComputedStyle(this.stage, "");
      w = parseInt(computedStyle.getPropertyValue("width").replace("px", ""), 10);
      h = parseInt(computedStyle.getPropertyValue("height").replace("px", ""), 10);
      return [w, h];
    };

    WebkitCSSRendererFactory.prototype.fitForHeight = function(lwf) {
      var h, w, _ref1;
      _ref1 = this.getStageSize(), w = _ref1[0], h = _ref1[1];
      if (h !== 0 && h !== lwf.data.header.height) {
        lwf.fitForHeight(w, h);
      }
    };

    WebkitCSSRendererFactory.prototype.fitForWidth = function(lwf) {
      var h, w, _ref1;
      _ref1 = this.getStageSize(), w = _ref1[0], h = _ref1[1];
      if (w !== 0 && w !== lwf.data.header.width) {
        lwf.fitForWidth(w, h);
      }
    };

    WebkitCSSRendererFactory.prototype.scaleForHeight = function(lwf) {
      var h, w, _ref1;
      _ref1 = this.getStageSize(), w = _ref1[0], h = _ref1[1];
      if (h !== 0 && h !== lwf.data.header.height) {
        lwf.scaleForHeight(w, h);
      }
    };

    WebkitCSSRendererFactory.prototype.scaleForWidth = function(lwf) {
      var h, w, _ref1;
      _ref1 = this.getStageSize(), w = _ref1[0], h = _ref1[1];
      if (w !== 0 && w !== lwf.data.header.width) {
        lwf.scaleForWidth(w, h);
      }
    };

    WebkitCSSRendererFactory.prototype.setBackgroundColor = function(lwf) {
      var b, bgColor, g, r;
      bgColor = lwf.backgroundColor;
      r = (bgColor >> 16) & 0xff;
      g = (bgColor >> 8) & 0xff;
      b = (bgColor >> 0) & 0xff;
      this.stage.style.backgroundColor = "rgb(" + r + "," + g + "," + b + ")";
    };

    return WebkitCSSRendererFactory;

  })();

  WebkitCSSDomElementRenderer = (function() {

    function WebkitCSSDomElementRenderer(factory, node) {
      this.factory = factory;
      this.node = node;
      this.node.style.position = "absolute";
      this.node.style.webkitTransformOrigin = "0px 0px";
      this.node.style.display = "block";
      this.factory.stage.parentNode.appendChild(this.node);
      this.matrix = new Matrix(0, 0, 0, 0, 0, 0);
      this.alpha = -1;
      this.zIndex = -1;
      this.visible = true;
    }

    WebkitCSSDomElementRenderer.prototype.destruct = function() {
      this.factory.stage.parentNode.removeChild(this.node);
    };

    WebkitCSSDomElementRenderer.prototype.update = function(m, c) {};

    WebkitCSSDomElementRenderer.prototype.render = function(m, c, renderingIndex, renderingCount, visible) {
      var matrixChanged, style;
      if (this.visible === visible) {
        if (visible === false) {
          return;
        }
      } else {
        this.visible = visible;
        if (visible === false) {
          this.node.style.visibility = "hidden";
          return;
        } else {
          this.node.style.visibility = "visible";
        }
      }
      matrixChanged = this.matrix.setWithComparing(m);
      if (!matrixChanged && this.alpha === c.multi.alpha && this.zIndex === renderingIndex) {
        return;
      }
      this.alpha = c.multi.alpha;
      this.zIndex = renderingIndex;
      style = this.node.style;
      style.zIndex = this.zIndex;
      style.opacity = this.alpha;
      m = this.matrix;
      if (this.use3D) {
        style.webkitTransform = "matrix3d(" + ("" + m.scaleX + "," + m.skew1 + ",0,0,") + ("" + m.skew0 + "," + m.scaleY + ",0,0,") + "0,0,1,0," + ("" + m.translateX + "," + m.translateY + ",0,1)");
      } else {
        style.webkitTransform = "matrix(" + ("" + m.scaleX + "," + m.skew1 + "," + m.skew0 + "," + m.scaleY + ",") + ("" + m.translateX + "," + m.translateY + ")");
      }
    };

    return WebkitCSSDomElementRenderer;

  })();

  WebkitCSSResourceCache = (function() {
    var _instance;

    _instance = null;

    WebkitCSSResourceCache.get = function() {
      return _instance != null ? _instance : _instance = new this();
    };

    function WebkitCSSResourceCache() {
      this.cache = {};
    }

    WebkitCSSResourceCache.prototype.clear = function() {
      return this.cache = {};
    };

    WebkitCSSResourceCache.prototype.getTextureURL = function(settings, data, texture) {
      var imageMap, newUrl, prefix, suffix, url, _ref1, _ref2, _ref3;
      prefix = (_ref1 = (_ref2 = settings["imagePrefix"]) != null ? _ref2 : settings["prefix"]) != null ? _ref1 : "";
      suffix = (_ref3 = settings["imageSuffix"]) != null ? _ref3 : "";
      imageMap = settings["imageMap"];
      url = texture.filename;
      if (typeof imageMap === 'function') {
        newUrl = imageMap.call(settings, url);
        if (newUrl != null) {
          url = newUrl;
        }
      } else if (typeof imageMap === 'object') {
        newUrl = imageMap[url];
        if (newUrl != null) {
          url = newUrl;
        }
      }
      if (!url.match(/^\//)) {
        url = prefix + url;
      }
      url = url.replace(/(\.png|\.jpg)/i, suffix + "$1");
      return url;
    };

    WebkitCSSResourceCache.prototype.checkTextures = function(settings, data) {
      var h, m, ma, orig, pm, pngFilename, pngURL, re, rgb, rotated, t, texture, u, url, v, w, x, y, _base, _i, _len, _ref1, _ref2;
      settings._alphaMap = {};
      settings._rgbMap = {};
      settings._textures = [];
      re = new RegExp("_atlas_(.*)_info_" + "([0-9])_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+)", "i");
      _ref1 = data.textures;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        texture = _ref1[_i];
        m = texture.filename.match(/^(.*)_rgb_([0-9a-f]{6})(.*)$/i);
        if (m != null) {
          ma = texture.filename.match(re);
          if (ma != null) {
            orig = ma[1];
            rotated = ma[2] === "1" ? true : false;
            u = parseInt(ma[3], 10);
            v = parseInt(ma[4], 10);
            w = parseInt(ma[5], 10);
            h = parseInt(ma[6], 10);
            x = parseInt(ma[7], 10);
            y = parseInt(ma[8], 10);
          } else {
            orig = m[1] + m[3];
            rotated = false;
            u = 0;
            v = 0;
            w = null;
            h = null;
            x = 0;
            y = 0;
          }
          rgb = m[2];
          if ((_ref2 = (_base = settings._rgbMap)[orig]) == null) {
            _base[orig] = [];
          }
          settings._rgbMap[orig].push({
            filename: texture.filename,
            rgb: rgb,
            rotated: rotated,
            u: u,
            v: v,
            w: w,
            h: h,
            x: x,
            y: y
          });
          continue;
        }
        settings._textures.push(texture);
        url = this.getTextureURL(settings, data, texture);
        m = url.match(/^(.*)_withalpha(.*\.)jpg/i);
        if (m != null) {
          pngURL = "" + m[1] + "_alpha" + m[2] + "png";
          pm = pngURL.match(/\/([^\/]+)$/);
          pngFilename = pm != null ? pm[1] : pngURL;
          t = new Format.TextureReplacement(pngFilename);
          t.url = pngURL;
          settings._textures.push(t);
          settings._alphaMap[texture.filename] = [texture, t];
          settings._alphaMap[t.filename] = [texture, t];
        }
      }
    };

    WebkitCSSResourceCache.prototype.onloaddata = function(settings, data, url) {
      var lwfUrl;
      if (!((data != null) && data.check())) {
        settings.error.push({
          url: url,
          reason: "dataError"
        });
        settings["onload"].call(settings, null);
        return;
      }
      settings["name"] = data.name();
      this.checkTextures(settings, data);
      lwfUrl = settings["lwf"];
      this.cache[lwfUrl] = {};
      this.cache[lwfUrl].data = data;
      settings.total = settings._textures.length + 1;
      if (data.useScript) {
        settings.total++;
      }
      settings.loadedCount = 1;
      if (settings["onprogress"] != null) {
        settings["onprogress"].call(settings, settings.loadedCount, settings.total);
      }
      if (data.useScript) {
        this.loadJS(settings, data);
      } else {
        this.loadImages(settings, data);
      }
    };

    WebkitCSSResourceCache.prototype.loadLWF = function(settings) {
      var data, lwfUrl, url, _ref1;
      lwfUrl = settings["lwf"];
      url = lwfUrl;
      if (!url.match(/^\//)) {
        url = ((_ref1 = settings["prefix"]) != null ? _ref1 : "") + url;
      }
      settings.error = [];
      if (this.cache[lwfUrl] != null) {
        data = this.cache[lwfUrl].data;
        if (data != null) {
          settings["name"] = data.name();
          this.checkTextures(settings, data);
          settings.total = settings._textures.length + 1;
          settings.loadedCount = 1;
          if (typeof onprogress !== "undefined" && onprogress !== null) {
            onprogress.call(settings, settings.loadedCount, settings.total);
          }
          this.loadImages(settings, data);
          return;
        }
      }
      this.loadLWFData(settings, url);
    };

    WebkitCSSResourceCache.prototype.dispatchOnloaddata = function(settings, url, useWorker, useArrayBuffer, useWorkerWithArrayBuffer, data) {
      var i, m, re, scripts, workerJS, _i, _ref1,
        _this = this;
      if (useWorker) {
        workerJS = null;
        scripts = document.getElementsByTagName("script");
        re = new RegExp("(^|.*\/" + __FILE__ + ")$", "i");
        for (i = _i = 0, _ref1 = scripts.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
          if (scripts[i].src === "") {
            continue;
          }
          m = scripts[i].src.match(re);
          if (m != null) {
            workerJS = m[1];
            break;
          }
        }
        if (workerJS != null) {
          (function(workerJS) {
            var worker;
            worker = new Worker(workerJS);
            worker.onmessage = function(e) {
              data = new Data(e.data);
              worker = worker.onmessage = worker.onerror = null;
              return _this.onloaddata(settings, data, url);
            };
            worker.onerror = function(e) {
              settings.error.push({
                url: workerJS,
                reason: "error"
              });
              worker = worker.onmessage = worker.onerror = null;
              return settings["onload"].call(settings, null);
            };
            if (useWorkerWithArrayBuffer && data.type !== "base64") {
              return worker.webkitPostMessage(data.data);
            } else {
              return worker.postMessage(data.data);
            }
          })(workerJS);
        }
      }
      if (workerJS == null) {
        if (data.type === "base64") {
          data = (new Zlib.Inflate(atob(data.data))).decompress();
          if (typeof Uint8Array !== 'undefined' && typeof Uint16Array !== 'undefined' && typeof Uint32Array !== 'undefined') {
            data = Loader.loadArrayBuffer(data);
          } else {
            data = Loader.loadArray(data);
          }
        } else if (useArrayBuffer) {
          data = Loader.loadArrayBuffer(data.data);
        } else {
          data = Loader.load(data.data);
        }
        this.onloaddata(settings, data, url);
      }
    };

    WebkitCSSResourceCache.prototype.loadLWFData = function(settings, url) {
      var head, m, name, onload, script, useArrayBuffer, useWorker, useWorkerWithArrayBuffer, xhr,
        _this = this;
      onload = settings["onload"];
      useWorker = false;
      useWorkerWithArrayBuffer = false;
      if (typeof Worker !== 'undefined' && (!(settings["worker"] != null) || settings["worker"])) {
        useWorker = true;
        if (typeof Worker.prototype.webkitPostMessage !== "undefined") {
          useWorkerWithArrayBuffer = true;
        }
      }
      m = url.match(/([^\/]+)\.lwf\.js/i);
      if (m != null) {
        name = m[1].toLowerCase();
        head = document.getElementsByTagName('head')[0];
        script = document.createElement("script");
        script.type = "text/javascript";
        script.charset = "UTF-8";
        script.onabort = function() {
          settings.error.push({
            url: url,
            reason: "abort"
          });
          head.removeChild(script);
          script = script.onload = script.onabort = script.onerror = null;
          return onload.call(settings, null);
        };
        script.onerror = function() {
          settings.error.push({
            url: url,
            reason: "error"
          });
          head.removeChild(script);
          script = script.onload = script.onabort = script.onerror = null;
          return onload.call(settings, null);
        };
        script.onload = function() {
          var data, str, _ref1, _ref2;
          str = (_ref1 = global["LWF"]) != null ? (_ref2 = _ref1["DataScript"]) != null ? _ref2[name] : void 0 : void 0;
          head.removeChild(script);
          script = script.onload = script.onabort = script.onerror = null;
          if (str != null) {
            data = {
              type: "base64",
              data: str
            };
            return _this.dispatchOnloaddata(settings, url, useWorker, useArrayBuffer, useWorkerWithArrayBuffer, data);
          } else {
            settings.error.push({
              url: url,
              reason: "error"
            });
            return onload.call(settings, null);
          }
        };
        script.src = url;
        head.appendChild(script);
        return;
      }
      xhr = new XMLHttpRequest;
      xhr.open('GET', url, true);
      if (typeof xhr.responseType === 'string' && typeof Uint8Array !== 'undefined' && typeof Int32Array !== 'undefined' && typeof Float32Array !== 'undefined' && (!useWorker || useWorkerWithArrayBuffer)) {
        useArrayBuffer = true;
        xhr.responseType = "arraybuffer";
      } else {
        useArrayBuffer = false;
        xhr.overrideMimeType('text/plain; charset=x-user-defined');
      }
      xhr.onabort = function() {
        settings.error.push({
          url: url,
          reason: "abort"
        });
        xhr = xhr.onabort = xhr.onerror = xhr.onreadystatechange = null;
        return onload.call(settings, null);
      };
      xhr.onerror = function() {
        settings.error.push({
          url: url,
          reason: "error"
        });
        xhr = xhr.onabort = xhr.onerror = xhr.onreadystatechange = null;
        return onload.call(settings, null);
      };
      xhr.onreadystatechange = function() {
        var data, _ref1;
        if (xhr.readyState !== 4) {
          return;
        }
        if (!((_ref1 = xhr.status) === 0 || _ref1 === 200)) {
          return;
        }
        if (useArrayBuffer) {
          data = {
            type: "arraybuffer",
            data: xhr.response
          };
        } else {
          data = {
            type: "text",
            data: xhr.responseText
          };
        }
        _this.dispatchOnloaddata(settings, url, useWorker, useArrayBuffer, useWorkerWithArrayBuffer, data);
        return xhr = xhr.onabort = xhr.onerror = xhr.onreadystatechange = null;
      };
      xhr.send(null);
    };

    WebkitCSSResourceCache.prototype.loadJS = function(settings, data) {
      var head, lwfUrl, onload, onprogress, script, url, _ref1, _ref2,
        _this = this;
      lwfUrl = settings["lwf"];
      url = (_ref1 = settings["js"]) != null ? _ref1 : lwfUrl.replace(/\.lwf(\.js)?/i, ".js");
      if (!url.match(/^\//)) {
        url = ((_ref2 = settings["prefix"]) != null ? _ref2 : "") + url;
      }
      onload = settings["onload"];
      onprogress = settings["onprogress"];
      script = document.createElement("script");
      script.type = "text/javascript";
      script.charset = "UTF-8";
      script.onabort = function() {
        delete _this.cache[lwfUrl];
        settings.error.push({
          url: url,
          reason: "abort"
        });
        script = script.onload = script.onabort = script.onerror = null;
        return onload.call(settings, null);
      };
      script.onerror = function() {
        delete _this.cache[lwfUrl];
        settings.error.push({
          url: url,
          reason: "error"
        });
        script = script.onload = script.onabort = script.onerror = null;
        return onload.call(settings, null);
      };
      script.onload = function() {
        settings.loadedCount++;
        if (onprogress != null) {
          onprogress.call(settings, settings.loadedCount, settings.total);
        }
        _this.cache[lwfUrl].script = script;
        script = script.onload = script.onabort = script.onerror = null;
        return _this.loadImages(settings, data);
      };
      script.src = url;
      head = document.getElementsByTagName('head')[0];
      head.appendChild(script);
    };

    WebkitCSSResourceCache.prototype.loadImagesCallback = function(settings, imageCache, data) {
      settings.loadedCount++;
      if (settings["onprogress"] != null) {
        settings["onprogress"].call(settings, settings.loadedCount, settings.total);
      }
      if (settings.loadedCount === settings.total) {
        delete settings._alphaMap;
        delete settings._rgbMap;
        delete settings._textures;
        if (settings.error.length > 0) {
          delete this.cache[settings["lwf"]];
          settings["onload"].call(settings, null);
        } else {
          this.newLWF(settings, imageCache, data);
        }
      }
    };

    WebkitCSSResourceCache.prototype.generateImages = function(settings, imageCache, texture, image) {
      var canvas, ctx, d, h, m, name, o, w, _i, _len, _ref1, _ref2;
      d = settings._rgbMap[texture.filename];
      if (d != null) {
        for (_i = 0, _len = d.length; _i < _len; _i++) {
          o = d[_i];
          w = (_ref1 = o.w) != null ? _ref1 : image.width;
          h = (_ref2 = o.h) != null ? _ref2 : image.height;
          if (this.constructor === WebkitCSSResourceCache) {
            name = "canvas_" + o.filename.replace(/[\.-]/g, "_");
            ctx = document.getCSSCanvasContext("2d", name, w, h);
            canvas = ctx.canvas;
            canvas.name = name;
          } else {
            canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;
            ctx = canvas.getContext('2d');
          }
          ctx.fillStyle = "#" + o.rgb;
          ctx.fillRect(0, 0, w, h);
          ctx.globalCompositeOperation = 'destination-in';
          if (o.rotated) {
            m = new Matrix();
            Utility.rotateMatrix(m, new Matrix(), 1, o.x, o.y + h);
            ctx.setTransform(m.scaleX, m.skew1, m.skew0, m.scaleY, m.translateX, m.translateY);
          } else if (o.x !== 0 || o.y !== 0) {
            m = new Matrix();
            Utility.scaleMatrix(m, new Matrix(), 1, o.x, o.yy);
            ctx.setTransform(m.scaleX, m.skew1, m.skew0, m.scaleY, m.translateX, m.translateY);
          }
          ctx.drawImage(image, o.u, o.v, w, h, 0, 0, w, h);
          imageCache[o.filename] = canvas;
        }
      }
    };

    WebkitCSSResourceCache.prototype.loadImages = function(settings, data) {
      var imageCache, texture, url, _fn, _i, _len, _ref1,
        _this = this;
      imageCache = {};
      if (data.textures.length === 0) {
        this.newLWF(settings, imageCache, data);
        return;
      }
      _ref1 = settings._textures;
      _fn = function(texture, url) {
        var image;
        image = new Image();
        image.onabort = function() {
          settings.error.push({
            url: url,
            reason: "abort"
          });
          image = image.onload = image.onabort = image.onerror = null;
          return _this.loadImagesCallback(settings, imageCache, data);
        };
        image.onerror = function() {
          settings.error.push({
            url: url,
            reason: "error"
          });
          image = image.onload = image.onabort = image.onerror = null;
          return _this.loadImagesCallback(settings, imageCache, data);
        };
        image.onload = function() {
          var alpha, alphaImg, canvas, ctx, d, jpg, jpgImg, name;
          imageCache[texture.filename] = image;
          d = settings._alphaMap[texture.filename];
          if (d != null) {
            jpg = d[0];
            alpha = d[1];
            jpgImg = imageCache[jpg.filename];
            alphaImg = imageCache[alpha.filename];
            if ((jpgImg != null) && (alphaImg != null)) {
              if (_this.constructor === WebkitCSSResourceCache) {
                name = "canvas_" + jpg.filename.replace(/[\.-]/g, "_");
                ctx = document.getCSSCanvasContext("2d", name, jpgImg.width, jpgImg.height);
                canvas = ctx.canvas;
                canvas.name = name;
              } else {
                canvas = document.createElement('canvas');
                canvas.width = jpgImg.width;
                canvas.height = jpgImg.height;
                ctx = canvas.getContext('2d');
              }
              ctx.drawImage(jpgImg, 0, 0, jpgImg.width, jpgImg.height);
              ctx.globalCompositeOperation = 'destination-in';
              ctx.drawImage(alphaImg, 0, 0, jpgImg.width, jpgImg.height);
              delete imageCache[jpg.filename];
              delete imageCache[alpha.filename];
              imageCache[jpg.filename] = canvas;
              _this.generateImages(settings, imageCache, jpg, canvas);
            }
          } else {
            _this.generateImages(settings, imageCache, texture, image);
          }
          image = image.onload = image.onabort = image.onerror = null;
          return _this.loadImagesCallback(settings, imageCache, data);
        };
        return image.src = url;
      };
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        texture = _ref1[_i];
        if (texture.url != null) {
          url = texture.url;
        } else {
          url = this.getTextureURL(settings, data, texture);
        }
        _fn(texture, url);
      }
    };

    WebkitCSSResourceCache.prototype.newFactory = function(settings, cache, data) {
      var _ref1, _ref2;
      return new WebkitCSSRendererFactory(data, this, cache, settings["stage"], (_ref1 = settings["textInSubpixel"]) != null ? _ref1 : false, (_ref2 = settings["use3D"]) != null ? _ref2 : true);
    };

    WebkitCSSResourceCache.prototype.onloadLWF = function(settings, lwf) {
      var factory;
      factory = lwf.rendererFactory;
      if (settings["useBackgroundColor"]) {
        factory.setBackgroundColor(lwf);
      }
      if (settings["fitForHeight"]) {
        factory.fitForHeight(lwf);
      } else if (settings["fitForWidth"]) {
        factory.fitForWidth(lwf);
      }
      settings["onload"].call(settings, lwf);
    };

    WebkitCSSResourceCache.prototype.newLWF = function(settings, imageCache, data) {
      var cache, embeddedScript, factory, lwf, lwfUrl, _ref1, _ref2, _ref3;
      lwfUrl = settings["lwf"];
      cache = this.cache[lwfUrl];
      if ((_ref1 = cache.instances) == null) {
        cache.instances = 0;
      }
      cache.instances++;
      factory = this.newFactory(settings, imageCache, data);
      if (data.useScript) {
        embeddedScript = (_ref2 = global["LWF"]) != null ? (_ref3 = _ref2["Script"]) != null ? _ref3[data.name()] : void 0 : void 0;
      }
      lwf = new LWF(data, factory, embeddedScript, settings["privateData"]);
      lwf.url = settings["lwf"];
      if (settings["preferredFrameRate"] != null) {
        if (settings["execLimit"] != null) {
          lwf.setPreferredFrameRate(settings["preferredFrameRate"], settings["execLimit"]);
        } else {
          lwf.setPreferredFrameRate(settings["preferredFrameRate"]);
        }
      }
      this.onloadLWF(settings, lwf);
    };

    WebkitCSSResourceCache.prototype.unloadLWF = function(lwf) {
      var cache, head;
      cache = this.cache[lwf.url];
      if ((cache != null) && --cache.instances <= 0) {
        head = document.getElementsByTagName('head')[0];
        head.removeChild(cache.script);
        delete this.cache[lwf.url];
      }
    };

    WebkitCSSResourceCache.prototype.loadLWFs = function(settingsArray, onloadall) {
      var errors, loadTotal, loadedCount, onload, settings, _fn, _i, _len, _results,
        _this = this;
      loadTotal = settingsArray.length;
      loadedCount = 0;
      errors = null;
      _fn = function(onload) {
        return settings["onload"] = function(lwf) {
          if (onload != null) {
            onload(lwf);
          }
          if (settings.error.length > 0) {
            if (errors == null) {
              errors = [];
            }
            errors = errors.concat(settings.error);
          }
          ++loadedCount;
          if (loadTotal === loadedCount) {
            return onloadall(errors);
          }
        };
      };
      _results = [];
      for (_i = 0, _len = settingsArray.length; _i < _len; _i++) {
        settings = settingsArray[_i];
        onload = settings["onload"];
        _fn(onload);
        _results.push(this.loadLWF(settings));
      }
      return _results;
    };

    WebkitCSSResourceCache.prototype.getCache = function() {
      return this.cache;
    };

    WebkitCSSResourceCache.prototype.setParticleConstructor = function(ctor) {
      this.particleConstructor = ctor;
    };

    WebkitCSSResourceCache.prototype.setDOMElementConstructor = function(ctor) {
      this.domElementConstructor = ctor;
    };

    return WebkitCSSResourceCache;

  })();

  Base64 = (function() {

    function Base64() {}

    Base64.table = [62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -2, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51];

    Base64.decode = function(str) {
      var c, decoded, fragment, i, j, n, table_length, v, _i, _ref1;
      table_length = Base64.table.length;
      decoded = new Array((((table_length + 2) / 3) | 0) * 4);
      c = 0;
      n = 0;
      j = 0;
      for (i = _i = 0, _ref1 = str.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
        v = (str.charCodeAt(i) & 0xff) - 43;
        if (v < 0 || v >= table_length) {
          continue;
        }
        fragment = Base64.table[v];
        if (fragment < 0) {
          continue;
        }
        switch (n) {
          case 0:
            c = (fragment & 0x03f) << 2;
            ++n;
            break;
          case 1:
            c |= (fragment & 0x030) >> 4;
            decoded[j++] = c;
            c = (fragment & 0x00f) << 4;
            ++n;
            break;
          case 2:
            c |= (fragment & 0x03c) >> 2;
            decoded[j++] = c;
            c = (fragment & 0x003) << 6;
            ++n;
            break;
          case 3:
            c |= fragment & 0x03f;
            decoded[j++] = c;
            n = 0;
        }
      }
      return decoded;
    };

    return Base64;

  })();

  if (!(typeof window !== "undefined" && window !== null) && (typeof self !== "undefined" && self !== null)) {
    if (typeof atob === "undefined" || atob === null) {
      atob = Base64.decode;
    }
    self.onmessage = function(event) {
      var data;
      if (typeof self.webkitPostMessage !== "undefined" && typeof event.data === "object") {
        data = Loader.loadArrayBuffer(event.data);
        self.webkitPostMessage(data);
      } else {
        data = event.data;
        if (data[0] === 'L' && data[1] === 'W' && data[2] === 'F') {
          data = Loader.load(data);
        } else {
          data = (new Zlib.Inflate(atob(data))).decompress();
          if (typeof Uint8Array !== 'undefined' && typeof Uint16Array !== 'undefined' && typeof Uint32Array !== 'undefined') {
            data = Loader.loadArrayBuffer(data.buffer);
          } else {
            data = Loader.loadArray(data);
          }
        }
        if (typeof self.webkitPostMessage !== "undefined") {
          self.webkitPostMessage(data);
        } else {
          self.postMessage(data);
        }
      }
      return self.close();
    };
  }

  WebGLRendererFactory = (function(_super) {

    __extends(WebGLRendererFactory, _super);

    WebGLRendererFactory.shaderProgram = null;

    function WebGLRendererFactory(data, resourceCache, cache, stage, textInSubpixel) {
      var bitmap, bitmapEx, depth, fn, fragmentShader, gl, params, pmatrix, rl, shaderProgram, tb, text, vertexShader, _i, _j, _k, _len, _len1, _len2, _ref1, _ref2, _ref3, _ref4;
      this.resourceCache = resourceCache;
      this.cache = cache;
      this.stage = stage;
      this.textInSubpixel = textInSubpixel;
      params = {
        premultipliedAlpha: false
      };
      this.stage.style.webkitUserSelect = "none";
      this.stageContext = (_ref1 = this.stage.getContext("webgl", params)) != null ? _ref1 : this.stage.getContext("experimental-webgl", params);
      if (this.stage.width === 0 && this.stage.height === 0) {
        this.stage.width = data.header.width;
        this.stage.height = data.header.height;
      }
      this.w = this.stage.width;
      this.h = this.stage.height;
      gl = this.stageContext;
      gl.viewport(0, 0, this.w, this.h);
      gl.clearColor(0.0, 0.0, 0.0, 1.0);
      gl.enable(gl.DEPTH_TEST);
      gl.depthFunc(gl.LEQUAL);
      gl.enable(gl.BLEND);
      if (WebGLRendererFactory.shaderProgram != null) {
        shaderProgram = WebGLRendererFactory.shaderProgram;
      } else {
        vertexShader = this.loadShader(gl, gl.VERTEX_SHADER, "attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uPMatrix;\nuniform mat4 uMatrix;\nvarying mediump vec2 vTextureCoord;\nvoid main() {\n  vTextureCoord = aTextureCoord;\n  gl_Position = uPMatrix * uMatrix * vec4(aVertexPosition, 1.0);\n}");
        fragmentShader = this.loadShader(gl, gl.FRAGMENT_SHADER, "varying mediump vec2 vTextureCoord;\nuniform lowp vec4 uColor;\nuniform sampler2D uTexture;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTextureCoord) * uColor;\n}");
        shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);
        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
          alert("Unable to initialize the shader program.");
        }
        WebGLRendererFactory.shaderProgram = shaderProgram;
      }
      gl.useProgram(shaderProgram);
      this.aVertexPosition = gl.getAttribLocation(shaderProgram, "aVertexPosition");
      gl.enableVertexAttribArray(this.aVertexPosition);
      this.aTextureCoord = gl.getAttribLocation(shaderProgram, "aTextureCoord");
      gl.enableVertexAttribArray(this.aTextureCoord);
      this.uPMatrix = gl.getUniformLocation(shaderProgram, "uPMatrix");
      this.uMatrix = gl.getUniformLocation(shaderProgram, "uMatrix");
      this.uColor = gl.getUniformLocation(shaderProgram, "uColor");
      this.uTexture = gl.getUniformLocation(shaderProgram, "uTexture");
      depth = 1024;
      this.farZ = -(depth - 1);
      rl = this.w;
      tb = -this.h;
      fn = depth * 2;
      pmatrix = [2 / rl, 0, 0, 0, 0, 2 / tb, 0, 0, 0, 0, -2 / fn, 0, -1, 1, 0, 1];
      gl.uniformMatrix4fv(this.uPMatrix, false, new Float32Array(pmatrix));
      this.textures = {};
      this.bitmapContexts = [];
      _ref2 = data.bitmaps;
      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
        bitmap = _ref2[_i];
        if (bitmap.textureFragmentId === -1) {
          continue;
        }
        bitmapEx = new Format.BitmapEx();
        bitmapEx.matrixId = bitmap.matrixId;
        bitmapEx.textureFragmentId = bitmap.textureFragmentId;
        bitmapEx.u = 0;
        bitmapEx.v = 0;
        bitmapEx.w = 1;
        bitmapEx.h = 1;
        this.bitmapContexts.push(new WebGLBitmapContext(this, data, bitmapEx));
      }
      this.bitmapExContexts = [];
      _ref3 = data.bitmapExs;
      for (_j = 0, _len1 = _ref3.length; _j < _len1; _j++) {
        bitmapEx = _ref3[_j];
        if (bitmapEx.textureFragmentId === -1) {
          continue;
        }
        this.bitmapExContexts.push(new WebGLBitmapContext(this, data, bitmapEx));
      }
      this.textContexts = [];
      _ref4 = data.texts;
      for (_k = 0, _len2 = _ref4.length; _k < _len2; _k++) {
        text = _ref4[_k];
        this.textContexts.push(new WebGLTextContext(this, data, text));
      }
    }

    WebGLRendererFactory.prototype.loadShader = function(gl, type, program) {
      var shader;
      shader = gl.createShader(type);
      gl.shaderSource(shader, program);
      gl.compileShader(shader);
      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        alert("An error occurred compiling the shaders: " + gl.getShaderInfoLog(shader));
      }
      return shader;
    };

    WebGLRendererFactory.prototype.destruct = function() {
      var context, gl, _i, _j, _k, _len, _len1, _len2, _ref1, _ref2, _ref3;
      gl = this.stageContext;
      gl.bindTexture(gl.TEXTURE_2D, null);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
      _ref1 = this.bitmapContexts;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        context = _ref1[_i];
        context.destruct();
      }
      _ref2 = this.bitmapExContexts;
      for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
        context = _ref2[_j];
        context.destruct();
      }
      _ref3 = this.textContexts;
      for (_k = 0, _len2 = _ref3.length; _k < _len2; _k++) {
        context = _ref3[_k];
        context.destruct();
      }
    };

    WebGLRendererFactory.prototype.beginRender = function(lwf) {
      var gl;
      gl = this.stageContext;
      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    };

    WebGLRendererFactory.prototype.endRender = function(lwf) {};

    WebGLRendererFactory.prototype.constructBitmap = function(lwf, objectId, bitmap) {
      var context;
      context = this.bitmapContexts[objectId];
      if (context) {
        return new WebGLBitmapRenderer(context);
      }
    };

    WebGLRendererFactory.prototype.constructBitmapEx = function(lwf, objectId, bitmapEx) {
      var context;
      context = this.bitmapExContexts[objectId];
      if (context) {
        return new WebGLBitmapRenderer(context);
      }
    };

    WebGLRendererFactory.prototype.constructText = function(lwf, objectId, text) {
      var context;
      context = this.textContexts[objectId];
      if (context) {
        return new WebGLTextRenderer(lwf, context, text);
      }
    };

    WebGLRendererFactory.prototype.constructParticle = function(lwf, objectId, particle) {
      var ctor, particleData;
      ctor = this.resourceCache.particleConstructor;
      particleData = lwf.data.particleDatas[particle.particleDataId];
      if (ctor != null) {
        return ctor(lwf, lwf.data.strings[particleData.stringId]);
      }
    };

    WebGLRendererFactory.prototype.setBackgroundColor = function(lwf) {
      var b, bgColor, g, gl, r;
      bgColor = lwf.data.header.backgroundColor;
      r = ((bgColor >> 16) & 0xff) / 255.0;
      g = ((bgColor >> 8) & 0xff) / 255.0;
      b = ((bgColor >> 0) & 0xff) / 255.0;
      gl = this.stageContext;
      gl.clearColor(r, g, b, 1.0);
    };

    return WebGLRendererFactory;

  })(WebkitCSSRendererFactory);

  WebGLBitmapContext = (function() {

    function WebGLBitmapContext(factory, data, bitmapEx) {
      var bh, bu, bv, bw, d, dh, dw, filename, fragment, gl, h, height, image, scale, texdata, th, triangles, tw, u, u0, u1, uv, v, v0, v1, vertices, w, x, x0, x1, y, y0, y1;
      this.factory = factory;
      this.data = data;
      gl = this.factory.stageContext;
      fragment = data.textureFragments[bitmapEx.textureFragmentId];
      texdata = data.textures[fragment.textureId];
      this.preMultipliedAlpha = texdata.format === Format.Constant.TEXTUREFORMAT_PREMULTIPLIEDALPHA;
      filename = texdata.filename;
      d = this.factory.textures[filename];
      if (d != null) {
        this.texture = d[0], scale = d[1];
      } else {
        image = this.factory.cache[filename];
        scale = 1 / texdata.scale;
        this.texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, this.texture);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.bindTexture(gl.TEXTURE_2D, null);
        this.factory.textures[filename] = [this.texture, scale];
      }
      tw = texdata.width;
      th = texdata.height;
      x = fragment.x;
      y = fragment.y;
      u = fragment.u;
      v = fragment.v;
      w = fragment.w;
      h = fragment.h;
      bu = bitmapEx.u * w;
      bv = bitmapEx.v * h;
      bw = bitmapEx.w;
      bh = bitmapEx.h;
      x += bu;
      y += bv;
      u += bu;
      v += bv;
      w *= bw;
      h *= bh;
      height = h;
      x0 = x * scale;
      y0 = y * scale;
      x1 = (x + w) * scale;
      y1 = (y + h) * scale;
      vertices = new Float32Array([x1, y1, 0, x1, y0, 0, x0, y1, 0, x0, y0, 0]);
      this.verticesBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      dw = 2.0 * tw;
      dh = 2.0 * th;
      if (fragment.rotated === 0) {
        u0 = (2 * u + 1) / dw;
        v0 = (2 * v + 1) / dh;
        u1 = u0 + (w * 2 - 2) / dw;
        v1 = v0 + (h * 2 - 1) / dh;
        uv = new Float32Array([u1, v1, u1, v0, u0, v1, u0, v0]);
      } else {
        u0 = (2 * u + 1) / dw;
        v0 = (2 * v + 1) / dh;
        u1 = u0 + (h * 2 - 2) / dw;
        v1 = v0 + (w * 2 - 1) / dh;
        uv = new Float32Array([u0, v1, u1, v1, u0, v0, u1, v0]);
      }
      this.uvBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this.uvBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, uv, gl.STATIC_DRAW);
      triangles = new Uint16Array([0, 1, 2, 2, 1, 3]);
      this.trianglesBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.trianglesBuffer);
      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, triangles, gl.STATIC_DRAW);
    }

    WebGLBitmapContext.prototype.destruct = function() {
      var gl;
      gl = this.factory.stageContext;
      gl.deleteTexture(this.texture);
      gl.deleteBuffer(this.verticesBuffer);
      gl.deleteBuffer(this.uvBuffer);
      gl.deleteBuffer(this.trianglesBuffer);
    };

    return WebGLBitmapContext;

  })();

  WebGLBitmapRenderer = (function() {

    function WebGLBitmapRenderer(context) {
      this.context = context;
      this.matrix = new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
      this.color = new Float32Array([0, 0, 0, 0]);
    }

    WebGLBitmapRenderer.prototype.destruct = function() {};

    WebGLBitmapRenderer.prototype.render = function(m, c, renderingIndex, renderingCount, visible) {
      var alpha, factory, gc, gl, gm, src;
      if (!visible) {
        return;
      }
      factory = this.context.factory;
      gl = factory.stageContext;
      gl.bindBuffer(gl.ARRAY_BUFFER, this.context.verticesBuffer);
      gl.vertexAttribPointer(factory.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
      gl.bindBuffer(gl.ARRAY_BUFFER, this.context.uvBuffer);
      gl.vertexAttribPointer(factory.aTextureCoord, 2, gl.FLOAT, false, 0, 0);
      gm = this.matrix;
      gm[0] = m.scaleX;
      gm[1] = m.skew1;
      gm[4] = m.skew0;
      gm[5] = m.scaleY;
      gm[12] = m.translateX;
      gm[13] = m.translateY;
      gm[14] = factory.farZ + renderingIndex;
      gl.uniformMatrix4fv(factory.uMatrix, false, gm);
      gc = this.color;
      if (this.context.preMultipliedAlpha) {
        src = gl.ONE;
        alpha = c.multi.alpha;
        gc[0] = c.multi.red * alpha;
        gc[1] = c.multi.green * alpha;
        gc[2] = c.multi.blue * alpha;
        gc[3] = alpha;
      } else {
        src = gl.SRC_ALPHA;
        gc[0] = c.multi.red;
        gc[1] = c.multi.green;
        gc[2] = c.multi.blue;
        gc[3] = c.multi.alpha;
      }
      gl.blendFunc(src, gl.ONE_MINUS_SRC_ALPHA);
      gl.uniform4fv(factory.uColor, gc);
      gl.activeTexture(gl.TEXTURE0);
      gl.bindTexture(gl.TEXTURE_2D, this.context.texture);
      gl.uniform1i(factory.uTexture, 0);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.context.trianglesBuffer);
      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
    };

    return WebGLBitmapRenderer;

  })();

  WebGLResourceCache = (function(_super) {

    __extends(WebGLResourceCache, _super);

    function WebGLResourceCache() {
      return WebGLResourceCache.__super__.constructor.apply(this, arguments);
    }

    WebGLResourceCache.prototype.newFactory = function(settings, cache, data) {
      var _ref1;
      return new WebGLRendererFactory(data, this, cache, settings.stage, (_ref1 = settings.textInSubpixel) != null ? _ref1 : false);
    };

    return WebGLResourceCache;

  })(WebkitCSSResourceCache);

  WebGLTextContext = (function() {

    function WebGLTextContext(factory, data, text) {
      var dh, dw, font, gl, h, th, triangles, tw, u, u0, u1, uv, v, v0, v1, vertices, w, x, x0, x1, y, y0, y1;
      this.factory = factory;
      this.data = data;
      this.text = text;
      this.str = this.data.strings[this.text.stringId];
      this.textProperty = this.data.textProperties[this.text.textPropertyId];
      font = this.data.fonts[this.textProperty.fontId];
      this.textColor = this.data.colors[this.text.colorId];
      this.name = this.data.strings[this.text.nameStringId];
      if (this.textProperty.strokeColorId !== -1) {
        this.strokeColor = this.data.colors[this.textProperty.strokeColorId];
      }
      if (this.textProperty.shadowColorId !== -1) {
        this.shadowColor = this.data.colors[this.textProperty.shadowColorId];
      }
      this.fontName = "\"" + this.data.strings[font.stringId] + "\",sans-serif";
      switch (this.textProperty.align & Align.ALIGN_MASK) {
        case Align.RIGHT:
          this.align = "right";
          this.offsetX = this.text.width;
          break;
        case Align.CENTER:
          this.align = "center";
          this.offsetX = this.text.width / 2;
          break;
        default:
          this.align = "left";
          this.offsetX = 0;
      }
      gl = this.factory.stageContext;
      tw = this.text.width;
      th = this.text.height;
      x = 0;
      y = 0;
      u = 0;
      v = 0;
      w = tw;
      h = th;
      x0 = x;
      y0 = y;
      x1 = x + w;
      y1 = y + h;
      vertices = new Float32Array([x1, y1, 0, x1, y0, 0, x0, y1, 0, x0, y0, 0]);
      this.verticesBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      dw = 2.0 * tw;
      dh = 2.0 * th;
      u0 = (2 * u + 1) / dw;
      v0 = (2 * v + 1) / dh;
      u1 = u0 + (w * 2 - 2) / dw;
      v1 = v0 + (h * 2 - 1) / dh;
      uv = new Float32Array([u1, v1, u1, v0, u0, v1, u0, v0]);
      this.uvBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, this.uvBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, uv, gl.STATIC_DRAW);
      triangles = new Uint16Array([0, 1, 2, 2, 1, 3]);
      this.trianglesBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.trianglesBuffer);
      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, triangles, gl.STATIC_DRAW);
    }

    WebGLTextContext.prototype.destruct = function() {
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
      gl.deleteBuffer(this.verticesBuffer);
      gl.deleteBuffer(this.uvBuffer);
      gl.deleteBuffer(this.trianglesBuffer);
    };

    return WebGLTextContext;

  })();

  WebGLTextRenderer = (function() {

    function WebGLTextRenderer(lwf, context, textObject) {
      var canvas, ctx, fontHeight, scale, _ref1;
      this.lwf = lwf;
      this.context = context;
      this.textObject = textObject;
      this.str = (_ref1 = this.textObject.parent[this.context.name]) != null ? _ref1 : this.context.str;
      if (this.str != null) {
        this.str = String(this.str);
      }
      scale = this.lwf.scaleByStage;
      canvas = document.createElement("canvas");
      canvas.width = this.context.text.width * scale;
      canvas.height = this.context.text.height * scale;
      ctx = canvas.getContext("2d");
      fontHeight = this.context.textProperty.fontHeight * scale;
      ctx.font = "" + fontHeight + "px " + this.context.fontName;
      ctx.textAlign = this.context.align;
      this.canvas = canvas;
      this.canvasContext = ctx;
      this.textRendered = false;
      this.matrixForScale = new Matrix();
      this.matrix = new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
      this.color = new Float32Array([0, 0, 0, 0]);
    }

    WebGLTextRenderer.prototype.destruct = function() {
      var gl;
      gl = this.context.factory.stageContext;
      if (this.texture) {
        gl.deleteTexture(this.texture);
      }
    };

    WebGLTextRenderer.prototype.render = function(m, c, renderingIndex, renderingCount, visible) {
      var factory, gc, gl, gm, src, str, strChanged, textInSubpixel;
      if (!visible) {
        return;
      }
      strChanged = false;
      str = this.textObject.parent[this.context.name];
      if (str != null) {
        str = String(str);
      }
      if ((str != null) && str !== this.str) {
        strChanged = true;
        this.str = str;
      }
      if (!this.textRendered || strChanged) {
        this.renderText();
      }
      factory = this.context.factory;
      gl = factory.stageContext;
      gl.bindBuffer(gl.ARRAY_BUFFER, this.context.verticesBuffer);
      gl.vertexAttribPointer(factory.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
      gl.bindBuffer(gl.ARRAY_BUFFER, this.context.uvBuffer);
      gl.vertexAttribPointer(factory.aTextureCoord, 2, gl.FLOAT, false, 0, 0);
      textInSubpixel = this.context.factory.textInSubpixel;
      gm = this.matrix;
      gm[0] = m.scaleX;
      gm[1] = m.skew1;
      gm[4] = m.skew0;
      gm[5] = m.scaleY;
      gm[12] = textInSubpixel ? m.translateX : Math.round(m.translateX);
      gm[13] = textInSubpixel ? m.translateY : Math.round(m.translateY);
      gm[14] = factory.farZ + renderingIndex;
      gl.uniformMatrix4fv(factory.uMatrix, false, gm);
      gc = this.color;
      src = gl.SRC_ALPHA;
      gc[0] = c.multi.red;
      gc[1] = c.multi.green;
      gc[2] = c.multi.blue;
      gc[3] = c.multi.alpha;
      gl.blendFunc(src, gl.ONE_MINUS_SRC_ALPHA);
      gl.uniform4fv(factory.uColor, gc);
      gl.activeTexture(gl.TEXTURE0);
      gl.bindTexture(gl.TEXTURE_2D, this.texture);
      gl.uniform1i(factory.uTexture, 0);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.context.trianglesBuffer);
      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
    };

    WebGLTextRenderer.prototype.renderText = function() {
      var canvas, ctx, fontHeight, gl, h, i, leading, line, lines, offsetY, property, scale, shadowColor, useStroke, x, y, _i, _ref1;
      this.textRendered = true;
      canvas = this.canvas;
      ctx = this.canvasContext;
      lines = this.str.split("\n");
      scale = this.lwf.scaleByStage;
      property = this.context.textProperty;
      fontHeight = property.fontHeight * scale;
      leading = property.leading * scale;
      h = (fontHeight * lines.length + leading * (lines.length - 1)) * 96 / 72;
      switch (property.align & Align.VERTICAL_MASK) {
        case Align.VERTICAL_BOTTOM:
          offsetY = canvas.height - h;
          break;
        case Align.VERTICAL_MIDDLE:
          offsetY = (canvas.height - h) / 2;
          break;
        default:
          offsetY = 0;
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = this.context.factory.convertRGB(this.context.textColor);
      useStroke = false;
      if (this.context.strokeColor != null) {
        ctx.strokeStyle = this.context.factory.convertRGB(this.context.strokeColor);
        ctx.lineWidth = property.strokeWidth;
        useStroke = true;
      }
      if (this.context.shadowColor != null) {
        shadowColor = this.context.factory.convertRGB(this.context.shadowColor);
        ctx.shadowOffsetX = property.shadowOffsetX;
        ctx.shadowOffsetY = property.shadowOffsetY;
        ctx.shadowBlur = property.shadowBlur;
      }
      for (i = _i = 0, _ref1 = lines.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
        line = lines[i];
        x = this.context.offsetX * scale;
        y = fontHeight + offsetY;
        if (i > 0) {
          y += (fontHeight + leading) * i * 96 / 72;
        }
        if (this.context.shadowColor != null) {
          ctx.shadowColor = shadowColor;
        }
        ctx.fillText(line, x, y);
        if (useStroke) {
          if (this.context.shadowColor != null) {
            ctx.shadowColor = "rgba(0, 0, 0, 0)";
          }
          ctx.strokeText(line, x, y);
        }
      }
      gl = this.context.factory.stageContext;
      if (this.texture) {
        gl.bindTexture(gl.TEXTURE_2D, null);
        gl.deleteTexture(this.texture);
      }
      this.texture = gl.createTexture();
      gl.bindTexture(gl.TEXTURE_2D, this.texture);
      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    };

    return WebGLTextRenderer;

  })();

  if (typeof global !== "undefined") {
    global["LWF"]["WebGLRendererFactory"] = WebGLRendererFactory;
    global["LWF"]["WebGLResourceCache"] = WebGLResourceCache;
    global["LWF"]["useWebGLRenderer"] = function() {
      return global["LWF"]["ResourceCache"] = WebGLResourceCache;
    };
  }

  WebGLRendererFactory.prototype["convertColor"] = WebGLRendererFactory.prototype.convertColor;

  WebGLRendererFactory.prototype["fitForHeight"] = WebGLRendererFactory.prototype.fitForHeight;

  WebGLRendererFactory.prototype["fitForWidth"] = WebGLRendererFactory.prototype.fitForWidth;

  WebGLRendererFactory.prototype["scaleForHeight"] = WebGLRendererFactory.prototype.scaleForHeight;

  WebGLRendererFactory.prototype["scaleForWidth"] = WebGLRendererFactory.prototype.scaleForWidth;

  WebGLRendererFactory.prototype["setBackgroundColor"] = WebGLRendererFactory.prototype.setBackgroundColor;

  WebGLResourceCache.prototype["clear"] = WebGLResourceCache.prototype.clear;

  WebGLResourceCache.prototype["getCache"] = WebGLResourceCache.prototype.getCache;

  WebGLResourceCache.prototype["loadLWF"] = WebGLResourceCache.prototype.loadLWF;

  WebGLResourceCache.prototype["loadLWFs"] = WebGLResourceCache.prototype.loadLWFs;

  WebGLResourceCache.prototype["unloadLWF"] = WebGLResourceCache.prototype.unloadLWF;

  WebGLResourceCache.prototype["setParticleConstructor"] = WebGLResourceCache.prototype.setParticleConstructor;

  WebGLResourceCache.prototype["setDOMElementConstructor"] = WebGLResourceCache.prototype.setDOMElementConstructor;

}).call(this);
/**
 * @author sole / http://soledadpenades.com
 * @author mrdoob / http://mrdoob.com
 * @author Robert Eisele / http://www.xarg.org
 * @author Philippe / http://philippe.elsass.me
 * @author Robert Penner / http://www.robertpenner.com/easing_terms_of_use.html
 * @author Paul Lewis / http://www.aerotwist.com/
 * @author lechecacharro
 * @author Josh Faul / http://jocafa.com/
 * @author egraether / http://egraether.com/
 * @author GREE, Inc.
 *
 * The MIT License
 *
 * Copyright (c) 2010-2012 Tween.js authors.
 * Copyright (c) 2012 GREE, Inc.
 *
 * Easing equations
 *   Copyright (c) 2001 Robert Penner http://robertpenner.com/easing/
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

(function() {

var TWEENLWF = {};

TWEENLWF.Tween = function ( movie ) {

	this.lwf = movie.lwf;
	this.object = movie;
	this.valuesStart = {};
	this.valuesEnd = {};
	this.duration = 1;
	this.delayTime = 0;
	this.startTime = null;
	this.easingFunction = TWEENLWF.Easing.Linear.None;
	this.interpolationFunction = TWEENLWF.Interpolation.Linear;
	this.chainedTweens = [];
	this.onStartCallback = null;
	this.onStartCallbackFired = false;
	this.onUpdateCallback = null;
	this.onCompleteCallback = null;

	if ( typeof this.lwf._tweens === "undefined" ) {

		this.lwf._tweens = [];

		if ( this.lwf._tweenMode === "lwf" ) {

			this.lwf.addExecHandler( TWEENLWF._tweenExecHandler );

		} else {

			this.lwf.addMovieEventHandler( "_root", {

				"enterFrame": TWEENLWF._tweenMovieHandler

			});

		}

	}

	this.to = function ( properties, duration ) {

		if ( duration !== undefined ) {

			this.duration = duration * this.lwf.tick;

		}

		this.valuesEnd = properties;

		return this;

	};

	this.start = function () {

		this.lwf._tweens.push( this );

		this.onStartCallbackFired = false;

		this.startTime = this.lwf.time;
		this.startTime += this.delayTime;

		for ( var property in this.valuesEnd ) {

			// This prevents the engine from interpolating null values
			if ( this.object[ property ] === null ) {

				continue;

			}

			// check if an Array was provided as property value
			if ( this.valuesEnd[ property ] instanceof Array ) {

				if ( this.valuesEnd[ property ].length === 0 ) {

					continue;

				}

				// create a local copy of the Array with the start value at the front
				this.valuesEnd[ property ] = [ this.object[ property ] ].concat( this.valuesEnd[ property ] );

			}

			this.valuesStart[ property ] = this.object[ property ];

		}

		return this;

	};

	this.stop = function () {

		var i = this.lwf._tweens.indexOf( this );

		if ( i !== -1 ) {

			this.lwf._tweens.splice( i, 1 );

			if ( this.lwf._tweens.length == 0 ) {

				this.stopTweens();

			}

		}

		return this;

	};

	this.delay = function ( amount ) {

		this.delayTime = amount * this.lwf.tick;
		return this;

	};

	this.easing = function ( easing ) {

		this.easingFunction = easing;
		return this;

	};

	this.interpolation = function ( interpolation ) {

		this.interpolationFunction = interpolation;
		return this;

	};

	this.chain = function ( chainedTween ) {

		if ( typeof chainedTween !== "undefined" && chainedTween !== null ) {

			this.chainedTweens.push( chainedTween );
			return this;

		} else {

			chainedTween = new TWEENLWF.Tween( this.object );
			this.chainedTweens.push( chainedTween );
			return chainedTween;

		}

	};

	this.onStart = function ( callback ) {

		this.onStartCallback = callback;
		return this;

	};

	this.onUpdate = function ( callback ) {

		this.onUpdateCallback = callback;
		return this;

	};

	this.onComplete = function ( callback ) {

		this.onCompleteCallback = callback;
		return this;

	};

	this.update = function ( time ) {

		if ( time < this.startTime ) {

			return true;

		}

		if ( this.onStartCallbackFired === false ) {

			if ( this.onStartCallback !== null ) {

				this.onStartCallback.call( this.object );

			}

			this.onStartCallbackFired = true;

		}

		var elapsed = ( time - this.startTime ) / this.duration;
		elapsed = elapsed > 1 ? 1 : elapsed;

		var value = this.easingFunction( elapsed );

		for ( var property in this.valuesStart ) {

			var start = this.valuesStart[ property ];
			var end = this.valuesEnd[ property ];

			if ( end instanceof Array ) {

				this.object[ property ] = this.interpolationFunction( end, value );

			} else {

				this.object[ property ] = start + ( end - start ) * value;

			}

		}

		if ( this.onUpdateCallback !== null ) {

			this.onUpdateCallback.call( this.object, value );

		}

		if ( elapsed == 1 ) {

			if ( this.onCompleteCallback !== null ) {

				this.onCompleteCallback.call( this.object );

			}

			for ( var i = 0, l = this.chainedTweens.length; i < l; i ++ ) {

				this.chainedTweens[ i ].start( time );

			}

			return false;

		}

		return true;

	};

	this[ "to" ] = this.to;
	this[ "start" ] = this.start;
	this[ "stop" ] = this.stop;
	this[ "delay" ] = this.delay;
	this[ "easing" ] = this.easing;
	this[ "interpolation" ] = this.interpolation;
	this[ "chain" ] = this.chain;
	this[ "onStart" ] = this.onStart;
	this[ "onUpdate" ] = this.onUpdate;
	this[ "onComplete" ] = this.onComplete;
	this[ "update" ] = this.update;

};

TWEENLWF.Easing = {

	Linear: {

		None: function ( k ) {

			return k;

		}

	},

	Quadratic: {

		In: function ( k ) {

			return k * k;

		},

		Out: function ( k ) {

			return k * ( 2 - k );

		},

		InOut: function ( k ) {

			if ( ( k *= 2 ) < 1 ) return 0.5 * k * k;
			return - 0.5 * ( --k * ( k - 2 ) - 1 );

		}

	},

	Cubic: {

		In: function ( k ) {

			return k * k * k;

		},

		Out: function ( k ) {

			return --k * k * k + 1;

		},

		InOut: function ( k ) {

			if ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k;
			return 0.5 * ( ( k -= 2 ) * k * k + 2 );

		}

	},

	Quartic: {

		In: function ( k ) {

			return k * k * k * k;

		},

		Out: function ( k ) {

			return 1 - ( --k * k * k * k );

		},

		InOut: function ( k ) {

			if ( ( k *= 2 ) < 1) return 0.5 * k * k * k * k;
			return - 0.5 * ( ( k -= 2 ) * k * k * k - 2 );

		}

	},

	Quintic: {

		In: function ( k ) {

			return k * k * k * k * k;

		},

		Out: function ( k ) {

			return --k * k * k * k * k + 1;

		},

		InOut: function ( k ) {

			if ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k * k * k;
			return 0.5 * ( ( k -= 2 ) * k * k * k * k + 2 );

		}

	},

	Sinusoidal: {

		In: function ( k ) {

			return 1 - Math.cos( k * Math.PI / 2 );

		},

		Out: function ( k ) {

			return Math.sin( k * Math.PI / 2 );

		},

		InOut: function ( k ) {

			return 0.5 * ( 1 - Math.cos( Math.PI * k ) );

		}

	},

	Exponential: {

		In: function ( k ) {

			return k === 0 ? 0 : Math.pow( 1024, k - 1 );

		},

		Out: function ( k ) {

			return k === 1 ? 1 : 1 - Math.pow( 2, - 10 * k );

		},

		InOut: function ( k ) {

			if ( k === 0 ) return 0;
			if ( k === 1 ) return 1;
			if ( ( k *= 2 ) < 1 ) return 0.5 * Math.pow( 1024, k - 1 );
			return 0.5 * ( - Math.pow( 2, - 10 * ( k - 1 ) ) + 2 );

		}

	},

	Circular: {

		In: function ( k ) {

			return 1 - Math.sqrt( 1 - k * k );

		},

		Out: function ( k ) {

			return Math.sqrt( 1 - ( --k * k ) );

		},

		InOut: function ( k ) {

			if ( ( k *= 2 ) < 1) return - 0.5 * ( Math.sqrt( 1 - k * k) - 1);
			return 0.5 * ( Math.sqrt( 1 - ( k -= 2) * k) + 1);

		}

	},

	Elastic: {

		In: function ( k ) {

			var s, a = 0.1, p = 0.4;
			if ( k === 0 ) return 0;
			if ( k === 1 ) return 1;
			if ( !a || a < 1 ) { a = 1; s = p / 4; }
			else s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );
			return - ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );

		},

		Out: function ( k ) {

			var s, a = 0.1, p = 0.4;
			if ( k === 0 ) return 0;
			if ( k === 1 ) return 1;
			if ( !a || a < 1 ) { a = 1; s = p / 4; }
			else s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );
			return ( a * Math.pow( 2, - 10 * k) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) + 1 );

		},

		InOut: function ( k ) {

			var s, a = 0.1, p = 0.4;
			if ( k === 0 ) return 0;
			if ( k === 1 ) return 1;
			if ( !a || a < 1 ) { a = 1; s = p / 4; }
			else s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );
			if ( ( k *= 2 ) < 1 ) return - 0.5 * ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );
			return a * Math.pow( 2, -10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) * 0.5 + 1;

		}

	},

	Back: {

		In: function ( k ) {

			var s = 1.70158;
			return k * k * ( ( s + 1 ) * k - s );

		},

		Out: function ( k ) {

			var s = 1.70158;
			return --k * k * ( ( s + 1 ) * k + s ) + 1;

		},

		InOut: function ( k ) {

			var s = 1.70158 * 1.525;
			if ( ( k *= 2 ) < 1 ) return 0.5 * ( k * k * ( ( s + 1 ) * k - s ) );
			return 0.5 * ( ( k -= 2 ) * k * ( ( s + 1 ) * k + s ) + 2 );

		}

	},

	Bounce: {

		In: function ( k ) {

			return 1 - TWEENLWF.Easing.Bounce.Out( 1 - k );

		},

		Out: function ( k ) {

			if ( k < ( 1 / 2.75 ) ) {

				return 7.5625 * k * k;

			} else if ( k < ( 2 / 2.75 ) ) {

				return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;

			} else if ( k < ( 2.5 / 2.75 ) ) {

				return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;

			} else {

				return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;

			}

		},

		InOut: function ( k ) {

			if ( k < 0.5 ) return TWEENLWF.Easing.Bounce.In( k * 2 ) * 0.5;
			return TWEENLWF.Easing.Bounce.Out( k * 2 - 1 ) * 0.5 + 0.5;

		}

	}

};

TWEENLWF.Interpolation = {

	Linear: function ( v, k ) {

		var m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEENLWF.Interpolation.Utils.Linear;

		if ( k < 0 ) return fn( v[ 0 ], v[ 1 ], f );
		if ( k > 1 ) return fn( v[ m ], v[ m - 1 ], m - f );

		return fn( v[ i ], v[ i + 1 > m ? m : i + 1 ], f - i );

	},

	Bezier: function ( v, k ) {

		var b = 0, n = v.length - 1, pw = Math.pow, bn = TWEENLWF.Interpolation.Utils.Bernstein, i;

		for ( i = 0; i <= n; i++ ) {
			b += pw( 1 - k, n - i ) * pw( k, i ) * v[ i ] * bn( n, i );
		}

		return b;

	},

	CatmullRom: function ( v, k ) {

		var m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEENLWF.Interpolation.Utils.CatmullRom;

		if ( v[ 0 ] === v[ m ] ) {

			if ( k < 0 ) i = Math.floor( f = m * ( 1 + k ) );

			return fn( v[ ( i - 1 + m ) % m ], v[ i ], v[ ( i + 1 ) % m ], v[ ( i + 2 ) % m ], f - i );

		} else {

			if ( k < 0 ) return v[ 0 ] - ( fn( v[ 0 ], v[ 0 ], v[ 1 ], v[ 1 ], -f ) - v[ 0 ] );
			if ( k > 1 ) return v[ m ] - ( fn( v[ m ], v[ m ], v[ m - 1 ], v[ m - 1 ], f - m ) - v[ m ] );

			return fn( v[ i ? i - 1 : 0 ], v[ i ], v[ m < i + 1 ? m : i + 1 ], v[ m < i + 2 ? m : i + 2 ], f - i );

		}

	},

	Utils: {

		Linear: function ( p0, p1, t ) {

			return ( p1 - p0 ) * t + p0;

		},

		Bernstein: function ( n , i ) {

			var fc = TWEENLWF.Interpolation.Utils.Factorial;
			return fc( n ) / fc( i ) / fc( n - i );

		},

		Factorial: ( function () {

			var a = [ 1 ];

			return function ( n ) {

				var s = 1, i;
				if ( a[ n ] ) return a[ n ];
				for ( i = n; i > 1; i-- ) s *= i;
				return a[ n ] = s;

			};

		} )(),

		CatmullRom: function ( p0, p1, p2, p3, t ) {

			var v0 = ( p2 - p0 ) * 0.5, v1 = ( p3 - p1 ) * 0.5, t2 = t * t, t3 = t * t2;
			return ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;

		}

	}

};

if ( typeof global !== "undefined" && global !== null ) {

	var lwfPrototype = global[ "LWF" ][ "LWF" ].prototype;

	lwfPrototype[ "setTweenMode" ] = function( mode ) {

		this._tweenMode = mode;

	};

	lwfPrototype.stopTweens = function() {

		if ( typeof this._tweens !== "undefined" ) {

			this._tweens = undefined;

			this.removeExecHandler( TWEENLWF._tweenExecHandler );
			this.removeMovieEventHandler( "_root", {
				
				"enterFrame": TWEENLWF._tweenMovieHandler

			});

		}

	};

	lwfPrototype[ "stopTweens" ] = lwfPrototype.stopTweens;

	TWEENLWF._tweenUpdater = function() {

		var i = 0;
		var num_tweens = this._tweens.length;
		var time = this.time;

		while ( i < num_tweens ) {

			if ( this._tweens[ i ].update( time ) ) {

				i ++;

			} else {

				this._tweens.splice( i, 1 );
				num_tweens --;

			}

		}

		if ( this._tweens.length == 0 ) {

			this.stopTweens();

		}

	};

	TWEENLWF._tweenExecHandler = function() {

		TWEENLWF._tweenUpdater();

	};

	TWEENLWF._tweenMovieHandler = function() {

		TWEENLWF._tweenUpdater.call( this.lwf );

	};

	var moviePrototype = global[ "LWF" ][ "Movie" ].prototype;

	moviePrototype[ "addTween" ] = function() {

		var tween = new TWEENLWF.Tween( this );

		return tween;

	};

	moviePrototype[ "stopTweens" ] = function() {

		if ( typeof this.lwf === "undefined" || this.lwf === null ||
				typeof this.lwf._tweens === "undefined" ||
					this.lwf._tweens === null ) {

			return this;

		}

		var tweens = this.lwf._tweens;

		var i = 0;
		var num_tweens = tweens.length;

		while ( i < num_tweens ) {

			if ( tweens[ i ]._object === this ) {

				tweens.splice( i, 1 );
				num_tweens --;

			} else {

				i ++;

			}

		}

		if ( tweens.length == 0 ) {

			this.lwf.stopTweens();

		}

		return this;

	};

	global[ "LWF" ][ "Tween" ] = TWEENLWF.Tween;
	global[ "LWF" ][ "Tween" ][ "Easing" ] = TWEENLWF.Easing;
	var e = global[ "LWF" ][ "Tween" ][ "Easing" ];
	e[ "Linear" ] = TWEENLWF.Easing.Linear;
	e[ "Linear" ][ "None" ] = TWEENLWF.Easing.Linear.None;
	e[ "Quadratic" ] = TWEENLWF.Easing.Quadratic;
	e[ "Quadratic" ][ "In" ] = TWEENLWF.Easing.Quadratic.In;
	e[ "Quadratic" ][ "Out" ] = TWEENLWF.Easing.Quadratic.Out;
	e[ "Quadratic" ][ "InOut" ] = TWEENLWF.Easing.Quadratic.InOut;
	e[ "Cubic" ] = TWEENLWF.Easing.Cubic;
	e[ "Cubic" ][ "In" ] = TWEENLWF.Easing.Cubic.In;
	e[ "Cubic" ][ "Out" ] = TWEENLWF.Easing.Cubic.Out;
	e[ "Cubic" ][ "InOut" ] = TWEENLWF.Easing.Cubic.InOut;
	e[ "Quartic" ] = TWEENLWF.Easing.Quartic;
	e[ "Quartic" ][ "In" ] = TWEENLWF.Easing.Quartic.In;
	e[ "Quartic" ][ "Out" ] = TWEENLWF.Easing.Quartic.Out;
	e[ "Quartic" ][ "InOut" ] = TWEENLWF.Easing.Quartic.InOut;
	e[ "Quintic" ] = TWEENLWF.Easing.Quintic;
	e[ "Quintic" ][ "In" ] = TWEENLWF.Easing.Quintic.In;
	e[ "Quintic" ][ "Out" ] = TWEENLWF.Easing.Quintic.Out;
	e[ "Quintic" ][ "InOut" ] = TWEENLWF.Easing.Quintic.InOut;
	e[ "Sinusoidal" ] = TWEENLWF.Easing.Sinusoidal;
	e[ "Sinusoidal" ][ "In" ] = TWEENLWF.Easing.Sinusoidal.In;
	e[ "Sinusoidal" ][ "Out" ] = TWEENLWF.Easing.Sinusoidal.Out;
	e[ "Sinusoidal" ][ "InOut" ] = TWEENLWF.Easing.Sinusoidal.InOut;
	e[ "Exponential" ] = TWEENLWF.Easing.Exponential;
	e[ "Exponential" ][ "In" ] = TWEENLWF.Easing.Exponential.In;
	e[ "Exponential" ][ "Out" ] = TWEENLWF.Easing.Exponential.Out;
	e[ "Exponential" ][ "InOut" ] = TWEENLWF.Easing.Exponential.InOut;
	e[ "Circular" ] = TWEENLWF.Easing.Circular;
	e[ "Circular" ][ "In" ] = TWEENLWF.Easing.Circular.In;
	e[ "Circular" ][ "Out" ] = TWEENLWF.Easing.Circular.Out;
	e[ "Circular" ][ "InOut" ] = TWEENLWF.Easing.Circular.InOut;
	e[ "Elastic" ] = TWEENLWF.Easing.Elastic;
	e[ "Elastic" ][ "In" ] = TWEENLWF.Easing.Elastic.In;
	e[ "Elastic" ][ "Out" ] = TWEENLWF.Easing.Elastic.Out;
	e[ "Elastic" ][ "InOut" ] = TWEENLWF.Easing.Elastic.InOut;
	e[ "Back" ] = TWEENLWF.Easing.Back;
	e[ "Back" ][ "In" ] = TWEENLWF.Easing.Back.In;
	e[ "Back" ][ "Out" ] = TWEENLWF.Easing.Back.Out;
	e[ "Back" ][ "InOut" ] = TWEENLWF.Easing.Back.InOut;
	e[ "Bounce" ] = TWEENLWF.Easing.Bounce;
	e[ "Bounce" ][ "In" ] = TWEENLWF.Easing.Bounce.In;
	e[ "Bounce" ][ "Out" ] = TWEENLWF.Easing.Bounce.Out;
	e[ "Bounce" ][ "InOut" ] = TWEENLWF.Easing.Bounce.InOut;

	global[ "LWF" ][ "Tween" ][ "Interpolation" ] = TWEENLWF.Interpolation;
	var i = global[ "LWF" ][ "Tween" ][ "Interpolation" ];
	i[ "Linear" ] = TWEENLWF.Interpolation.Linear;
	i[ "Bezier" ] = TWEENLWF.Interpolation.Bezier;
	i[ "CatmullRom" ] = TWEENLWF.Interpolation.CatmullRom;
	i[ "Utils" ] = TWEENLWF.Interpolation.Utils;
	i[ "Utils" ][ "Linear" ] = TWEENLWF.Interpolation.Utils.Linear;
	i[ "Utils" ][ "Bernstein" ] = TWEENLWF.Interpolation.Utils.Bernstein;
	i[ "Utils" ][ "Factorial" ] = TWEENLWF.Interpolation.Utils.Factorial;
	i[ "Utils" ][ "CatmullRom" ] = TWEENLWF.Interpolation.Utils.CatmullRom;

}

}).call(this);
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
(function() {'use strict';var aa=this;function g(a,b,d){a=a.split(".");d=d||aa;!(a[0]in d)&&d.execScript&&d.execScript("var "+a[0]);for(var c;a.length&&(c=a.shift());)!a.length&&void 0!==b?d[c]=b:d=d[c]?d[c]:d[c]={}}Math.floor(2147483648*Math.random()).toString(36);var j="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;var ba=new (j?Uint8Array:Array)(256),l;for(l=0;256>l;++l){for(var ca=ba,da=l,n=l,o=n,q=7,n=n>>>1;n;n>>>=1)o<<=1,o|=n&1,--q;ca[da]=(o<<q&255)>>>0};var ea=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,
2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,
2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,
2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,
3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,
936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];j&&new Uint32Array(ea);function r(a){var b=a.length,d=0,c=Number.POSITIVE_INFINITY,f,e,h,i,p,w,x,k,m;for(k=0;k<b;++k)a[k]>d&&(d=a[k]),a[k]<c&&(c=a[k]);f=1<<d;e=new (j?Uint32Array:Array)(f);h=1;i=0;for(p=2;h<=d;){for(k=0;k<b;++k)if(a[k]===h){w=0;x=i;for(m=0;m<h;++m)w=w<<1|x&1,x>>=1;for(m=w;m<f;m+=p)e[m]=h<<16|k;++i}++h;i<<=1;p<<=1}return[e,d,c]};var s=[],t;for(t=0;288>t;t++)switch(!0){case 143>=t:s.push([t+48,8]);break;case 255>=t:s.push([t-144+400,9]);break;case 279>=t:s.push([t-256+0,7]);break;case 287>=t:s.push([t-280+192,8]);break;default:throw"invalid literal: "+t;}function u(a,b){this.length=a;this.z=b}
function fa(a){switch(!0){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-31,2];case 42>=
a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:throw"invalid length: "+a;}}var v=[],y,z;for(y=3;258>=y;y++)z=fa(y),v[y]=z[2]<<24|z[1]<<16|z[0];
var ga=j?new Uint32Array(v):v;
u.prototype.D=function(a){switch(!0){case 1===a:a=[0,a-1,0];break;case 2===a:a=[1,a-2,0];break;case 3===a:a=[2,a-3,0];break;case 4===a:a=[3,a-4,0];break;case 6>=a:a=[4,a-5,1];break;case 8>=a:a=[5,a-7,1];break;case 12>=a:a=[6,a-9,2];break;case 16>=a:a=[7,a-13,2];break;case 24>=a:a=[8,a-17,3];break;case 32>=a:a=[9,a-25,3];break;case 48>=a:a=[10,a-33,4];break;case 64>=a:a=[11,a-49,4];break;case 96>=a:a=[12,a-65,5];break;case 128>=a:a=[13,a-97,5];break;case 192>=a:a=[14,a-129,6];break;case 256>=a:a=[15,
a-193,6];break;case 384>=a:a=[16,a-257,7];break;case 512>=a:a=[17,a-385,7];break;case 768>=a:a=[18,a-513,8];break;case 1024>=a:a=[19,a-769,8];break;case 1536>=a:a=[20,a-1025,9];break;case 2048>=a:a=[21,a-1537,9];break;case 3072>=a:a=[22,a-2049,10];break;case 4096>=a:a=[23,a-3073,10];break;case 6144>=a:a=[24,a-4097,11];break;case 8192>=a:a=[25,a-6145,11];break;case 12288>=a:a=[26,a-8193,12];break;case 16384>=a:a=[27,a-12289,12];break;case 24576>=a:a=[28,a-16385,13];break;case 32768>=a:a=[29,a-24577,
13];break;default:throw"invalid distance";}return a};u.prototype.K=function(){var a=this.z,b=[],d=0,c;c=ga[this.length];b[d++]=c&65535;b[d++]=c>>16&255;b[d++]=c>>24;c=this.D(a);b[d++]=c[0];b[d++]=c[1];b[d++]=c[2];return b};function A(a,b){this.i=[];this.j=32768;this.e=this.g=this.a=this.n=0;this.input=j?new Uint8Array(a):a;this.o=!1;this.k=B;this.t=!1;if(b||!(b={}))if(b.index&&(this.a=b.index),b.bufferSize&&(this.j=b.bufferSize),b.bufferType&&(this.k=b.bufferType),b.resize)this.t=b.resize;switch(this.k){case C:this.b=32768;this.c=new (j?Uint8Array:Array)(32768+this.j+258);break;case B:this.b=0;this.c=new (j?Uint8Array:Array)(this.j);this.f=this.C;this.p=this.A;this.l=this.B;break;default:throw Error("invalid inflate mode");
}}var C=0,B=1,D={v:C,u:B};A.prototype.m=function(){for(;!this.o;)this.F();return this.p()};
var E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=j?new Uint16Array(E):E,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],H=j?new Uint16Array(G):G,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],J=j?new Uint8Array(I):I,K=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],L=j?new Uint16Array(K):K,M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,
13],N=j?new Uint8Array(M):M,O=new (j?Uint8Array:Array)(288),P,Q;P=0;for(Q=O.length;P<Q;++P)O[P]=143>=P?8:255>=P?9:279>=P?7:8;var ha=r(O),R=new (j?Uint8Array:Array)(30),S,T;S=0;for(T=R.length;S<T;++S)R[S]=5;var ia=r(R);A.prototype.F=function(){var a=this.d(3);a&1&&(this.o=!0);a>>>=1;switch(a){case 0:this.I();break;case 1:this.H();break;case 2:this.G();break;default:throw Error("unknown BTYPE: "+a);}};
A.prototype.d=function(a){for(var b=this.g,d=this.e,c=this.input,f=this.a,e;d<a;){e=c[f++];if(void 0===e)throw Error("input buffer is broken");b|=e<<d;d+=8}e=b&(1<<a)-1;this.g=b>>>a;this.e=d-a;this.a=f;return e};A.prototype.h=function(a){for(var b=this.g,d=this.e,c=this.input,f=this.a,e=a[0],a=a[1],h;d<a;){h=c[f++];if(void 0===h)throw Error("input buffer is broken");b|=h<<d;d+=8}c=e[b&(1<<a)-1];e=c>>>16;this.g=b>>e;this.e=d-e;this.a=f;return c&65535};
A.prototype.I=function(){var a=this.input,b=this.a,d=this.c,c=this.b,f,e,h,i=d.length;this.e=this.g=0;f=a[b++];if(void 0===f)throw Error("invalid uncompressed block header: LEN (first byte)");e=f;f=a[b++];if(void 0===f)throw Error("invalid uncompressed block header: LEN (second byte)");e|=f<<8;f=a[b++];if(void 0===f)throw Error("invalid uncompressed block header: NLEN (first byte)");h=f;f=a[b++];if(void 0===f)throw Error("invalid uncompressed block header: NLEN (second byte)");if(e===~(h|f<<8))throw Error("invalid uncompressed block header: length verify");
if(b+e>a.length)throw Error("input buffer is broken");switch(this.k){case C:for(;c+e>d.length;){f=i-c;e-=f;if(j)d.set(a.subarray(b,b+f),c),c+=f,b+=f;else for(;f--;)d[c++]=a[b++];this.b=c;d=this.f();c=this.b}break;case B:for(;c+e>d.length;)d=this.f({r:2});break;default:throw Error("invalid inflate mode");}if(j)d.set(a.subarray(b,b+e),c),c+=e,b+=e;else for(;e--;)d[c++]=a[b++];this.a=b;this.b=c;this.c=d};A.prototype.H=function(){this.l(ha,ia)};
A.prototype.G=function(){function a(a,d,c){var b,e,f;for(f=0;f<a;)switch(b=this.h(d),b){case 16:for(b=3+this.d(2);b--;)c[f++]=e;break;case 17:for(b=3+this.d(3);b--;)c[f++]=0;e=0;break;case 18:for(b=11+this.d(7);b--;)c[f++]=0;e=0;break;default:e=c[f++]=b}return c}var b=this.d(5)+257,d=this.d(5)+1,c=this.d(4)+4,f=new (j?Uint8Array:Array)(F.length),e;for(e=0;e<c;++e)f[F[e]]=this.d(3);c=r(f);f=new (j?Uint8Array:Array)(b);e=new (j?Uint8Array:Array)(d);this.l(r(a.call(this,b,c,f)),r(a.call(this,d,c,e)))};
A.prototype.l=function(a,b){var d=this.c,c=this.b;this.q=a;for(var f=d.length-258,e,h,i;256!==(e=this.h(a));)if(256>e)c>=f&&(this.b=c,d=this.f(),c=this.b),d[c++]=e;else{e-=257;i=H[e];0<J[e]&&(i+=this.d(J[e]));e=this.h(b);h=L[e];0<N[e]&&(h+=this.d(N[e]));c>=f&&(this.b=c,d=this.f(),c=this.b);for(;i--;)d[c]=d[c++-h]}for(;8<=this.e;)this.e-=8,this.a--;this.b=c};
A.prototype.B=function(a,b){var d=this.c,c=this.b;this.q=a;for(var f=d.length,e,h,i;256!==(e=this.h(a));)if(256>e)c>=f&&(d=this.f(),f=d.length),d[c++]=e;else{e-=257;i=H[e];0<J[e]&&(i+=this.d(J[e]));e=this.h(b);h=L[e];0<N[e]&&(h+=this.d(N[e]));c+i>f&&(d=this.f(),f=d.length);for(;i--;)d[c]=d[c++-h]}for(;8<=this.e;)this.e-=8,this.a--;this.b=c};
A.prototype.f=function(){var a=new (j?Uint8Array:Array)(this.b-32768),b=this.b-32768,d,c,f=this.c;if(j)a.set(f.subarray(32768,a.length));else{d=0;for(c=a.length;d<c;++d)a[d]=f[d+32768]}this.i.push(a);this.n+=a.length;if(j)f.set(f.subarray(b,b+32768));else for(d=0;32768>d;++d)f[d]=f[b+d];this.b=32768;return f};
A.prototype.C=function(a){var b=this.input.length/this.a+1|0,d=this.input,c=this.c;a&&("number"===typeof a.r&&(b=a.r),"number"===typeof a.w&&(b+=a.w));2>b?(a=(d.length-this.a)/this.q[2],a=258*(a/2)|0,a=a<c.length?c.length+a:c.length<<1):a=c.length*b;j?(a=new Uint8Array(a),a.set(c)):a=c;return this.c=a};
A.prototype.p=function(){var a=0,b=this.c,d=this.i,c,f=new (j?Uint8Array:Array)(this.n+(this.b-32768)),e,h,i,p;if(0===d.length)return j?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);e=0;for(h=d.length;e<h;++e){c=d[e];i=0;for(p=c.length;i<p;++i)f[a++]=c[i]}e=32768;for(h=this.b;e<h;++e)f[a++]=b[e];this.i=[];return this.buffer=f};
A.prototype.A=function(){var a,b=this.b;j?this.t?(a=new Uint8Array(b),a.set(this.c.subarray(0,b))):a=this.c.subarray(0,b):(this.c.length>b&&(this.c.length=b),a=this.c);return this.buffer=a};function U(a,b){var d,c;this.input=a;this.a=0;if(b||!(b={}))if(b.index&&(this.a=b.index),b.verify)this.J=b.verify;d=a[this.a++];c=a[this.a++];switch(d&15){case V:this.method=V;break;default:throw Error("unsupported compression method");}if(0!==((d<<8)+c)%31)throw Error("invalid fcheck flag:"+((d<<8)+c)%31);if(c&32)throw Error("fdict flag is not supported");this.s=new A(a,{index:this.a,bufferSize:b.bufferSize,bufferType:b.bufferType,resize:b.resize})}
U.prototype.m=function(){var a=this.input,b;b=this.s.m();this.a=this.s.a;if(this.J){var a=a[this.a++]<<24|a[this.a++]<<16|a[this.a++]<<8|a[this.a++],d=b;if("string"===typeof d){var d=d.split(""),c,f;c=0;for(f=d.length;c<f;c++)d[c]=(d[c].charCodeAt(0)&255)>>>0}c=1;f=0;for(var e=d.length,h,i=0;0<e;){h=1024<e?1024:e;e-=h;do c+=d[i++],f+=c;while(--h);c%=65521;f%=65521}if(a!==(f<<16|c)>>>0)throw Error("invalid adler-32 checksum");}return b};g("Zlib.Inflate",U,void 0);g("Zlib.Inflate.BufferType",D,void 0);
D.ADAPTIVE=D.u;D.BLOCK=D.v;g("Zlib.Inflate.prototype.decompress",U.prototype.m,void 0);var ja=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];j&&new Uint16Array(ja);var ka=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];j&&new Uint16Array(ka);var la=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];j&&new Uint8Array(la);var ma=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];j&&new Uint16Array(ma);
var na=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];j&&new Uint8Array(na);var W=new (j?Uint8Array:Array)(288),X,Y;X=0;for(Y=W.length;X<Y;++X)W[X]=143>=X?8:255>=X?9:279>=X?7:8;r(W);var Z=new (j?Uint8Array:Array)(30),$,oa;$=0;for(oa=Z.length;$<oa;++$)Z[$]=5;r(Z);var V=8;}).call(this);
